<!--CHATGPT ICON-->
<!-- <div *ngIf="isChatGptIconDisplayed && showIcon &&authenticationService?.module?.chatGptIntegrationEnabled && !isShowingRouteLoadIndicator && !showLoaderForAuthGuard" class="chatgpt-card override" id="chatIconImage" data-toggle="modal" data-target="#xAmplifyChatGPTModal" (click)="resetValues()">
  <a class="javascript:void(0)"><img src="assets/images/homeOliverLogo-1.svg" class="icon-s-w"></a>
</div> -->
<div
  *ngIf="isChatGptIconDisplayed && showIcon && authenticationService?.isOliverActive && !isShowingRouteLoadIndicator && !showLoaderForAuthGuard"
  [ngClass]="!isMinimizeOliver ? 'chatgpt-card override' : 'minimize'" id="chatIconImage" (click)="resetValues()"
  data-toggle="modal" data-target="#xAmplifyChatGPTModal">

  <!-- Close icon (minimize) -->
  <a><i *ngIf="!isMinimizeOliver" class="fa fa-close customIcon" aria-hidden="true" (click)="onMinimizeClick($event)">
    </i></a>

  <div class="oliver-wrapper">
    <div (mouseenter)="expandIfMinimized()">
      <object data="assets/images/homeOliverLogo-1.svg" type="image/svg+xml" [ngStyle]="{
          'width': !isMinimizeOliver ? '150px' : '60px',
          'height': !isMinimizeOliver ? '150px' : '60px',
          'transition': '0.3s ease-in-out'
        }" class="icon-s-w">
      </object>
    </div>
  </div>
</div>

<!--ICON END -->
<link *ngIf="isWelcomePageUrl" rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
<link  *ngIf="isWelcomePageUrl" rel='stylesheet' href='/assets/js/indexjscss/oliver-AI.css' type='text/css'>
<script *ngIf="isWelcomePageUrl" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

<!--ChatGPT Modal-->
<div *ngIf="isChatGptIconDisplayed && authenticationService?.isOliverActive && !isShowingRouteLoadIndicator && !showLoaderForAuthGuard" class="modal fade right modal-z-index" id="xAmplifyChatGPTModal" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false" aria-labelledby="xAmplifyChatGPTModalLabel">
  <div  class="modal-dialog w85-per" role="document">
    <div class="modal-content">
      <!-- <div class="modal-header">
        <button type="button" class="close-circle" data-dismiss="modal" aria-label="Close">
          <i class="fa fa-times"></i></button>
        <h4 class="modal-title text-center">xAmplify AI</h4>
      </div> -->
      <app-update-status *ngIf="openShareOption" [fromAi]="true" [OliverData] = "socialContent" (notifyClose)="closeSocialShare($event)"></app-update-status>
      <div *ngIf="!openShareOption" class="modal-body oliver-header">
        <app-response-message [customResponse]="customResponse" *ngIf="customResponse?.isVisible" [showCloseIcon]="false"></app-response-message>
        <div classs="row">
          <button type="button" class="close-circle" data-dismiss="modal" aria-label="Close"
        style="position: absolute;  top: 12px;right: 12px; width: 27px;height: 27px;" (click)="showOliverIcon()">
        <i class="fa fa-times m0" aria-hidden="true"></i></button>
          <!-- <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6 card_pr15">
            <div class="card1 pr0 pl0">
              <div class="chat_btn">
                <textarea class="form-control border_0" [(ngModel)]="inputText" [ngModelOptions]="{standalone: true}" rows="18" (input)="validateInputText()" placeholder="Enter the text here"></textarea>
                <div class="copy_text">
                  <div class="gap-12">
                    <button class="copy_btns" type="button">
                      <div class="sample-text">
                        <svg focusable="false" aria-hidden="true" viewBox="0 0 30 30" class="svg-w-h">
                          <path d="M3.98489 7.49906C4.74195 6.96993 5.88318 7.0714 6.56292 7.63276L5.78331 6.49958C5.15592 5.6048 5.38062 4.63673 6.27621 4.00853C7.17179 3.38274 9.70956 5.06519 9.70956 5.06519C9.07653 4.16155 9.19492 3.01629 10.0986 2.38246C11.0022 1.75103 12.2489 1.96929 12.882 2.87455L21.2741 14.7298L20.2045 25.0991L11.2784 21.8438L3.4928 10.3002C2.85413 9.39091 3.07481 8.13693 3.98489 7.49906Z"
                            fill="#EF9645"></path>
                          <path d="M2.24043 14.0944C2.24043 14.0944 1.32874 12.7655 2.65843 11.8546C3.98651 10.9437 4.8974 12.2718 4.8974 12.2718L9.12647 18.4394C9.27225 18.1962 9.43171 17.9562 9.6097 17.7194L3.74006 9.16058C3.74006 9.16058 2.82917 7.8325 4.15805 6.92161C5.48613 6.01072 6.39702 7.3388 6.39702 7.3388L11.9179 15.3902C12.1233 15.2227 12.3335 15.0544 12.5502 14.8893L6.14977 5.55407C6.14977 5.55407 5.23888 4.22599 6.56776 3.3151C7.89584 2.40421 8.80673 3.73229 8.80673 3.73229L15.2071 13.0659C15.4423 12.9217 15.6751 12.7969 15.9086 12.6648L9.92622 3.94089C9.92622 3.94089 9.01533 2.61281 10.3434 1.70192C11.6715 0.791027 12.5824 2.11911 12.5824 2.11911L18.9079 11.344L19.8695 12.747C15.8845 15.4804 15.5051 20.6228 17.7819 23.9434C18.237 24.6079 18.9014 24.1528 18.9014 24.1528C16.1688 20.167 17.0031 15.6882 20.989 12.9556L19.8139 7.07464C19.8139 7.07464 19.375 5.52508 20.9237 5.08534C22.4733 4.6464 22.913 6.19596 22.913 6.19596L24.2701 10.2261C24.8081 11.824 25.3807 13.4162 26.1386 14.9223C28.2785 19.1747 27.0004 24.4597 22.9654 27.2278C18.564 30.2455 12.5469 29.1236 9.52836 24.723L2.24043 14.0944Z"
                            fill="#FFDC5D"></path>
                          <path  d="M9.73464 25.9383C6.51311 25.9383 3.25774 22.683 3.25774 19.4614C3.25774 19.0161 2.93156 18.6561 2.48618 18.6561C2.04081 18.6561 1.64697 19.0161 1.64697 19.4614C1.64697 24.2938 4.90234 27.5491 9.73464 27.5491C10.18 27.5491 10.54 27.1553 10.54 26.7099C10.54 26.2645 10.18 25.9383 9.73464 25.9383Z"
                            fill="#5DADEC"></path>
                          <path  d="M5.70764 27.5153C3.29148 27.5153 1.68072 25.9045 1.68072 23.4884C1.68072 23.043 1.32071 22.683 0.875331 22.683C0.429953 22.683 0.0699463 23.043 0.0699463 23.4884C0.0699463 26.7099 2.4861 29.1261 5.70764 29.1261C6.15302 29.1261 6.51302 28.766 6.51302 28.3207C6.51302 27.8753 6.15302 27.5153 5.70764 27.5153ZM19.3992 1.74298C18.9546 1.74298 18.5938 2.10379 18.5938 2.54836C18.5938 2.99294 18.9546 3.35375 19.3992 3.35375C22.6207 3.35375 25.8423 6.24427 25.8423 9.79682C25.8423 10.2414 26.2031 10.6022 26.6476 10.6022C27.0922 10.6022 27.453 10.2414 27.453 9.79682C27.453 5.35593 24.2315 1.74298 19.3992 1.74298Z"
                            fill="#5DADEC"></path>
                          <path d="M23.4261 0.166046C22.9815 0.166046 22.6207 0.493032 22.6207 0.937605C22.6207 1.38218 22.9815 1.77682 23.4261 1.77682C25.8423 1.77682 27.4192 3.5688 27.4192 5.76991C27.4192 6.21448 27.813 6.5753 28.2584 6.5753C28.7038 6.5753 29.03 6.21448 29.03 5.76991C29.03 2.67965 26.6477 0.166046 23.4261 0.166046Z"
                            fill="#5DADEC"></path>
                        </svg>
                        <div>Try Sample Text</div>
                      </div>
                    </button>
                  </div>
                </div>
              </div>
              <div class="sticky_btn">
                <div class="para-phrase">
                  <button class="para_btn btn btn-primary" type="button" (click)="!isTextLoading && isValidInputText && generateChatGPTText()" [disabled]="isTextLoading || !isValidInputText">Generate</button>
                </div>
              </div>
            </div>
          </div>
           <div class="right_arrow"><i class="fa fa-long-arrow-right hidden-xs" aria-hidden="true"></i></div>
          <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6 card_pl15">
            <div class="mt10" *ngIf="isTextLoading">
              <app-modal-popup-loader [height]="435"></app-modal-popup-loader>
            </div>
            <div class="card1 pr0 pl0" *ngIf="!isTextLoading">
              <div class="chat_btn">
                <textarea class="form-control border_0" id="chatGptGeneratedTextArea"  [(ngModel)]="chatGptGeneratedText" [ngModelOptions]="{standalone: true}" rows="18" readonly #chatGptGeneratedTextInput></textarea>
              </div>
              <div class="sticky_btn" *ngIf="isCopyButtonDisplayed">
                <div class="para-phrase">
                  <span class="success" id="copied-chat-gpt-text-message" style="display: none;">
                    <strong>Text copied successfully<i class="fa fa-check" aria-hidden="true"></i></strong>
                  </span>
                  <button class="para_btn btn btn-primary" type="button" (click)="copyChatGPTText(chatGptGeneratedTextInput)">Copy</button>
                </div>
              </div>
            </div>
          </div> -->
          <div class="d-flex oliver_flex">
          <div class="side_bar">
            <img src="assets/images/olivere-sidebar-img.svg" alt="Logo">
            <ul class="nav nav-pills nav-stacked oliver_tab" role="tablist">
              <li [ngClass]="{'active': activeTab === 'new-chat'}">
                <a href="#New-Chat" role="tab" data-toggle="tab" (click)="setActiveTab('new-chat')">
                  <i class="fa fa-plus-circle"></i> Start New Chat
                </a>
              </li>
              <li [ngClass]="{'active': activeTab === 'writing'}">
                <a href="#writing" role="tab" data-toggle="tab" (click)="setActiveTab('writing')">
                  <i class="fa fa-pencil"></i> Writing
                </a>
              </li>
              <li *ngIf="hasAcess" [ngClass]="{'active': activeTab === 'askpdf'}">
                <a href="#askpdf" role="tab" data-toggle="tab" (click)="setActiveTab('askpdf')">
                  <i class="fa fa-file-text"></i> Ask Oliver
                </a>
              </li>
              <li [ngClass]="{'active': activeTab === 'paraphraser'}">
                <a href="#paraphraser" role="tab" data-toggle="tab" (click)="setActiveTab('paraphraser')">
                  <i class="fa fa-align-left"></i> Paraphraser
                </a>
              </li>
            </ul>            
          </div>
          <div  [ngClass]="(isCopyButtonDisplayed || showOpenHistory )&& (activeTab === 'new-chat' || activeTab === 'writing')? 'd-flex align-templateui' : 'd-flex align-center align_tab_view'">
            <div class="tab-content oliver_content">
              <!-- Start New Chat -->
              <div role="tabpanel" [ngClass]="{'tab-pane fade in active': activeTab === 'new-chat', 'tab-pane fade': activeTab !== 'new-chat'}" id="New-Chat">
                <ng-container *ngIf="(isCopyButtonDisplayed || showOpenHistory)  && activeTab === 'new-chat'">
                  <div class="main-container newChatlabel">
                    <ng-container *ngFor="let msg of messages; let i = index">
                      <ng-template [ngTemplateOutlet]="messageTemplate" [ngTemplateOutletContext]="{ data: msg ,index: i}"></ng-template>
                    </ng-container>
                    <ng-container *ngIf="isTextLoading" [ngTemplateOutlet]="assistantLoader"></ng-container>
                  </div>
                </ng-container>                
                <div  [ngClass]="showOpenHistory && activeTab === 'new-chat' ? 'templateui col-lg-9' : 'container-ui'">
                  <!-- Heading -->
                  <div *ngIf= "!showOpenHistory" class="d-flex content-align">
                    <span class="oliver_heading">Engage, Learn, Create, and Communicate with Oliver</span>
                    <!-- Oliver Image Positioned Correctly -->
                    <div class="oliver-container">
                      <img src="assets/images/olivere-dog.svg" alt="Oliver" class="oliver-image">
                    </div>
                  </div>
                  <!-- Input Section -->
                  <div class="oliver_input mt10">
                    <input type="text" [(ngModel)]="inputText" [ngModelOptions]="{standalone: true}"  (input)="validateInputText()" placeholder="Ask Me!">
                    <div class="btn-wrapper">
                      <button *ngIf="hasAcess" class="btn-plus">+</button>
                      <button class="btn-submit" (click)="!isTextLoading && isValidInputText && generateChatGPTText()" [disabled]="isTextLoading || !isValidInputText">Submit</button>
                    </div>
                  </div>
                </div>
              </div>
              <!-- Writing Tab -->
              <div role="tabpanel" [ngClass]="{'tab-pane fade in active': activeTab === 'writing', 'tab-pane fade': activeTab !== 'writing'}" id="writing">
                  <!-- Heading -->
                  <ng-container *ngIf="(isCopyButtonDisplayed || showOpenHistory) && activeTab === 'writing'">
                    <div class="main-container">
                      <ng-container *ngFor="let msg of messages; let i = index">
                        <ng-template [ngTemplateOutlet]="messageTemplate" [ngTemplateOutletContext]="{ data: msg ,index: i}"></ng-template>
                      </ng-container>
                      <ng-container *ngIf="isTextLoading" [ngTemplateOutlet]="assistantLoader"></ng-container>
                    </div>
                  </ng-container> 
                  <div [ngClass]="(isCopyButtonDisplayed || showOpenHistory) && activeTab === 'writing' ? 'templateui col-lg-9' : ''">                 
                  <div *ngIf= "!showOpenHistory" class="d-flex content-align">
                    <span class="oliver_heading">Create Essays, Documents, Reports with Oliver</span>
                    <!-- Oliver Image Positioned Correctly -->
                    <div class="oliver-container">
                      <img src="assets/images/olivere-dog.svg" alt="Oliver" class="oliver-image">
                    </div>
                  </div>
                  <!-- Input Section -->
                  <div class="writing-card mt10">
                    <div class="form-group">
                      <input type="text" class="form-control input-lg oliver-input" [(ngModel)]="inputText" [ngModelOptions]="{standalone: true}"  (input)="validateInputText()" placeholder="Ask Me!">
                    </div>
                    <div class="oliver_text">Text Length</div>
                    <div class="input-group d-flex">
                      <select class="form-control oliver-focus" [(ngModel)]="selectedValueForWork"
                      (ngModelChange)="sortBy($event)" id="select-dropdown">
                        <option *ngFor="let option of sortOption.wordOptionsForOliver" [value]="option.value">
                          {{ option.name }}
                        </option>
                      </select>
                      <button class="btn btn-submit ml10" type="button" (click)="!isTextLoading && isValidInputText && generateChatGPTText()" [disabled]="isTextLoading || !isValidInputText">Submit</button>
                    </div>                    
                  </div>
                </div>
              </div>
              <!-- Ask PDF Tab -->
              <div role="tabpanel" [ngClass]="{'tab-pane fade in active': activeTab === 'askpdf', 'tab-pane fade': activeTab !== 'askpdf'}" id="askpdf">
                <!-- <div *ngIf="isCopyButtonDisplayed && activeTab === 'askpdf'" *ngFor="let msg of messages">
                  <ng-template [ngTemplateOutlet]="messageTemplate" [ngTemplateOutletContext]="{ data: msg }"></ng-template>
                </div>                 -->
                <span class="oliver_heading">Explore Assets, Tracks, and PlayBooks with Oliver</span>
                <div class="custom-card mt10">
                  <div class="upload-box">
                    <label>
                      <!-- <i class="glyphicon glyphicon-upload"></i> -->
                      <img src="assets/images/oliverUploadIcon.svg" width="40px" alt="pdficon">
                      Feed Me Digital Assets
                      <input type="file">
                    </label>
                  </div>
                  <div class="submit-section">
                    <img src="assets/images/olivere-dog.svg" width="80px" alt="Robot">
                    <button class="btn btn-submit">Submit</button>
                  </div>
                </div>
              </div>
              <!-- Paraphraser Tab -->
              <div role="tabpanel" [ngClass]="{'tab-pane fade in active': activeTab === 'paraphraser', 'tab-pane fade': activeTab !== 'paraphraser'}" id="paraphraser">
                <div class="header-text fs-22">Paraphraser – Rewrite Text Effortlessly With Oliver</div>
                <div class="phara-card">
                  <div class="content-area">
                    <div class="textarea-card clip-path1">
                      <textarea class="textarea h-350" [(ngModel)]="inputText" [ngModelOptions]="{standalone: true}"  (input)="validateInputText()"  placeholder="Feed Me Your Thoughts"></textarea>
                    </div>
                    <div class="oliver-container-img hidden-xs">
                      <img src="assets/images/olivere-dog.svg" width="50px" alt="Oliver">
                    </div>
                    <div class="textarea-card clip-path2 scrollable">
                      <div #markdownComponent class="padding-align">
                        <markdown [data]="chatGptGeneratedText"></markdown>
                      </div>
                      <textarea class="form-control border_0" id="chatGptGeneratedTextArea"  style="position: absolute; left: -9999px;" [(ngModel)]="chatGptGeneratedText" [ngModelOptions]="{standalone: true}" rows="18" readonly #chatGptGeneratedTextInput></textarea>
                    </div>
                  </div>
                  <div class="content-area">
                    <div class="generate-div w-50per mt10">
                      <button class="generate-btn" (click)="!isTextLoading && isValidInputText && generateChatGPTText()" [disabled]="isTextLoading || !isValidInputText">Generate</button>
                      <!-- <button *ngIf="isCopyButtonDisplayed" class="generate-btn ml10" (click)="copyChatGPTText(chatGptGeneratedTextInput)">Copy</button>
                      <button *ngIf="isCopyButtonDisplayed" class="generate-btn ml10" (click)="openEmailModalPopup(markdownComponent)">Send Email</button>
                      <button *ngIf="false" class="generate-btn ml10" (click)="copyChatGPTText(chatGptGeneratedTextInput)">Copy</button> -->
                    </div>
                    <div *ngIf="isCopyButtonDisplayed" class="w-50per mt10">
                      <div class="footer-icons phara-footer mt0">
                        <div class="footer-icon" title="{{!(isSpeakingText) ? 'Read aloud' : 'stop'}}" [ngStyle]="{'background-color': isSpeakingText  ? '#e40707' : '#0d6efd'}">
                          <i [ngClass]="(isSpeakingText) ? 'fas fa-volume-mute' : 'fa fa-volume-up fs-12'" aria-hidden="true"
                            (click)="speakTextForParaprasher(markdownComponent)">
                          </i>
                        </div>
                        <!-- <div class="footer-icon" title="Copy to Clipboard" (click)="copyChatGPTText(chatGptGeneratedTextInput)"><i class="fa fa-clone fs-12"></i></div> -->
                        <div class="footer-icon" [ngStyle]="{'background-color': isEmailCopied ? '#00FF13' : '#0d6efd'}">
                          <i data-toggle="tooltip" data-placement="top" [title]="isEmailCopied ? 'Copied to Clipboard' : 'Copy to Clipboard'" class="fs-12" [ngClass]="isEmailCopied ? 'fa fa-check' : 'fa fa-clone'"
                            (click)="!isEmailCopied && copyChatGPTText(chatGptGeneratedTextInput)" aria-hidden="true">
                          </i>
                        </div>
                        <!-- <div class="footer-icon" title=" Reload/Refresh"><i class="fa fa-refresh fs-12"></i></div> -->
                        <button class="share-btn"  (click)="openEmailModalPopup(markdownComponent)">Send Email</button>
                        <button class="share-btn" (click)="openSocialShare(markdownComponent)">Social Share</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- -add changes- -->
        </div>
          <!--  -->
        </div>
      </div>
      <!--Footer-->
      <!-- <div class="modal-footer">
          <button class="btn btn-danger close-button" (click)="resetValues()" data-dismiss="modal">Close</button>
      </div> -->
    </div>
  </div>
</div>
<app-add-email-modal-popup *ngIf="showEmailModalPopup"[actionType]="actionType" [subjectText]="subjectText" [emailBody]="emailBody" (notifyClose)="closeEmailModalPopup($event)"></app-add-email-modal-popup>
<ng-template #messageTemplate let-message="data" let-index="index" >
    <div class="message user" *ngIf="message.role === 'user'">
      <div class="summarize-card">{{ message.content }}</div>
      <div class="avatar">
        <img src="assets/images/icon-user-default.png" alt="User" class="avatar">
      </div>
    </div>
    <div class="d-flex" *ngIf="message.role === 'assistant'">
      <div class="avatar1 col-lg-1 col-sm-1 mb_p0">
        <img src="assets/images/olivermsglogo.svg" alt="Assistant" class="avatar">
      </div>
      <div class="col-lg-11 col-sm-11">
        <div class="content-card">
          <div class="chat-container">
            <div #markdownComponent class="chat-history">
              <markdown [data]="message.content"></markdown>
            </div>
          </div>
        </div>
        <div class="footer-icons mb10">
          <div class="footer-icon" title="{{!(isSpeakingText && speakingIndex === index) ? 'Read aloud' : 'stop'}}">
            <i [ngClass]="(isSpeakingText && speakingIndex === index) ? 'fas fa-volume-mute' : 'fa fa-volume-up fs-12'"
              aria-hidden="true" (click)="speakTextOn(index,markdownComponent)">
            </i>
          </div>
          <div class="footer-icon" title="Copy to Clipboard"><i class="fa fa-clone fs-12"
              (click)="copyChatGPTText(message.content)"></i></div>
          <!-- <div class="footer-icon" title="Reload/Refresh"><i class="fa fa-refresh fs-12"></i></div>
          <button class="share-btn">Design Template</button>
          <button class="share-btn">Design Page</button> -->
          <button class="share-btn" (click)="openEmailModalPopup(markdownComponent)">Send Email</button>
          <button class="share-btn" (click)="openSocialShare(markdownComponent)">Social Share</button>
        </div>
      </div>
    </div>
</ng-template>
<ng-template #assistantLoader>
  <div class="d-flex aligin-center">
    <div class="avatar1 col-lg-1 col-sm-1">
      <img src="assets/images/olivermsglogo.svg" alt="Assistant" class="avatar">
    </div>
    <div class="col-lg-11 col-sm-11">
      <div class="assitLoader"></div>
    </div>
  </div>
</ng-template>

