<style type="text/css">
  .disabled {
  pointer-events: none;
  cursor: not-allowed !important;
  }
</style>
<ngx-loading [show]="ngxloading" [config]="{ backdropBorderRadius: '14px' }"></ngx-loading>
<div style="position: relative; top:-10px;">
  <app-response-message [customResponse]="customResponse" *ngIf="customResponse.isVisible"></app-response-message>
</div>
<div class="row">
  <div class="col-md-12">
    <div class="tabbable tabbable-custom tabbable-noborder">
      <div class="tab-content">
        <div class="page-bar m10">
          <ul class="mix-filter col-xs-12 col-sm-12 col-md-6 p0 m0">
            <li class="filter" (click)="filterCampaigns('all')" [class.active]="'all' == campaignType">
            All</li>
            <li class="filter" (click)="filterCampaigns('regular')" [class.active]="'regular' == campaignType" *ngIf="campaignAccess.emailCampaign">Email</li>
            <li class="filter" (click)="filterCampaigns('video')" [class.active]="'video' == campaignType" *ngIf="campaignAccess.videoCampaign">Video</li>
            <li class="filter"  (click)="filterCampaigns('social')" [class.active]="'social' == campaignType" *ngIf="campaignAccess.socialCampaign">Social
            </li>
            <li class="filter"  (click)="filterCampaigns('event')" [class.active]="'event' == campaignType" *ngIf="campaignAccess.eventCampaign">Event</li>
            <li class="filter"  (click)="filterCampaigns('survey')" [class.active]="'survey' == campaignType" *ngIf="campaignAccess.survey">Survey</li>
            <li class="filter" style="display: none;">Own Template</li>
          </ul>
          <div class="page-toolbar col-xs-12 col-sm-12 col-md-6">
            <div class="row btn-group pull-right">
              <div class="col-xs-4 col-sm-4 col-md-3 hidden-xs">
                <div>
                  <ng-container class='m10'>
                    <button class="btn btn-xs hidden-xs l-g-view zero-margin-xamp-campaign" [disabled]="this.modulesDisplayType.isListView"   (click)="setViewType('List')" title="List View">
                    <i class="fa fa-th-list p10" aria-hidden="true"></i>
                    </button>
                    <button class="btn btn-xs hidden-xs l-g-view" [disabled]="this.modulesDisplayType.isGridView"  (click)="setViewType('Grid')" title="Grid View">
                    <i class="fa fa-th-large p10" aria-hidden="true"></i>
                    </button>
                  </ng-container>
                </div>
              </div>
              <div class="col-xs-6 col-sm-4 col-md-4 p0">
                <div style="float: left;">
                  <select class="form-control" [(ngModel)]="selectedSortedOption" (ngModelChange)="getSortedResult($event)" style="position: relative;right: -3px;">
                  <option *ngFor="let sortOption of sortByDropDown" [ngValue]="sortOption">
                  {{sortOption.name}}</option>
                  </select>
                </div>
              </div>
              <div class="col-xs-6 col-sm-4 col-md-4 p0">
                <div class="portlet-input input-inline input-small">
                  <div class="input-icon right" style="position: relative;right: -11px;">
                    <input type="text" [(ngModel)]="searchKey" [ngModelOptions]="{standalone: true}" class="form-control" placeholder="Search..." (keypress)="eventHandler($event.keyCode)">
                    <button class="glyphicon glyphicon-remove search-box-item-clear" *ngIf="searchKey" (click)="searchKey=''"></button>
                    <button type="submit" class="search-box-item-click" (click)="searchCampaigns()"><i class="fa fa-search"></i></button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <app-grid-loader *ngIf="httpRequestLoader.isLoading && this.modulesDisplayType.isGridView"></app-grid-loader>
        <app-list-loader *ngIf="httpRequestLoader.isLoading && this.modulesDisplayType.isListView"></app-list-loader>
        <section class='m10' *ngIf="this.modulesDisplayType.isListView && totalRecords > 0 && !httpRequestLoader.isLoading && !httpRequestLoader.isServerError">
          <div class="table-responsive" style="border:none">
            <table class='table tgrid table-hover table-sm' id="redistribute-campaign-list">
              <thead>
                <tr>
                  <th colspan="2" style="width: 30%">
                    <span class="ui-column-resizer gray" (mousedown)="referenceService.onMouseDown($event,'redistribute-campaign-list',2)"> </span>
                    <span class="gridHeader">Campaign</span>
                  </th>
                  <th class="custom-center hidden-xs">Vendor Company Name</th>
                  <th class="custom-center hidden-xs">Status</th>
                  <th class="custom-center">Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor='let campaign of pagination.pagedItems; let i=index'>
                  <td style="width: 10%;" class="hidden-xs">
                    <img class="imageClass" *ngIf="campaign.campaignType.indexOf('VIDEO') > -1 && campaign.launched " src="assets/images/video-email.png" style="height: 50px;" alt="{{campaign.campaignType}} Campaign">
                    <img class="imageClass" *ngIf="campaign.campaignType.indexOf('VIDEO') > -1 && !campaign.launched " src="assets/images/video-email.png" style="height: 50px;-webkit-filter: grayscale(100%);filter: grayscale(100%);" alt="{{campaign.campaignType}} Campaign">
                    <img class="imageClass" *ngIf="campaign.campaignType.indexOf('REGULAR') > -1 && campaign.launched" src="assets/images/regular-email.png" style="height: 50px;" alt="{{campaign.campaignType}} Campaign">
                    <img *ngIf="campaign.campaignType.indexOf('REGULAR') > -1 && !campaign.launched" src="assets/images/regular-email.png" style="height: 50px;-webkit-filter: grayscale(100%);filter: grayscale(100%);" alt="{{campaign.campaignType}} Campaign">
                    <img class="imageClass" *ngIf="campaign.campaignType.indexOf('SOCIAL') > -1 && campaign.launched" src="assets/images/social-campaign.png" style="height: 50px;" alt="{{campaign.campaignType}} Campaign">
                    <img class="imageClass" *ngIf="campaign.campaignType.indexOf('SOCIAL') > -1 && !campaign.launched" src="assets/images/social-campaign.png" style="height: 50px;-webkit-filter: grayscale(100%);filter: grayscale(100%);" alt="{{campaign.campaignType}} Campaign">
                    <img class="imageClass" *ngIf="campaign.campaignType.indexOf('EVENT') > -1 && campaign.launched" src="assets/images/event-campaign.png" style="height: 50px;" alt="{{campaign.campaignType}} Campaign">
                    <img class="imageClass" *ngIf="campaign.campaignType.indexOf('EVENT') > -1 && !campaign.launched" src="assets/images/event-campaign.png" style="height: 50px;-webkit-filter: grayscale(100%);filter: grayscale(100%);" alt="{{campaign.campaignType}} Campaign">
                    <img class="imageClass" *ngIf="campaign.campaignType.indexOf('LANDINGPAGE') > -1 && campaign.launched" src="assets/images/landing-page.png" style="height: 50px;" alt="{{campaign.campaignType}} Campaign">
                    <img class="imageClass" *ngIf="campaign.campaignType.indexOf('LANDINGPAGE') > -1 && !campaign.launched" src="assets/images/landing-page.png" style="height: 50px;-webkit-filter: grayscale(100%);filter: grayscale(100%);" alt="{{campaign.campaignType}} Campaign">
                    <img class="imageClass" *ngIf="campaign.campaignType.indexOf('SURVEY') > -1 && campaign.launched" src="assets/images/survey.png" style="height: 50px;" alt="{{campaign.campaignType}} Campaign">
                    <img class="imageClass" *ngIf="campaign.campaignType.indexOf('SURVEY') > -1 && !campaign.launched" src="assets/images/survey.png" style="height: 50px;-webkit-filter: grayscale(100%);filter: grayscale(100%);" alt="{{campaign.campaignType}} Campaign">
                  </td>
                  <td>
                    <h4 class="moreipsis mt5 mb5 f-w-600" style="font-size: 14px;" title="{{campaign.campaignName}}">
                      <span>{{campaign.campaignName}}</span>
                    </h4>
                    <h5 class="moreipsis mobile-left" [title]="campaign.createdBy">
                      <span> By <b>{{campaign.createdBy}}</b></span>
                    </h5>
                    <h5 class="moreipsis mobile-left" [title]="campaign.companyName">
                      <span> From <b>{{campaign.companyName}}</b></span>
                    </h5>
                    <h5 class="moreipsis mobile-left" [title]="campaign.categoryName">
                      <span> Folder <b>{{campaign.categoryName}}</b></span>
                    </h5>
                    <h5 class="ellipsis view-banner" *ngIf="campaign.launched && !campaign.showCancelButton && campaign.campaignType.indexOf('EVENT') > -1" style="background-color: red;">Cancelled</h5>
                  </td>
                  <td class="moreipsis custom-center hidden-xs">
                    <span><b>{{campaign.companyName}}</b></span>
                  </td>
                  <td class="custom-center hidden-xs">
                    <span align="right">
                    <b>Received On</b>
                    </span>
                    <span align="right" title="Received On"><b>
                    <app-timestamp [isOnlyDate]="false"
                    [dateAndTime]="campaign.displayTime"> </app-timestamp>
                    </b>
                    </span>
                  </td>
                  <td>
                    <div class="actions-block override-actions" style="text-align: center !important;">
                      <a *ngIf="campaign.campaignType !== 'SOCIAL'" (click)="showCampaignPreview(campaign)" data-toggle="tooltip" data-placement="top" title="Preview Campaign">
                      <i class="fa fa-eye mr5"></i>
                      </a>
                      <a *ngIf="campaign.campaignType == 'SOCIAL'" (click)="showSocialCampaignPreview(campaign)" data-toggle="tooltip" data-placement="top" title="Preview Campaign">
                      <i class="fa fa-eye mr5"></i>
                      </a>
                      <span>
                        <ng-container *ngIf="campaign.allowRedistribution">
                          <a *ngIf="campaign.campaignType != 'EVENT' && !campaign.ended"
                          (click)="reDistributeCampaign(campaign)"
                          data-toggle="tooltip" data-placement="top"
                          title="Redistribute Campaign" data-rel="fancybox-button">
                          <i class="fa fa-clone"></i>
                          </a>
                          <a *ngIf="campaign.campaignType != 'EVENT' && campaign.ended"
                            data-toggle="tooltip" data-placement="top"
                            title="Campaign can not be further redistributed" data-rel="fancybox-button">
                            <i class="fa fa-clone cancelled-event" aria-hidden="true"></i>
                            </a>
                          <a *ngIf="campaign.campaignType === 'EVENT' && campaign.showCancelButton"
                          (click)="reDistributeCampaign(campaign)"
                          data-toggle="tooltip" data-placement="top"
                          title="Redistribute Campaign" data-rel="fancybox-button">
                          <i class="fa fa-clone"></i>
                          </a>
                          <a *ngIf="campaign.campaignType === 'EVENT' && !campaign.showCancelButton"
                            data-toggle="tooltip" data-placement="top"
                            title="Not available for cancelled event"
                            data-rel="fancybox-button">
                          <i class="fa fa-clone cancelled-event"></i>
                          </a>
                        </ng-container>
                        <ng-container *ngIf="!campaign.allowRedistribution">
                          <a data-toggle="tooltip" data-placement="top"
                            title="{{campaign?.redistibuteToolTipMessage}}"
                            data-rel="fancybox-button">
                          <i class="fa fa-clone cancelled-event"></i>
                          </a>
                        </ng-container>
                        <ng-container class="pull-right"
                          *ngIf="campaign.campaignType === 'REGULAR' || campaign.campaignType === 'VIDEO' || (campaign.campaignType === 'EVENT' && campaign.publicEventCampaign && campaign.showCancelButton) || campaign.campaignType === 'LANDINGPAGE'">
                          <div class="btn-group pull-right" id="download-template"
                            *ngIf="campaign.allowDownload" title="Download">
                            <span
                              class="glyphicon glyphicon-download-alt dropdown-toggle gearDropdownMenu" 
                              data-toggle="dropdown" id="download-drop" title="Download"></span>
                            <span data-toggle="dropdown" title="Download"></span>
                            <ul class="dropdown-menu pull-right">
                              <li>
                                <a (click)="downloadFile(campaign,'html')" data-toggle="tooltip" data-placement="top" title="Download Html" data-rel="fancybox-button"
                                  >
                                <i class="fa fa-file" style="width: 30px;"></i> Download Html
                                </a>
                              </li>
                              <li *ngIf="campaign.campaignType != 'EVENT'">
                                <a (click)="downloadFile(campaign,'pdf')" data-toggle="tooltip" data-placement="top" title="Download Pdf" data-rel="fancybox-button"
                                  >
                                <i class="fa fa-file-pdf-o" style="width: 30px;"></i> Download Pdf
                                </a>
                              </li>
                            </ul>
                          </div>
                          <a *ngIf="!campaign.allowDownload" data-toggle="tooltip" data-placement="top" title="Please turn on GDPR settings to download" data-rel="fancybox-button">
                          <i class="fa fa-download cancelled-event"></i>
                          </a>
                           <a data-toggle="tooltip" data-placement="top" (click)="viewDownloadedHistory(campaign)" title="View Download History" data-rel="fancybox-button">
                            <i class="fa fa-history" aria-hidden="true"></i>
                            </a>
                        </ng-container>
                      </span>
                      <a class="hidden"><i class="fa fa-trash"></i></a>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>
        <div *ngIf="totalRecords <= 0 && this.modulesDisplayType.isListView" class="alert alert-info">
          <strong>No campaigns found</strong>
        </div>
        <div class="tab-pane active" *ngIf="this.modulesDisplayType.isGridView">
          <div class="margin-top-10">
            <div class="row mix-grid p10">
              <app-loader *ngIf="httpRequestLoader.isLoading"></app-loader>
              <ng-container *ngIf="totalRecords > 0 && !httpRequestLoader.isLoading && !httpRequestLoader.isServerError">
                <div *ngFor="let campaign of pagination.pagedItems; let i= index" class="col-xs-12 col-sm-4 col-lg-3">
                  <div class="grid-box">
                    <img src="https://cdn2.iconfinder.com/data/icons/facebook-ads-1/204/1-48.png">
                    <!-- <br> -->
                    <h4 class="ellipsis" title="{{campaign.campaignName}}">
                      {{campaign.campaignName | slice:0:25}}
                      <span *ngIf="campaign.campaignName?.length>25">...</span>
                    </h4>
                    <!-- <span class="view-banner" *ngIf="campaign.launched && !campaign.showCancelButton && campaign.campaignType.indexOf('EVENT') > -1" style="background-color: red;">Cancelled</span> -->
                    <h6 [title]="campaign.createdBy">By
                      <b>{{campaign.createdBy | slice:0:15}}<span
                        *ngIf="campaign.createdBy?.length>15">...</span></b>
                    </h6>
                    <h6 [title]="campaign.companyName">From
                      <b>{{campaign.companyName | slice:0:15}}
                      <span *ngIf="campaign.companyName?.length>15">...</span>
                      </b>
                    </h6>
                    <h6 [title]="campaign.categoryName">Folder
                      <b>{{campaign.categoryName | slice:0:15}}
                      <span *ngIf="campaign.categoryName?.length>15">...</span>
                      </b>
                    </h6>
                    <h6>Received On <b>
                      <app-timestamp [isOnlyDate]="false"
                      [dateAndTime]="campaign.displayTime"> </app-timestamp>
                      </b>
                    </h6>
                    <div class="bookmark-ribbon">
                      <span style="margin: 0px -7px; font-size: 17px; color: white;">
                      <i *ngIf="campaign.campaignType.indexOf('VIDEO') > -1"
                        class="fa fa-video-camera" aria-hidden="true"></i>
                      <i *ngIf="campaign.campaignType.indexOf('REGULAR') > -1"
                        class="fa fa-envelope" aria-hidden="true"></i>
                      <i *ngIf="campaign.campaignType.indexOf('SOCIAL') > -1"
                        class="fa fa-globe" aria-hidden="true"></i>
                      <i *ngIf="campaign.campaignType.indexOf('EVENT') > -1"
                        class="fa fa-calendar" aria-hidden="true"></i>
                      <i *ngIf="campaign.campaignType.indexOf('LANDINGPAGE') > -1"
                        class="fa fa-wpforms" aria-hidden="true"></i>
                      <i *ngIf="campaign.campaignType.indexOf('SURVEY') > -1"
                        class="fa fa-wpforms" aria-hidden="true"></i>
                      </span>
                    </div>
                    <div class="ribbon">
                      <div class="cancel-ribbon" *ngIf="campaign.launched && !campaign.showCancelButton && campaign.campaignType.indexOf('EVENT') > -1">
                        Cancelled
                      </div>
                    </div>
                    <div class="bar">
                      <a *ngIf="campaign.campaignType != 'SOCIAL'" (click)="showCampaignPreview(campaign)" data-toggle="tooltip" data-placement="top" title="preview campaign">
                      <i class="fa fa-eye mr4" aria-hidden="true"></i>
                      </a>
                      <a *ngIf="campaign.campaignType == 'SOCIAL'" (click)="showSocialCampaignPreview(campaign)" data-toggle="tooltip" data-placement="top" title="Preview Campaign">
                      <i class="fa fa-eye mr5" aria-hidden="true"></i>
                      </a>
                      <ng-container *ngIf="campaign.allowRedistribution">
                        <a *ngIf="campaign.campaignType != 'EVENT'  && !campaign.ended" (click)="reDistributeCampaign(campaign)" data-toggle="tooltip" data-placement="top" title="Redistribute Campaign" data-rel="fancybox-button">
                        <i class="fa fa-clone"></i>
                        </a>
                        <a *ngIf="campaign.campaignType != 'EVENT' && campaign.ended" 
                          data-toggle="tooltip" data-placement="top" title="Campaign can not be further redistributed" data-rel="fancybox-button">
                          <i class="fa fa-clone cancelled-event"></i>
                          </a>
                        <a *ngIf="campaign.campaignType === 'EVENT' && campaign.showCancelButton" (click)="reDistributeCampaign(campaign)" data-toggle="tooltip" data-placement="top" title="Redistribute Campaign" data-rel="fancybox-button">
                        <i class="fa fa-clone"></i>
                        </a>
                        <a *ngIf="campaign.campaignType === 'EVENT' && !campaign.showCancelButton" data-toggle="tooltip" data-placement="top" title="Not available for cancelled event" data-rel="fancybox-button">
                        <i class="fa fa-clone" style="cursor:not-allowed"></i>
                        </a>
                      </ng-container>
                      <ng-container *ngIf="!campaign.allowRedistribution">
                        <a data-toggle="tooltip" data-placement="top" title="{{campaign?.redistibuteToolTipMessage}}" data-rel="fancybox-button">
                        <i class="fa fa-clone cancelled-event"></i>
                        </a>
                      </ng-container>
                      <ng-container class="pull-right" *ngIf="campaign.campaignType === 'REGULAR' || campaign.campaignType === 'VIDEO' || (campaign.campaignType === 'EVENT' && campaign.publicEventCampaign && campaign.showCancelButton) || campaign.campaignType === 'LANDINGPAGE'">
                        <div class="btn-group" id="download-template-grid" *ngIf="campaign.allowDownload">
                          <span class="glyphicon glyphicon-download-alt dropdown-toggle gearDropdownMenu" data-toggle="dropdown" id="download-drop" style="color:white;" title="Download"></span>
                          <span data-toggle="dropdown" title="Download"></span>
                          <ul class="dropdown-menu pull-right">
                            <li>
                              <a (click)="downloadFile(campaign,'html')" data-toggle="tooltip" data-placement="top" data-rel="fancybox-button" title="Download Html">
                              <i class="fa fa-file" style="width: 30px;"></i> Download Html
                              </a>
                            </li>
                            <li *ngIf="campaign.campaignType != 'EVENT'">
                              <a (click)="downloadFile(campaign,'pdf')" data-toggle="tooltip" data-placement="top" data-rel="fancybox-button" title="Download Pdf">
                              <i class="fa fa-file-pdf-o" style="width: 30px;"></i> Download Pdf
                              </a>
                            </li>
                          </ul>
                        </div>
                        <a *ngIf="!campaign.allowDownload" data-toggle="tooltip" data-placement="top" title="Please turn on GDPR settings to download" data-rel="fancybox-button">
                        <i class="fa fa-download cancelled-event"></i>
                        </a>
                        
                         <a data-toggle="tooltip" data-placement="top" (click)="viewDownloadedHistory(campaign)" title="View Download History" data-rel="fancybox-button">
                            <i class="fa fa-history" aria-hidden="true"></i>
                            </a>
                      </ng-container>
                      <!-- <a (click)="referenceService.downloadTemplate(campaign.campaignId)" *ngIf="campaign.campaignType === 'REGULAR' || campaign.campaignType === 'VIDEO' || campaign.campaignType === 'EVENT'" 
                        data-toggle="tooltip" data-placement="top" title="Download Template" data-rel="fancybox-button" >
                        <i class="fa fa-download"></i>
                        </a> -->
                    </div>
                  </div>
                </div>
              </ng-container>
            </div>
          </div>
          <!-- End of 24 -->
          <div *ngIf="totalRecords <= 0 && this.modulesDisplayType.isGridView &&  !httpRequestLoader.isLoading && !httpRequestLoader.isServerError" class="alert alert-info">
            <strong>No campaigns found</strong>
          </div>
        </div>
        <ng-container *ngIf="this.modulesDisplayType.isListView || this.modulesDisplayType.isGridView">
          <div [hidden]="totalRecords <= 0 || httpRequestLoader.isLoading || httpRequestLoader.isServerError" style="background:white">
            <div *ngIf="pagination.pagedItems.length !== 0">
              <app-pagination [pagination]="pagination" [type]="'campaign'" (notifyParent)="setPage($event)" (notifyParentDropDown)="getAllFilteredResults($event)">
              </app-pagination>
            </div>
          </div>
        </ng-container>
      </div>
      <!-- End Of tab Content -->
    </div>
  </div>
</div>
<div class="modal right fade" id="email_template_preivew" data-backdrop="static">
  <div class="modal-dialog modal-lg modal-template" style="right:0">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close-circle" data-dismiss="modal" aria-hidden="true">
        <i class="fa fa-times"></i>
        </button>
        <h4 class="modal-title">{{campaignName}}</h4>
      </div>
      <div class="modal-body">
        <div id="email-template-content">
        </div>
        <app-modal-popup-loader *ngIf="loadingEmailTemplate"></app-modal-popup-loader>
      </div>
      <div class="modal-footer">
        <a href="javascript:void(0)" data-dismiss="modal" class="btn btn-default" style="float: right">Close</a>
      </div>
    </div>
  </div>
</div>
<div class="modal right fade" id="social-campaign-preview" data-backdrop="static">
  <div class="modal-dialog modal-lg modal-template" style="right:0">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close-circle" data-dismiss="modal" aria-hidden="true">
        <i class="fa fa-times" aria-hidden="true"></i>
        </button>
        <h4 class="modal-title">{{campaignName}}</h4>
      </div>
      <div class="modal-body">
        <ng-container *ngIf="!socialAccountsLoader">
          <ng-container  *ngIf="socialCampaign?.socialStatusList?.length>0">
            <div class="col-md-6 col-sm-12 col-xs-12" *ngFor="let socialStatus of socialCampaign?.socialStatusList">
              <app-social-status [socialStatus]="socialStatus"></app-social-status>
            </div>
          </ng-container>
          <ng-container *ngIf="socialCampaign?.socialStatusList?.length==0">
            <div class="alert alert-info">
              <strong>No Social Accounts Found</strong>
            </div>
          </ng-container>
        </ng-container>
        <app-landing-page-loader *ngIf="socialAccountsLoader" [maxBoxLength]=2></app-landing-page-loader>
      </div>
      <div class="modal-footer">
        <a href="javascript:void(0)" data-dismiss="modal" class="btn btn-default" style="float: right">Close</a>
      </div>
    </div>
  </div>
</div>
<!-- <div *ngIf="totalRecords <= 0"  class="alert alert-info"><strong>No Campaigns Found</strong></div> -->
<app-scroll-top></app-scroll-top>
<app-preview-landing-page #previewLandingPageComponent></app-preview-landing-page>
<app-add-more-receivers #addMoreReceivers></app-add-more-receivers>
<app-campaign-template-download-history #campaignTemplateDownloadHistoryComponent></app-campaign-template-download-history>