<div class="page-content">
    <div class="page-bar">
        <ul class="page-breadcrumb">
            <li><i class="fa fa-home"></i> <a routerLink="/home/dashboard/default">Home</a><i class="fa fa-angle-right"></i></li>
            <li><i class="fa fa-rss"></i>RSS</li>
        </ul>
    </div>
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <div class="row">
                <app-left-nav [refreshTime]="rssService.refreshTime"></app-left-nav>
                <div class="col-xs-12 col-sm-8 col-md-9 col-lg-9">
                    <div class="page-bar page-bar-shadow pb-m" style="box-shadow: 0px 5px 5px 5px #eae9e9;">
                        <div class="portlet light" style="border-color: #fff !important;">
                            <div class="portlet-body">
                                <h4 class="description">Discover the best sources for any topic</h4>
                                <div class="form-group has-feedback has-search">
                                    <span class="glyphicon glyphicon-search"></span>
                                    <span class="glyphicon glyphicon-remove" (click)="clearSearch()" *ngIf="searchValue"></span>
                                    <input type="text" [(ngModel)]="searchValue" value="{{searchValue}}" class="form-control" placeholder="Search by Topic , Website or RSS Link" 
                                    (keyup.enter)="navigateSearchPage(searchValue)" style="padding: 20px;padding-left: 49px">
                                </div>
                                <p *ngIf="errorMessage">{{errorMessage}}</p>
                                <p *ngIf="!loading && searchResponse?.statusCode !== 8105">We couldn't find any results matching this search.</p>
                                <app-rss-loader *ngIf="loading"></app-rss-loader>
                                <div *ngIf="searchResponse?.statusCode === 8105">
                                    <div *ngFor="let item of searchResponse.data">
                                        <div class="panel panel-default">
                                            <div class="panel-body">
                                                <div class="col-xs-2">
                                                    <img src="{{item.imageUrl}}" (error)="rssService.errorHandlerImage($event)" style="margin: 2rem; width: 60px">
                                                </div>
                                                <div class="col-xs-10">
                                                    <div class="clearfix">
                                                        <div class="w50">
                                                            <h1 class="heading">{{item.title}}</h1>
                                                        </div>
                                                        <div class="w50">
                                                            <section class="pull-right">
                                                                <div class="btn-group pull-right">
                                                                    <button role="button" class="btn" (click)="popoverToggle(item.id)" data-placement="bottom" id="example_{{item.id}}" rel="popover" 
                                                                      data-container="body" [ngClass]="{'btn-primary': item.addedToCollection, 'btn-secondary': !item.addedToCollection}" aria-haspopup="true" aria-expanded="false">
                                                                        <span *ngIf="!item.addedToCollection">Follow</span>
                                                                        <span *ngIf="item.addedToCollection">Following</span>
                                                                    </button>                                                                    
                                                                </div>
                                                                <div class="bs-example-popover" id="popover{{item.id}}" style="display: none">
                                                                        <div class="popover bottom">
                                                                            <div class="arrow"></div>
                                                                            <div class="popover-content p10">
                                                                              <ul class="list-group m0" id="popover_{{item.id}}">
                                                                                  <li class="list-group-item" *ngIf="item.addNewCategory">
                                                                                    <form>
                                                                                    <div class="form-group">
                                                                                        <label for="customCollectionName">Feed name</label>
                                                                                        <input type="text" #customCollectionName class="form-control" id="customCollectionName" aria-describedby="emailHelp" placeholder="e.g. Tech" autocomplete="off">
                                                                                    </div>
                                                                                    <button class="btn btn-primary" (click)="followSource(customCollectionName.value, item.id)">Submit</button>
                                                                                    <button (click)="item.addNewCategory = false" class="btn btn-secondary">Cancel</button>
                                                                                    </form>
                                                                                  </li>
                                                                                <ng-container *ngIf="!item.addNewCategory">
                                                                                  <li class="list-group-item" *ngFor="let collectionName of item.collectionNames">
                                                                                      <a><i class="fa fa-rss" aria-hidden="true"></i> {{collectionName}} 
                                                                                        <button class="btn-xs pull-right" (click)="followSource(collectionName, item.id)">Add</button>
                                                                                      </a>
                                                                                  </li>
                                                                                  <li class="list-group-item" *ngFor="let category of item.categories">
                                                                                      <a><i class="fa fa-rss" aria-hidden="true"></i> {{category.title}} 
                                                                                        <button class="btn-xs pull-right" (click)="followSource(category.title, item.id)">Add</button>
                                                                                      </a>
                                                                                  </li>
                                                                                  <li class="list-group-item" *ngFor="let collection of item.collections">
                                                                                      <a><i class="fa fa-rss" aria-hidden="true"></i> {{collection.title}} 
                                                                                        <button class="btn-xs pull-right" (click)="removeSourceFromCollection(item.companySourceId, collection.id)">Remove</button>
                                                                                      </a>
                                                                                  </li>
                                                                                  <li class="list-group-item"><a (click)="item.addNewCategory = true"><i class="fa fa-plus" aria-hidden="true"></i> New Collection</a></li>
                                                                                </ng-container>
                                                                              </ul>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                            </section>
                                                        </div>
                                                    </div>
                                                    <p>{{item.description}}</p>
                                                    <ul>
                                                        <ng-container *ngFor="let feed of item.feeds; let i=index">
                                                            <li *ngIf="i<5">{{feed.title}}}</li>
                                                        </ng-container>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>