<ngx-loading [show]="loading" [config]="{ backdropBorderRadius: '14px' }"></ngx-loading>
<div class="page-content">
   <div class="page-bar">
      <ul class="page-breadcrumb">
         <li><i class="fa fa-home" aria-hidden="true"></i> <a translate>Home</a> 
            <i class="fa fa-angle-right" aria-hidden="true"></i>
         </li>
         <li><a translate>MDF</a> <i class="fa fa-angle-right" aria-hidden="true"></i> </li>
         <li><a translate>Manage MDF Details</a></li>
      </ul>
      <div class="edit-mdf-form-margin">
         <!-- <button class="add-button-xamplify" id="right" (click)="editMdfForm()" translate>Edit MDF Form</button> -->
     </div>
   </div>
   <div class="row">
      <div class="col-md-12 col-lg-12">
         <div class="portlet light" style=" height:163px;">
            <div class="row" style="margin-top: 20px;">
               <app-box-loader [countLoader]=4 *ngIf="tilesLoader"></app-box-loader>
               <div *ngIf="!tilesLoader" class="col-md-12 col-lg-12" style="padding-left: 24px;padding-right: 30px;">
                  <div class="row">
                     <div title="Click to see details" class="col-sm-3 col-xs-6 col-lg-3 col-md-3">
                        <a class="dashboard-stat dashboard-stat-lighter blue-soft">
                           <div class="visual">
                              <i aria-hidden="true" class=""></i>
                           </div>
                           <div class="details">
                              <div class="number">{{tileData?.totalPartners}}</div>
                              <div class="desc">Total Partners</div>
                           </div>
                           <span class="morePadding">
                        <a  translate="" ng-reflect-translate="" class="more"> Detailed view 
                        <i  aria-hidden="true" class="m-icon-swapright m-icon-white"></i></a>
                        </span>
                        </a>
                     </div>
                     <div title="Click to see details" class="col-sm-3 col-xs-6 col-lg-3 col-md-3">
                        <a class="dashboard-stat dashboard-stat-lighter green-soft">
                           <div class="visual">
                              <i aria-hidden="true" class=""></i>
                           </div>
                           <div class="details">
                              <div class="number">${{tileData?.totalBalance | number:'1.2-2':'en-US'}}</div>
                              <div class="desc">Total MDF Balance</div>
                           </div>
                           <span class="morePadding">
                        <a  translate="" ng-reflect-translate="" class="more"> Detailed view 
                        <i  aria-hidden="true" class="m-icon-swapright m-icon-white"></i></a>
                        </span>
                        </a>
                     </div>
                     <div title="Click to see details" class="col-sm-3 col-xs-6 col-lg-3 col-md-3">
                        <a class="dashboard-stat dashboard-stat-lighter purple-soft">
                           <div class="visual">
                              <i aria-hidden="true" class=""></i>
                           </div>
                           <div class="details">
                              <div class="number">${{tileData?.usedBalance | number:'1.2-2':'en-US'}}</div>
                              <div class="desc">Total Used Balance</div>
                           </div>
                           <span class="morePadding">
                        <a  translate="" ng-reflect-translate="" class="more">Detailed view  
                        <i  aria-hidden="true" class="m-icon-swapright m-icon-white"></i></a>
                        </span>
                        </a>
                     </div>
                     <div title="Click to see details" class="col-sm-3 col-xs-6 col-lg-3 col-md-3">
                        <a class="dashboard-stat dashboard-stat-lighter yellow-gold">
                           <div class="visual">
                              <i aria-hidden="true" class=""></i>
                           </div>
                           <div class="details">
                              <div class="number">${{tileData?.availableBalance | number:'1.2-2':'en-US'}}</div>
                              <div class="desc">Total Available Balance</div>
                           </div>
                           <span class="morePadding">
                        <a  translate="" ng-reflect-translate="" class="more">Detailed view
                        <i  aria-hidden="true" class="m-icon-swapright m-icon-white"></i></a>
                        </span>
                        </a>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
   <div class="row">
      <div class="portlet box">
         <div class="clearfix">
            <div class="col-xs-12">
               <!-- BEGIN EXAMPLE TABLE PORTLET-->
               <div class="portlet box blue">
                  <div class="portlet-title">
                     <div class="caption" translate>
                        <i class="fa fa-list" style="font-size: 19px;" aria-hidden="true"></i>
                        Manage MDF Details
                     </div>
                     <div class="inputs" align="right" style="float: right; padding: 4px">
                        <div style="float: left; margin: 0 10px;">
                          <select class="form-control" [(ngModel)]="sortOption.mdfPartnersSortOption" (ngModelChange)="sortBy($event)" id="select-dropdown">
                            <option *ngFor="let option of sortOption.mdfPartnersSortDropDownOptions"
                                [ngValue]="option" translate>
                                {{option.name}}</option>
                        </select>
                        </div>
                        <div class="portlet-input input-inline">
                           <div class="input-icon right">
                              <input type="text" id="sort-text" class="form-control" [(ngModel)]="sortOption.searchKey" [ngModelOptions]="{standalone: true}" placeholder="Search for a partner" (keypress)="eventHandler($event.keyCode)">
                              <button class="glyphicon glyphicon-remove search-box-item-clear"  *ngIf="sortOption.searchKey" (click)="sortOption.searchKey='';searchPartners();"></button>
                              <button type="submit" class="search-box-item-click" (click)="searchPartners()"><i class="fa fa-search" style="color:black !important" aria-hidden="true"></i></button>
                           </div>
                        </div>
                     </div>
                  </div>
                  <app-list-loader *ngIf="partnerListLoader.isLoading"></app-list-loader>
                  <div class="portlet-body table-responsive" style="overflow: hidden;" *ngIf="!partnerListLoader.isLoading">
                     <div class="btn-group pull-right" style="margin-bottom: 10px; left: -16px;">
                        <div class="inputs" align="right" style="float: right"></div>
                     </div>
                     <div class="clearfix">
                        <div class="col-xs-12" style="padding: 10px 0;">
                           <div class="table-responsive">
                              <table class='table tgrid' aria-describedby="manage-mdf-fund-table">
                                 <thead>
                                    <tr>
                                       <th style="width: 23%;" translate>Partner Info</th>
                                       <th class="hidden-xs" translate>MDF Account Balance</th>
                                       <th class="hidden-xs" translate>Used Balance</th>
                                       <th class="hidden-xs" translate>Available Balance</th>
                                       <th class='text-center' translate>ACTIONS</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                  <ng-container *ngFor="let partner of pagination.pagedItems;let i=index">
                                    <tr>
                                      <td>
                                        <app-user-info [isPartnerEntityInfo]="true" [isPartnerInfo]="true" [userInfo]="partner">
                                        </app-user-info>
                                    </td>
                                      <td>
                                         <span>${{partner?.totalBalance | number:'1.2-2':'en-US'}}</span>
                                      </td>
                                      <td>
                                         <span>${{partner?.usedBalance | number:'1.2-2':'en-US'}}</span>
                                      </td>
                                      <td>
                                         <span>${{partner?.availableBalance | number:'1.2-2':'en-US'}}</span>
                                      </td>
                                      <td style="text-align: center;">
                                         <div class=" override-actions">
                                            <a (click)="openMdfAmountPopup(partner)" title="Add/Remove MDF Amount">
                                            <i class="fa fa-pencil-square-o action-btn" aria-hidden="true"></i>
                                            </a>
                                            <!----Timeline History-->
                                            <a (click)="viewMdfAmountHistory(partner)" title="View History">
                                             <i class="fa fa-line-chart action-btn" aria-hidden="true"></i>
                                             </a>
                                         </div>
                                      </td>
                                   </tr>
                                    </ng-container>
                                 </tbody>
                              </table>
                              <div *ngIf="pagination.pagedItems.length !== 0">
                                <app-pagination [pagination]="pagination" (notifyParent)="setPage($event)" (notifyParentDropDown)="listPartners($event)" [hidden]="partnerListLoader.isLoading">
                                </app-pagination>
                            </div>
                            <div *ngIf="pagination.totalRecords==0 && !partnerListLoader.isLoading" class="alert alert-info">
                                <strong>No Data Found.</strong>
                            </div>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
               <!-- END EXAMPLE TABLE PORTLET-->
            </div>
         </div>
      </div>
   </div>
</div>

<!--Add/Remove Amount Modal Pop Up------->
<div id="mdfAmountPopup" class="modal fade right" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-backdrop="static" data-keyboard="false">
   <div class="modal-dialog modal-css" role="document">
     <!-- Modal content-->
     <div class="modal-content">
      <ngx-loading [show]="modalPopupLoader" [config]="{ backdropBorderRadius: '14px' }"></ngx-loading>
         <div class="modal-header">
             <a class="close-circle" (click)="closeMdfAmountPopup()">
               <i class="fa fa-times" aria-hidden="true"></i></a>
             <h4 class="modal-title" style="font-weight: 600;" translate>Add/Remove MDF</h4>
         </div>
         <div class="modal-body">
            <app-response-message class="pg8" [customResponse]="customResponse" *ngIf="customResponse.isVisible">
            </app-response-message>
            <app-modal-popup-loader *ngIf="modalPopupLoader"></app-modal-popup-loader>
            <form role="form" class="form-horizontal form-bordered form-label-stripped" *ngIf="!modalPopupLoader">
               <div class="portlet box">
                   <div class="">
                     <div class="col-md-12 col-lg-12 ">
                        <div class="form-group">
                            <label class="control-label col-sm-3" translate>Partner Info
                                </label>
                            <div class="col-sm-8">
                              <app-user-info [isPartnerEntityInfo]="true" [isPartnerInfo]="true" [userInfo]="mdfPartnerDto">
                              </app-user-info>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12 col-lg-12 ">
                       <div class="form-group">
                           <label class="control-label col-sm-3" translate>Select Option
                                   <span class="required">*</span>
                               </label>
                           <div class="col-sm-8">
                                 <select class="form-control" name="mdfAmountType" (change)="updateFieldsStatus()" [(ngModel)]="mdfDetails.mdfAmountTypeInString" [ngModelOptions]="{standalone: true}">
                                    <ng-container *ngFor="let type of MdfAmountType.values();">
                                       <ng-container *ngIf="type=='FUND_ADDED'">
                                          <option value="{{type}}" [selected]="mdfDetails.mdfAmountTypeInString=='FUND_ADDED'">Add Funds</option>
                                       </ng-container>
                                       <ng-container *ngIf="type=='FUND_REMOVED'">
                                          <option value="{{type}}" [selected]="mdfDetails.mdfAmountTypeInString=='FUND_REMOVED'">Remove Funds</option>
                                       </ng-container>
                                    </ng-container>
                                  </select>
                           </div>
                       </div>
                   </div>

                 <div class="col-md-12 col-lg-12 ">
                  <div class="form-group">
                      <label class="control-label col-sm-3" translate>Current Available Balance </label>
                      <div class="col-sm-8">
                        <input type="name" [disabled]="true"  class="form-control padding-mobile currency" 
                        [(ngModel)]="mdfPartnerDto.availableBalance"  [ngModelOptions]="{standalone: true}" 
                        placeholder="Available Balance" min="0.00" currencyMask [options]="{align :'left',allowNegative :false }">
                      </div>
                  </div>
              </div>

              <div class="col-md-12 col-lg-12 ">
               <div class="form-group">
                   <label class="control-label col-sm-3" translate>Calculated Available Balance </label>
                   <div class="col-sm-8">
                     <input type="name" [disabled]="true"  class="form-control padding-mobile currency" 
                     [(ngModel)]="mdfDetails.calculatedAvailableBalance"  [ngModelOptions]="{standalone: true}" 
                     placeholder="Calculated Available Balance" currencyMask [options]="{align :'left',allowNegative :true }">
                   </div>
               </div>
           </div>

              <div class="col-md-12 col-lg-12 ">
               <div  [attr.class]="mdfAmountError ? 'form-group has-error':'form-group'">
                   <label class="control-label col-sm-3" translate>Enter Amount <span class="required">*</span></label>
                   <div class="col-sm-8">
                     <input type="text"  class="form-control padding-mobile currency" 
                     [(ngModel)]="mdfDetails.mdfAmount"  [ngModelOptions]="{standalone: true}" 
                     placeholder="Enter Amount" (ngModelChange)="calculateTotalAvailableBalance()" min="0.00" maxlength="20" autocomplete="off" currencyMask [options]="{align :'left',allowNegative :false }">
                     <ng-container *ngFor="let errorResponse of errorResponses">
                        <span class="required" *ngIf="errorResponse.field=='mdfAmount'">{{errorResponse.errorMessage}}</span>
                     </ng-container>
                  </div>
               </div>
              
           </div>
           <div class="col-md-12 col-lg-12 ">
            <div class="form-group">
                <label class="control-label col-sm-3" translate>Description
                    </label>
                <div class="col-sm-8">
                   <textarea class="form-control"  [(ngModel)]="mdfDetails.description"  [ngModelOptions]="{standalone: true}" 
                   placeholder="Description"></textarea>
                
                </div>
            </div>
        </div>
           <ng-container *ngIf="mdfDetails.mdfAmountTypeInString=='FUND_ADDED'">
            <div class="col-md-12 col-lg-12 ">
               <div class="form-group">
                   <label class="control-label col-sm-3" translate>Allocation Date</label>
                   <div class="col-sm-8">
                     <app-flatpickr [(dataField)]="mdfDetails.allocationDateInString" [isFromMdfCredit]='true'>
                     </app-flatpickr>
                   </div>
               </div>
           </div>
   
           <div class="col-md-12 col-lg-12">
            <div  [attr.class]="expirationDateError ? 'form-group has-error':'form-group'">
                <label class="control-label col-sm-3" translate>Expiration Date</label>
                <div class="col-sm-8">
                  <app-flatpickr [(dataField)]="mdfDetails.expirationDateInString" [isFromMdfCredit]='true'>
                  </app-flatpickr>
                  <ng-container *ngFor="let errorResponse of errorResponses">
                     <span class="required" *ngIf="errorResponse.field=='expirationDate' && expirationDateError ">{{errorResponse.errorMessage}}</span>
                  </ng-container>
                </div>
            </div>
        </div>
           </ng-container>
             </div>
               </div>
           </form>
         </div>
         <div class="modal-footer" style="border:none;" *ngIf="!modalPopupLoader">
             <button class="btn btn-info" type="reset" (click)="closeMdfAmountPopup();" translate>Cancel</button>
             <button type="button" class="btn btn-primary"  (click)="updateMdfAmount()" translate>Update</button>
         </div>
     </div>
 </div>
</div>

