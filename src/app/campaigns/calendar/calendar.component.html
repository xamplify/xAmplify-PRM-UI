<div class="page-content">
  <div class="page-bar">
    <div id="calendar" style="padding: 25px">
      <ngx-loading [show]="loading"></ngx-loading>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal right fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">{{campaign?.campaignName}}</h4>       
      </div>
      <div class="modal-body">
        <ng-container *ngIf="campaign && !deleteCampaignAlert">
          <fieldset>
            <legend>Campaign details:</legend>
            <h6>
              <span class="campaign-label ml10">{{campaign.campaignType}} campaign</span>
              <span class="campaign-label {{campaign.campaignScheduleType | lowercase}}">
            <ng-container *ngIf="campaign.campaignScheduleType === 'NOW'; else default">Launched</ng-container>
            <ng-template #default>{{campaign.campaignScheduleType | titlecase}}d</ng-template>
          </span>
            </h6>
            <div class="media col-xs-12 col-sm-6">
              <div class="media-left p10">
                <i class="fa fa-bullhorn"></i>
              </div>
              <div class="media-body">
                <h5>{{campaign.campaignName}}</h5>
                <h6>
                  <ng-container *ngIf="campaign.campaignScheduleType === 'NOW'; else default">Launched</ng-container>
                  <ng-template #default>{{campaign.campaignScheduleType | titlecase}}d</ng-template>
                  on {{campaign.launchTime |date:'mediumDate'}}, {{campaign.launchTime |date:'shortTime'}}
                </h6>
              </div>
            </div>

            <div class="media col-xs-12 col-sm-6">
              <div class="media-left p10">
                <i class="fa fa-user-circle-o"></i>
              </div>
              <div class="media-body">
                <h5>{{campaign.fromName}}</h5>
                <h6>{{campaign.email}}</h6>
              </div>
            </div>
          </fieldset>
          <fieldset *ngIf="campaign.campaignType === 'SOCIAL'">
            <legend>Social Accounts</legend>
            <ng-container *ngFor="let socialStatus of socialCampaign.socialStatusList">
              <app-social-status [socialStatus]="socialStatus"></app-social-status>
            </ng-container>
          </fieldset>
          <fieldset *ngIf="campaign.campaignType !== 'SOCIAL'">
            <legend>Selected:</legend>
            <div *ngIf="campaign.campaignVideoFile" class="col-sm-6 col-xs-12">
              <img src="{{campaign.campaignVideoFile.imagePath}}">
              <h5>{{campaign.campaignVideoFile.title}}</h5>
              <h6>By {{campaign.campaignVideoFile.uploadedUserName}}</h6>
            </div>
            <div class="col-sm-6 col-xs-12" *ngIf="campaign.emailTemplate">
              <img src="{{campaign.emailTemplate.subject}}">
              <h5>{{campaign.emailTemplate.name}}</h5>
              <h6>By {{campaign.emailTemplate.createdBy}}</h6>
            </div>
          </fieldset>
          <fieldset *ngIf="campaign.campaignType !== 'SOCIAL'">
            <legend>Selected Recipients(s):</legend>
            <table class="table">
              <thead>
                <tr>
                  <th scope="col">#</th>
                  <th scope="col">List Name</th>
                </tr>
              </thead>
              <tbody>
                <ng-container *ngFor="let userList of campaign.userLists; let i = index">
                  <tr>
                    <th scope="row">{{i+1}}</th>
                    <td>{{userList.name}}</td>
                  </tr>
                </ng-container>
              </tbody>
            </table>
          </fieldset>
          <fieldset *ngIf="campaign.campaignType !== 'SOCIAL'">
            <legend>Analytics</legend>
            <div>
              <div class="text-center" [ngClass]="{'col-xs-4': campaignType !== 'VIDEO', 'col-xs-6 col-sm-3': campaignType === 'VIDEO'}">
                <h1>{{campaignReport.emailSentCount}}</h1>
                <h5>Total Recipients</h5>
              </div>
              <div class="text-center" [ngClass]="{'col-xs-4': campaignType !== 'VIDEO', 'col-xs-6 col-sm-3': campaignType === 'VIDEO','forbidden' :!isDataShare ?true:null}">
                <h1>{{campaignReport.emailOpenCount}}</h1>
                <h5>Active Recipients</h5>
              </div>
              <div class="text-center" [ngClass]="{'hidden': campaignType === 'SOCIAL', 'col-xs-4': campaignType !== 'VIDEO', 'col-xs-6 col-sm-3': campaignType === 'VIDEO','forbidden' :!isDataShare ?true:null}">
                <h1>{{campaignReport.emailClickedCount}}</h1>
                <h5>Clicked URL</h5>
              </div>
              <div class="col-xs-6 col-sm-3 text-center" *ngIf="campaignType === 'VIDEO'" [ngClass]="{'forbidden' :!isDataShare ?true:null}">
                <h1>{{campaignReport.usersWatchCount}}</h1>
                <h5>Views</h5>
              </div>
            </div>
          </fieldset>
        </ng-container>
<div class="swal2-modal show-swal2 visible" style="    display: block;padding: 20px;margin-top: -74px;border: 1px solid #ccc;box-shadow: 0px 0px 20px #f1f1f1;" tabindex="-1" *ngIf="deleteCampaignAlert">
<div class="swal2-icon swal2-warning pulse-warning" style="display: block;">!</div>
<span class="line tip"></span> <span class="line long"></span>
<div class="placeholder"></div>
<div class="fix"></div>
<h2>Are you sure?</h2>
<div class="swal2-content" style="display: block;">You won't be able to undo this action</div>
<hr class="swal2-spacer" style="display: block;">
<button class="btn btn-primary btn-sm" (click)="deleteCampaign(campaign.campaignId)">Yes, delete it!</button>
<button class="btn btn-secondary btn-sm" (click)="deleteCampaignAlert = false">Cancel</button>
</div>
        
      </div>
      <div class="modal-footer" *ngIf="!deleteCampaignAlert">
        <div class="actions-block text-center m10" *ngIf="campaign">
          <ng-container *ngIf="campaign.launched">
            <a *ngIf="(hasAllAccess || (hasStatsRole || hasCampaignRole ) || (loggedInUserId==campaign.userId) || authenticationService.module.isVendor) && campaign.channelCampaign && campaign.redistributedCount>0"
              (click)="navigateRedistributedCampaigns(campaign)" data-toggle="tooltip" data-placement="top" title="Show Redistributed Campaigns">
              <span class="circled-number">{{campaign.redistributedCount}}</span>
            </a>
            <a *ngIf="(hasAllAccess || (hasStatsRole || hasCampaignRole ) || (loggedInUserId==campaign.userId) || authenticationService.module.isVendor) && campaign.channelCampaign && campaign.redistributedCount==0"
              data-toggle="tooltip" data-placement="top" title="No Redistributed Campaigns">
              <span class="circled-number disabled">{{campaign.redistributedCount}}</span>
            </a>
            <a *ngIf="  hasAllAccess || (hasStatsRole || hasCampaignRole) || (loggedInUserId==campaign.userId) || authenticationService.module.isVendor"
              data-rel="fancybox-button" (click)="navigateCampaignAnalytics(campaign)" data-toggle="tooltip" data-placement="top" title="Analytics">
              <i class="fa fa-line-chart"></i>
            </a>
            <a *ngIf=" (campaign.campaignType !== 'SOCIAL') && ( hasAllAccess || (hasStatsRole || hasCampaignRole) || isOnlyPartner || authenticationService.module.isVendor) && !campaign.nurtureCampaign"
              data-rel="fancybox-button" (click)="openSaveAsModal(campaign)" data-toggle="tooltip" data-placement="auto" title="Copy Campaign">
              <i class="fa fa-files-o"></i>
            </a>
            <a *ngIf=" (hasAllAccess ||  (hasCampaignRole && loggedInUserId==campaign.userId) || isOnlyPartner || authenticationService.module.isVendor) && campaign.channelCampaign"
              (click)="navigatePreviewPartners(campaign)" data-rel="fancybox-button" data-toggle="tooltip" data-placement="auto" title="Preview & Delete Partner(s)">
              <i class="fa fa-handshake-o" id="partner-icon"></i>
            </a>
          </ng-container>
          <ng-container *ngIf="!campaign.launched">
            <a *ngIf="hasAllAccess || (campaign.launched==false&&hasCampaignRole && loggedInUserId==campaign.userId) || (!campaign.launched&&isOnlyPartner)  || authenticationService.module.isVendor" 
              (click)="editCampaign(campaign)" data-toggle="tooltip" data-placement="auto" title="Edit">
              <i class="fa fa-pencil-square-o"></i>
            </a>
          </ng-container>
            <a (click)="showCampaignPreview(campaign)"><i class="fa fa-eye mr5"  data-toggle="tooltip" data-placement="auto" title="Preview Campaign"></i></a>
            <a *ngIf=" hasAllAccess ||  (hasCampaignRole && loggedInUserId==campaign.userId) || isOnlyPartner || authenticationService.module.isVendor"
              (click)="confirmDeleteCampaign(campaign.campaignId)" data-rel="fancybox-button" data-toggle="tooltip" data-placement="auto" title="Delete">
              <i class="fa fa-trash-o"> </i></a>
        </div> 
      </div>
</div>
</div>
</div>

<!-- Save As Modal -->
<div class="modal right fade" id="saveAsModal" tabindex="-1" role="dialog" aria-labelledby="saveAsModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-copy" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title f-w-600" id="saveAsModalLabel">Copy Campaign</h4>
				<button type="button" class="close-circle" data-dismiss="modal" style=" position: relative;top: -24px;">
					<i class="fa fa-times"></i>
				</button>
			</div>
			<div class="modal-body">
				<div class="form-group">
					<label for="campaignName">Campaign Name</label>
					<input class="form-control" type="text" id="campaignName" [(ngModel)]="saveAsCampaignName">
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				<button type="button" class="btn btn-primary" (click)="saveAsCampaign()">Save changes</button>
			</div>
		</div>
	</div>
</div>

<div id="ca-{{campaign.id}}" *ngFor="let campaign of campaigns" class='clearfix m10 hidden' style="min-width: 1500px">
  <h6>
    <span class="campaign-label">{{campaign.type}} campaign</span>
    <span class="campaign-label {{campaign.status | lowercase}}">
            <ng-container *ngIf="campaign.status === 'NOW'; else default">Launched</ng-container>
            <ng-template #default>{{campaign.status | titlecase}}d</ng-template>
          </span>
  </h6>
  <div class="media">
      <h5>{{campaign.campaign}}</h5>
      <ng-container *ngIf="campaign.status === 'NOW'">
        <div class="progress">
          <div class="progress-bar" role="progressbar"  aria-valuemin="0" aria-valuemax="100"  [ngStyle]="{ 'width': campaign.percentage +'%' }">
            <span class="sr-only"></span>
          </div>
        </div>
        <h6>{{campaign.percentage}}% interaction</h6>
      </ng-container>

      <h6>
        <ng-container *ngIf="campaign.status === 'NOW'; else default">Launched</ng-container>
        <ng-template #default>{{campaign.status | titlecase}}d</ng-template>
        on
        <ng-container *ngIf="campaign.status === 'SAVE'; else launchTime">{{campaign.createdTime |date:'mediumDate'}}, {{campaign.createdTime | date:'shortTime'}}</ng-container>
        <ng-template #launchTime>{{campaign.launchTime |date:'mediumDate'}}, {{campaign.launchTime | date:'shortTime'}}</ng-template>

        <ng-container></ng-container>
      </h6>
  </div>
</div>