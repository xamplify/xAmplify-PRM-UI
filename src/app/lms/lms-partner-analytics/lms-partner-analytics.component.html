<ngx-loading [show]="httpRequestLoader.isLoading" [config]="{ backdropBorderRadius: '14px' }"></ngx-loading>
<div class="page-content">
    <ng-container *ngIf="!initLoader">
        <div class="page-bar">
            <ul class="page-breadcrumb">
                <li>
                    <i class="fa fa-home" aria-hidden="true"></i>
                    <a [routerLink]="referenceService.homeRouter">Home</a>
                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                    <a [routerLink]="['/home/lms/manage']">Manage Learning Track</a>
                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                    <a [routerLink]="analyticsRouter">Analytics</a>
                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                    <a>Partner Analytics</a>
                </li>
            </ul>
            <a class="close-circle xamp-margin-left-icon" (click)="goBack()" aria-hidden="true">
                <i class="fa fa-times" aria-hidden="true"></i>
            </a>
            <a class="close-circle xamp-margin-left-icon" (click)="refreshPage()" aria-hidden="true">
                <i class="fa fa-refresh" aria-hidden="true"></i>
            </a>
        </div>
    </ng-container>
    <div style="position: relative; top: -10px">
        <app-response-message [customResponse]="customResponse" *ngIf="customResponse.isVisible"></app-response-message>
    </div>
    <div class="page-bar">
        <div class="row">
            <div class="col-md-12">
                <div class="portlet light clearfix" style="min-height: 644px;">
                    <div class="portlet-title" style="border-bottom: none">
                        <div class="row">
                            <div class="page-toolbar col-xs-12">
                                <div class="btn-group pull-right">
                                    <div class="inputs" style="float: right">
                                        <!-- <div style="float: left;">
                        <select class="form-control" [(ngModel)]="sortOption.formsSortOption" (ngModelChange)="sortBy($event)" style="position: relative;right: -3px;">
                        <option *ngFor="let option of sortOption.manageFormsSortOptions" [ngValue]="option">
                            {{option.name}}</option>
                        </select>
                    </div> -->
                                        <div class="portlet-input input-inline input-small" style="margin-right: 10px;">
                                            <div class="input-icon right" style="position: relative;right: -11px;">
                                                <input type="text" style="height:34px;" class="form-control" [(ngModel)]="sortOption.searchKey" [ngModelOptions]="{standalone: true}" placeholder="search..." (keypress)="eventHandler($event.keyCode)">
                                                <button class="glyphicon glyphicon-remove search-box-item-clear" *ngIf="sortOption.searchKey" (click)="sortOption.searchKey='';search();"></button>
                                                <button type="submit" class="search-box-item-click" (click)="search()">
                                                    <i class="fa fa-search" aria-hidden="true"></i></button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <app-list-loader *ngIf=" httpRequestLoader.isLoading ">
                    </app-list-loader>
                    <ng-container *ngIf="!httpRequestLoader.isLoading">
                        <div class="table-responsive">
                            <table class='table tgrid table-hover table-sm' id="lms-analytics-list-table" *ngIf="pagination.pagedItems?.length>0" aria-describedby="lms-list">
                                <thead>
                                    <tr>
                                        <th class="hidden-xs" style="width: 35%" id="border-bottom">
                                            <span class="gridHeader" translate>Partner</span>
                                        </th>
                                        <th class="text-center" style="width: 35%" translate>Progress</th>
                                        <th class="text-center" translate>QUiz Score</th>
                                        <th class="text-center" id="min-width" translate>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <ng-container *ngFor="let partner of pagination.pagedItems ;let i =index">
                                        <tr>
                                            <td>
                                                <app-user-info [userInfo]="partner"> </app-user-info>
                                            </td>
                                            <td class="text-center">
                                                <div class="progress" style="width: 50%; margin: 0px 25%;">
                                                    <div class="progress-bar" data-toggle="tooltip" data-placement="top" title="{{partner.learningTrackProgress}}%" [ngStyle]="{'width': partner.learningTrackProgress + '%'}" style="border-radius:1px;" role="progressbar">
                                                    </div>
                                                </div>
                                                <span *ngIf="partner.learningTrackProgress != undefined">{{partner.learningTrackProgress}}%</span>
                                                <span *ngIf="partner.learningTrackProgress == undefined">0%</span>
                                            </td>
                                            <td>
                                                <div *ngIf="partner.hasLearningTrackQuiz && partner.learningTrackProgress == 100">
                                                    <h6 class="view-banner" style="background-color: #5cb85c;" translate>
                                                        Finished</h6>
                                                    {{partner.learningTrackScore}} out of {{partner.learningTrackMaxScore}}
                                                </div>
                                                <div *ngIf="partner.hasLearningTrackQuiz && partner.learningTrackProgress != 100">
                                                    <h6 class="view-banner" style="background-color: #cad2ca;" translate>Not Yet Finished
                                                    </h6>
                                                </div>
                                                <div *ngIf="!partner.hasLearningTrackQuiz">
                                                    <h6 class="view-banner" style="background-color: #cad2ca;" translate>Quiz Not Available
                                                    </h6>
                                                </div>
                                            </td>
                                            <td id="actions-row">
                                                <div class="actions-block override-actions custom-width-icon">
                                                    <a data-toggle="tooltip" data-placement="top" title="View Analytics" (click)="viewAnalytics(partner,i)">
                                                        <i class="fa fa-line-chart" aria-hidden="true"></i>
                                                    </a>
                                                </div>
                                                <!-- <div class="actions-block override-actions custom-width-icon">
                                                    <a data-toggle="tooltip" data-placement="top" title="View Analytics" (click)="viewAnalytics(partner,i)">
                                                        <i class="fa" [ngClass]="{'fa-plus': !partner.expanded, 'fa-minus': partner.expanded}"></i>
                                                    </a>
                                                </div> -->
                                            </td>
                                        </tr>
                                        <!-- <tr [ngClass]="{'hidden': !partner.expanded}" id="analytics-tr">
                                            <td colspan="4">
                                                <div class="table-responsive">
                                                    <table class="table tgrid table-hover table-sm" id="analytics">
                                                        <thead>
                                                            <tr>
                                                                <th class="text-center">Content</th>
                                                                <th class="text-center">View Count</th>
                                                                <th class="text-center">Download Count</th>
                                                                <th class="text-center">Status</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <app-auto-response-loader *ngIf="analyticsLoader.isLoading">
                                                            </app-auto-response-loader>
                                                            <ng-container *ngIf="!analyticsLoader.isLoading">
                                                                <tr *ngFor="let item of analyticsPagination.pagedItems;let i=index">
                                                                    <td class="text-center"></td>
                                                                    <td class="text-center"></td>
                                                                    <td class="text-center"></td>
                                                                    <td class="text-center"></td>
                                                                </tr>
                                                            </ng-container>
                                                        </tbody>
                                                    </table>
                                                </div>
                                                <div *ngIf="analyticsPagination.pagedItems.length !== 0">
                                                    <app-pagination [pagination]="analyticsPagination" (notifyParent)="setDetailedAnalyticsPage($event)" (notifyParentDropDown)="listDetailedAnalytics($event)" [hidden]="analyticsLoader.isLoading"></app-pagination>
                                                </div>
                                            </td>
                                        </tr> -->
                                    </ng-container>
                                </tbody>
                            </table>
                        </div>
                    </ng-container>
                    <div *ngIf="pagination.pagedItems.length !== 0" class="pg8">
                        <app-pagination [pagination]="pagination" (notifyParent)="setPage($event)" (notifyParentDropDown)="getAnalytics($event)" [hidden]="httpRequestLoader.isLoading">
                        </app-pagination>
                    </div>
                    <!-- End of 24 -->
                    <div *ngIf="pagination.totalRecords==0 && !httpRequestLoader.isLoading" class="alert alert-info">
                        <strong translate>No Data Found.</strong>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- analytics Popup -->
<div class="modal right" id="analytics-list" data-backdrop="static">
    <div class="modal-dialog modal-lg" style="width: 75%;right:0">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close-circle" data-dismiss="modal">
                    <i class="fa fa-times" aria-hidden="true"></i>
                </button>
                <h4 class="modal-title text-center">Analytics</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-xs-12 p5">
                        <!-- <div class="portlet-title">
                                <div class="inputs" id="right">
                                    <div id="left">
                                        <select class="form-control" [(ngModel)]="quizFormSortOption.formsSortOption" (ngModelChange)="quizSortBy($event)" style="position: relative;right: -3px;">
                                            <option *ngFor="let option of quizFormSortOption.manageFormsSortOptions"
                                                [ngValue]="option">
                                                {{option.name}}</option>
                                        </select>
                                    </div>
                                    <div class="portlet-input input-inline input-small" id="search">
                                        <div class="input-icon right" id="search-icon">
                                            <input type="text" id="search-text" class="form-control" style="height: 34px;" [(ngModel)]="detailedAnalyticsSortOption.searchKey" [ngModelOptions]="{standalone: true}" placeholder="search..." (keypress)="detailedAnalyticsEventHandler($event.keyCode)">
                                            <button class="glyphicon glyphicon-remove search-box-item-clear" *ngIf="detailedAnalyticsSortOption.searchKey" (click)="detailedAnalyticsSortOption.searchKey='';detailedAnalyticsSearch();"></button>
                                            <button type="submit" class="search-box-item-click" (click)="detailedAnalyticsSearch()"><i class="fa fa-search"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div> -->
                        <div>
                            <ul class="timeline custom-padding" *ngFor="let detailedAnalytics of detailedAnalyticsPagination.pagedItems ;let i =index">
                                <li class="timeline-inverted">
                                    <div class="timeline-badge">
                                        <img alt="Image not found" [src]="detailedAnalytics.assetThumbnail">
                                    </div>
                                    <div class="timeline-panel">
                                        <div class="timeline-heading">
                                            <span class="timeline-title">
                                                <label>Asset Name:</label>
                                                <h5 style="display: inline;">{{detailedAnalytics.assetName}}</h5>
                                            </span>
                                        </div>
                                        <div class="timeline-body">
                                            <div>
                                                <span *ngIf="detailedAnalytics.type == 'OPENED'">
                                                    Opened On
                                                </span>
                                                <span *ngIf="detailedAnalytics.type == 'DOWNLOAD'">
                                                    Download On
                                                </span>
                                                <app-timestamp [showInLine]="'true'" [dateAndTime]="detailedAnalytics.createdTime">
                                                </app-timestamp>
                                            </div>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                        <div *ngIf="detailedAnalyticsPagination.pagedItems.length !== 0" class="pg8">
                            <app-pagination [pagination]="detailedAnalyticsPagination" (notifyParent)="setDetailedAnalyticsPage($event)" (notifyParentDropDown)="getPartnerDetailedAnalytics($event)" [hidden]="detailedAnalyticsLoader.isLoading">
                            </app-pagination>
                        </div>
                        <!-- End of 24 -->
                        <div *ngIf="detailedAnalyticsPagination.totalRecords==0 && !detailedAnalyticsLoader.isLoading" class="alert alert-info">
                            <strong>No Data Found.</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 
<section *ngIf="!isChannelCampaign || campaignType != 'EVENT'">
    <div id="timeline-view" class="page-content" *ngIf="isTimeLineView "
      [class.ml0]="authenticationService.isSuperAdmin()">
      <div class="page-bar" style="border: 1px solid #CCC;">
        <a (click)="resetTopNavBarValue()" class="pull-right close-circle"
          style="margin: 9px 14px;padding-top: 3px;padding-left: 5px;">
          <span class="glyphicon glyphicon-remove" style="z-index: 1;font-size: 13px;" aria-hidden="true"></span></a>
  
        <div data-animation-name="slideInUp">
          <div class="col-xs-12">
            <ng-container *ngIf="campaignType == 'SOCIAL'">
              <div class="f-w-600 p10">Redistributed Accounts</div>
              <div class="col-sm-4 col-xs-12" *ngFor="let socialStatus of redistributedAccountsBySelectedUserId">
                <app-social-status [socialStatus]="socialStatus"></app-social-status>
              </div>
            </ng-container>
          </div>
          <div class="col-xs-12 col-sm-6 p10">
            <ng-container *ngIf="campaignType !== 'SOCIAL'">
              <div class="text-center f-w-600">Most Active Recipients for this Campaign</div>
              <app-bubble-chart [campaignId]="campaignId"></app-bubble-chart>
            </ng-container>
            <div class="text-center f-w-600">
              <span *ngIf="campaignType==='VIDEO'">View Count By Recipient</span>
              <span *ngIf="campaignType!=='VIDEO'">Email Opened Count By Recipient </span>
            </div>
            <div id="campaign-views-barchart" style="width: 100%; max-width: 100%; height: 260px; margin: 0 auto"></div>
            <div>
              <app-pagination class="pg8" *ngIf="pagination.pagedItems?.length > 0" [pagination]="pagination"
                [type]="'viewsBarChart'" (notifyParent)="setPage($event)" [isDropdown]="true"></app-pagination>
    
</div>
</div>
<div class="col-xs-12 col-sm-6">
    <div data-animation="slideInUp">
        <div class="row mb10">
            <img src="/assets/images/user.png" width="48px" class="user-profile-image" alt="No image found">
            <ng-container *ngIf="!disabled">
                <span *ngIf="((campaign.nurtureCampaign || !channelCampaign) &&  (campaignType!='LANDINGPAGE') &&(campaignType!='SOCIAL')&&
                    (authenticationService.module.isCompanyPartner || authenticationService.isPartnerTeamMember ) && enableLeads && !createdBySelf) || campaign.showRegisterLeadButton">
                  <button style="position: absolute; left: 350px; margin-top: 7px;" (click)="showDealRegistrationForm()"
                    class="btn btn-success">{{dealButtonText}}</button>
                </span>
            </ng-container>
            <ng-container *ngIf="disabled">
                <button title="This campaign has been deleted by your vendor.You can't register a lead" style="position: absolute; left: 350px; margin-top: 7px;cursor: not-allowed;background: darkgray;" class="btn btn-success">{{dealButtonText}}</button>
            </ng-container>

            <h5 class="f-w-600 mt10 mb0"><span *ngIf="selectedRow?.firstName">{{selectedRow.firstName | slice:0:20}}</span>
                <span *ngIf="selectedRow.firstName?.length>20">..</span> &nbsp;
                <span *ngIf="selectedRow?.lastName">{{selectedRow.lastName | slice:0:20}}</span>
                <span *ngIf="selectedRow.lastName?.length>20">..</span>
            </h5>
            <h6 class="m0">{{selectedRow.emailId | slice:0:35}}
                <span *ngIf="selectedRow.emailId?.length>35">...</span>
            </h6>
        </div>
        <div class="row mb10">
            <div class="col-sm-3 col-xs-6">
                <a class="text-center">
                    <div><img src="assets/images/email-opened.png" style="margin: 0px 5px;width: 52px;"></div>
                    <div>Email Opened</div>
                    <div class="number">
                        <span data-counter="counterup" style="margin: 0 25px;">{{userCampaignReport.emailOpenCount}}</span>
                    </div>
                </a>
            </div>
            <ng-container *ngIf="campaignType != 'EVENT'">
                <div class="col-sm-3 col-xs-6">
                    <a class="text-center">
                        <div><img src="assets/images/clicked-new.png" style="margin: 0px 10px;width: 52px;"></div>
                        <div>Clicked URL</div>
                        <div class="number">
                            <span data-counter="counterup" style="margin: 0 25px;">{{userCampaignReport.emailClickedCount}}</span>
                        </div>
                    </a>
                </div>
                <div class="col-sm-3 col-xs-6" [hidden]="campaignType==='REGULAR' || campaignType==='SOCIAL' ||  campaignType==='LANDINGPAGE' ">
                    <a class="text-center">
                        <div><img src="assets/images/video-watched.png" style="margin: 0px 11px;width: 52px;"></div>
                        <div>Views</div>
                        <div class="number">
                            <span data-counter="counterup" style="margin: 0 33px;">{{userCampaignReport.totalUniqueWatchCount}}</span>
                        </div>
                    </a>
                </div>
                <div class="col-sm-3 col-xs-6" [hidden]="campaignType==='REGULAR' || campaignType==='SOCIAL' ||  campaignType==='LANDINGPAGE'">
                    <a class="text-center">
                        <div><img src="assets/images/total-time-spent.png" style="margin: 4px 15px;width: 45px;"></div>
                        <div>Time Spent</div>
                        <div class="number">
                            <span data-counter="counterup" style="margin: 0 33px;">{{videoUtilService.truncateHourZeros(totalTimeSpent)}}</span>
                        </div>
                    </a>
                </div>
            </ng-container>

            <div class="col-sm-3 col-xs-6" *ngIf="campaignType==='SOCIAL'">
                <a class="text-center">
                    <div><img src="assets/images/social-icons.jpg" style="margin: 0px 15px;width: auto;height: 52px;">
                    </div>
                    <div>Social Accounts</div>
                    <div class="number">
                        <span>{{redistributedAccountsBySelectedUserId.length}}</span>
                    </div>
                </a>
            </div>
        </div>
    </div>

    <ul class="timeline custom-padding" data-animation="slideInUp" *ngIf="selectedRow">
        <li class="timeline-inverted">
            <div class="timeline-badge warning"><img src="assets/images/closed-env.png"></div>
            <div class="timeline-panel">
                <div class="timeline-heading">
                    <span class="timeline-title">
                      <app-timestamp [dateAndTime]="campaign.launchTime"> </app-timestamp>
                    </span>
                </div>
                <div class="timeline-body">
                    <h5><span class="f-w-600" title="{{campaign.campaignName}}">
                        {{campaign.campaignName | slice: 0: 30}}
                        <span *ngIf="campaign.campaignName?.length>30">...</span>
                        </span> campaign Launched at {{campaign.launchTime | date: 'shortTime'}}</h5>
                    <h5>Email sent to <b>{{selectedRow.emailId}}</b></h5>
                </div>
            </div>
        </li>
    </ul>
    <ul class="timeline custom-padding" *ngFor="let emailLog of emailLogs">
        <li class="timeline-inverted">
            <div class="timeline-badge">
                <img *ngIf="emailLog.actionId == 13" alt="opened" src="assets/images/opened.png">
                <img *ngIf="emailLog.actionId == 14" alt="clicked" src="assets/images/clicked.png">
                <img *ngIf="emailLog.actionId == 15" alt="clicked" src="assets/images/clicked.png">
                <img *ngIf="emailLog.actionId == 1 || emailLog.actionId == 10" alt="watched" src="assets/images/video.png">
                <img *ngIf="emailLog.autoResponseType" src="assets/images/closed-env.png">
            </div>
            <div class="timeline-panel">
                <div class="timeline-heading">
                    <span class="timeline-title">
                      <app-timestamp [dateAndTime]="emailLog.time"> </app-timestamp>
                    </span>
                </div>
                <div class="timeline-body">
                    <h5>
                        <span *ngIf="emailLog.actionId == 13">
                        Campaign <span class="f-w-600" *ngIf="emailLog.subject" title="{{emailLog.subject}}">
                          {{emailLog.subject | slice:0:30}} <span *ngIf="emailLog.subject?.length>30">...</span>
                        </span> email opened
                        </span>
                        <span *ngIf="emailLog.actionId == 14 && campaign.campaignVideoFile">Clicked <span class="f-w-600"
                          title="{{campaign.campaignVideoFile.title}}">{{campaign.campaignVideoFile.title
                                                  | slice:0:30}} <span *ngIf="campaign.campaignVideoFile.title?.length>30">...</span></span> video GIF</span>
                        <span *ngIf="emailLog.actionId == 15 && emailLog.url?.length>0 && emailLog.url!='Clicked on View in browser'">
                        Clicked on the URL
                        <span class="f-w-600">
                          <a href="{{emailLog.url}}" target="_blank"
                            title="{{emailLog.url}}">{{emailLog.url | slice:0:30}}
                          <span *ngIf="emailLog.url?.length>30">...</span></a>
                        </span>
                        </span>
                        <span *ngIf="emailLog.actionId == 15 && emailLog.url?.length>0 && emailLog.url=='Clicked on View in browser'">
                        <span class="f-w-600">
                          <a href="javascript:void(0);" title="{{emailLog.url}}">{{emailLog.url}}
                          </a>
                        </span>
                        </span>
                        <span *ngIf="campaign.campaignVideoFile && (emailLog.actionId == 1 || emailLog.actionId == 10)">
                        <span class="f-w-600"
                          title="{{campaign.campaignVideoFile.title}}">{{campaign.campaignVideoFile.title | slice:0:30}}
                          <span *ngIf="campaign.campaignVideoFile.title?.length>30">...</span>
                        </span> <span *ngIf="emailLog.actionId == 10">re-</span>played
                        </span>
                        <span *ngIf="emailLog.autoResponseType">
                        <h5>Email sent for the auto response: <b>{{emailLog.autoResponseType}}</b></h5>
                        <h6>Subject Line: <b>{{emailLog.subject}}</b></h6>
                      </span>
                    </h5>
                    <span *ngIf="emailLog.countryCode">
                      <h6>
                        <img *ngIf="emailLog.countryCode"
                          src="https://lipis.github.io/flag-icon-css/flags/4x3/{{emailLog.countryCode | lowercase}}.svg"
                          width="20px" class="mr10" alt="">{{emailLog.country}}, {{emailLog.city}}
                      </h6>
                      <h6 class="mb0">{{emailLog.isp}} ( <strong>{{emailLog?.ipAddress}}</strong> )</h6>
                    </span>
                    <div *ngIf="emailLog.actionId == 1">
                        <app-heat-map [sessionId]="emailLog.sessionId"></app-heat-map>
                    </div>
                </div>
            </div>
        </li>
    </ul>
</div>
</div>
</div>
</div>
</section> -->