<ngx-loading [show]="formLoader" [config]="{ backdropBorderRadius: '14px' }"></ngx-loading>
<div class="page-content">
  <ng-container *ngIf="initLoader">
    <app-modal-popup-loader></app-modal-popup-loader>
  </ng-container>
  <ng-container *ngIf="!initLoader">
  <div class="page-bar">
    <div class="col-md-12 col-lg-12">
      <div class="row">
        <div class="col-md-6 col-lg-6 text-left">
          <ul class="page-breadcrumb">
            <li>
              <i class="fa fa-home" aria-hidden="true"></i> <a [routerLink]="referenceService.homeRouter" translate>Home</a>
              <i class="fa fa-angle-right" aria-hidden="true"></i>
            </li>
            <li>
              <a [routerLink]="referenceService?.selectModuleRouter" translate>Select Module</a> 
					    <i class="fa fa-angle-right" aria-hidden="true"></i>
            </li>
            <li>
              <a *ngIf="isAdd" (click)="goToSelect()" translate>Design/Upload</a>
              <a *ngIf="!isAdd" (click)="goToManageDam()" translate>Manage</a>    
              <i class="fa fa-angle-right" aria-hidden="true"></i>
            </li>
            <li><a translate>{{headerText}}</a></li>
          </ul>
        </div>
        <div class="col-md-6 col-lg-6 text-right" style="padding-right: 5px;">
          <div class="btn-group refer-vendor-button" style="padding-top: 4px;padding-bottom: 4px;padding-right: 0px;">
            <a class="close-circle" (click)="closeCircle()"  title="Close">
            <i class="fa fa-times" aria-hidden="true"></i>
            </a> 
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12 col-lg-12">
      <div class="portlet light mScroll">
        <div class="portlet-title">
          <div class="caption" translate>
            {{headerText}}
          </div>
          <div *ngIf="previewItems" class="btn-group" id="right">
            <a class="close-circle" (click)="closePreview()"  title="Close">
            <i class="fa fa-times" aria-hidden="true"></i>
            </a> 
          </div>
        </div>
        <app-response-message class="pg8" [customResponse]="customResponse" *ngIf="customResponse.isVisible">
        </app-response-message>
        <app-modal-popup-loader [hidden]="!formLoader && isCkeditorLoaded"></app-modal-popup-loader>
        <ng-container *ngIf="!previewItems">
          <div [hidden]="formLoader || !isCkeditorLoaded" class="row" style="margin-top: 20px;">
            <form role="form" class="form-horizontal form-bordered form-label-stripped">
              <div class="portlet box">
                <div class="">
                  <div class="col-md-12 col-lg-12">
                    <div class="form-group">
                      <div class="col-md-12 col-lg-12 col-xs-12 col-sm-12 bottom-padding">
                        <!---Asset-->
                        <div class="mb-padding" *ngIf="isAdd">
                          <span [style.color]="invalidAssetName ? 'red':''"><strong>Upload Asset<span
                                class="required">*</span></strong></span>
                          <div class="upload-asset-div" (click)="browse()" (drop)="chooseAsset($event)">
                            <input type="file" (change)="chooseAsset($event)" style="opacity: 0.0; position: absolute;"
                              id="uploadedAsset">
                            <div class="text-center">
                              <img src="../../../assets/images/uploadimage.png" alt="">
                              <h2 class="upload-video" style="margin:-5px;padding-top: 5px;" translate>Upload
                                Asset</h2>
                              <h6 style="color: #717171;">{{properties.CONTENT_DRAG_MESSAGE | translate}}</h6>
                              <button class="btn btn-primary" style="color:#fff" translate>Browse</button>
                              <br><br>
                              <span *ngIf="uploadedAssetName?.length>0">
                                <strong>File Name : {{uploadedAssetName}}</strong>
                              </span>
                              <span *ngIf="uploadedAssetName?.length==0">
                                <strong>No File Selected</strong>
                              </span>
                            </div>
                          </div>
                          <div class="col-xs-12 p0 top10px md-padd">
                            <div class="col-xs-12 message-content">
                              <ul>
                                <li translate>Maximum file size is 800 MB.</li>
                              </ul>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-md-8 col-lg-8 col-xs-8 col-sm-8" style="padding-right: 0;">
                          <div class="col-md-12 col-lg-12 col-xs-12 col-sm-12">
                            <div class="form-group">
                              <label class="control-label col-sm-2" translate>Name
                                <span class="required">*</span>
                              </label>
                              <div class="col-sm-10">
                                <input type="text" maxlength="255" class="form-control" [(ngModel)]="damUploadPostDto.assetName"
                                  [ngModelOptions]="{standalone: true}" placeholder="Enter Name" (input)="validateForm('assetName')">
                                <span class="required" *ngIf="dupliateNameErrorMessage?.length>0">{{dupliateNameErrorMessage}}</span>
                              </div>
                            </div>
                          </div>
                          <div class="col-md-12 col-lg-12 col-xs-12 col-sm-12">
                            <div class="form-group" style="margin-bottom: 0;">
                              <label class="control-label col-sm-2" translate>Tags
                              </label>
                              <div class="col-sm-10 inline">
                                <ngx-loading [show]="tagsLoader.isLoading" [config]="{ backdropBorderRadius: '14px' }"></ngx-loading>
                                <div class="portlet light" style="width: 100%;padding: 5px !important;">
                                  <div class="portlet-title tabbable-line " style="margin-bottom: 0px !important;">
                                    <div class="inline" style="float: right;">
                                      <div class="input-icon left" style="padding-bottom: 5px;">
                                        <input type="text" [(ngModel)]="tagSearchKey" [ngModelOptions]="{standalone: true}"
                                          placeholder="Search..." class="form-control" (keypress)="tagEventHandler($event.keyCode);"
                                          style="padding: 6px 12px;">
                                        <button class="glyphicon glyphicon-remove search-box-item-clear" *ngIf="tagSearchKey"
                                          (click)="tagSearchKey='';searchTags();"></button>
                                        <button type="submit" class="search-box-item-click email-search" (click)="searchTags()">
                                          <i class="fa fa-search cesf-xamp"></i></button>
                                      </div>
                                      <div style="padding-left: 10px;">
                                        <button type="button" class="btn btn-primary add-btn" (click)="addTag()">
                                          <i class="fa fa-plus" data-toggle="tooltip" aria-hidden="true"></i></button>
                                      </div>
                                    </div>
                                  </div>
                                  <div class="scroller-lg">
                                    <table class="table table-bordered no-footer tags-table" id="tags_list">
                                      <tbody>
                                        <tr role="row" *ngFor="let tag of tagsListFirstColumn;let i = index"
                                          style="vertical-align: middle;padding: 0px;">
                                          <td style="padding: 5px;vertical-align: middle;"
                                            (click)="updateSelectedTags(tag,$event.target.checked)">
                                            <div class="col-sm-2 col-sm-offset-2">
                                              <label class="form-check-label inline">
                                                <input type="checkbox" class="form-check-input "
                                                  [checked]="damUploadPostDto.tagIds != undefined && damUploadPostDto.tagIds.length > 0 && damUploadPostDto.tagIds.indexOf(tag.id)>-1">
                                              </label>
                                            </div>
                                            <div class="col-sm-5" style="padding-left: 0px !important;" title="{{tag.tagName}}">
                                              <div class="btn btn-primary text-wrap" style="padding: 4px 10px;border-radius: 2px !important;">
                                                {{tag.tagName}}</div>
                                            </div>
                                          </td>
                                          <td style="padding: 5px;vertical-align: middle;"
                                            (click)="updateSelectedTags(tagsListSecondColumn[i],$event.target.checked)">
                                            <div class="col-sm-2 col-sm-offset-2">
                                              <label class="form-check-label inline">
                                                <input *ngIf="tagsListSecondColumn?.length > 0 && tagsListSecondColumn[i]"
                                                  type="checkbox" class="form-check-input "
                                                  [checked]="damUploadPostDto.tagIds != undefined && damUploadPostDto.tagIds.length > 0 && damUploadPostDto.tagIds.indexOf(tagsListSecondColumn[i].id)>-1">
                                              </label>
                                            </div>
                                            <div class="col-sm-5" style="padding-left: 5px !important;">
                                              <div *ngIf="tagsListSecondColumn?.length > 0 && tagsListSecondColumn[i]"  title="{{tagsListSecondColumn[i].tagName}}"
                                                class="btn btn-primary text-wrap" style="padding: 4px 10px;border-radius: 2px !important;">
                                                {{tagsListSecondColumn[i].tagName}}</div>
                                            </div>
                                          </td>
                                        </tr>
                                      </tbody>
                                    </table>
                                    <div
                                      *ngIf="(tagsListFirstColumn == undefined || 1 > tagsListFirstColumn.length) && (tagsListSecondColumn == undefined || 1 > tagsListSecondColumn.length)"
                                      class="alert alert-info">
                                      <strong>No Tags Found.</strong>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-4 col-lg-4 col-xs-4 col-sm-4" style="padding-left: 0;">
                          <div class="col-md-12 col-lg-12 col-xs-12 col-sm-12">
                            <!---Thumbnail Image-->
                            <!-- <label *ngIf="!isAdd" class="control-label" translate>
                                            </label> -->
                            <div>
                              <span [style.color]="invalidThumbnail ? 'red':''"><strong>Upload Thumbnail </strong></span>
                              <div class="asset-thumbnail-div-sm mThumbwidth" (click)="browseThumbnail()">
                                <input id="thumbnailFile" type="file" (change)="chooseThumbnail($event)"
                                  style="opacity: 0.0; position: absolute;">
                                <span *ngIf="showDefaultLogo && !croppedImage">
                                  <img src="assets/images/content/image.png" class="profile-image asset-img-grid-sm" alt="">
                                </span>
                                <span *ngIf="croppedImage">
                                  <a class="close-circle" (click)="$event.stopPropagation();clearThumbnailImage();" title="Remove">
                                    <i class="fa fa-times" aria-hidden="true"></i>
                                  </a>
                                  <img class="asset-img-grid-sm" [src]="croppedImage" alt="">
                                </span>
                                <span *ngIf="!isAdd && !croppedImage">
                                  <img class="asset-img-grid-sm" [src]="damUploadPostDto.thumbnailPath" (error)="errorHandler($event)"
                                    alt="">
                                </span>
                                <a class="btn btn-primary1 profile-pic" title="upload 2:1 ratio logo">
                                  &nbsp;&nbsp;<i class="fa fa-camera icon" aria-hidden="true"
                                    style="font-size:25px;padding-top:10px"></i></a>
                              </div>
                              <div class="col-xs-12 p0 top10px mWidth">
                                <div class="col-xs-12 message-content">
                                  <ul>
                                    <li translate>Maximum file size is 10 MB.</li>
                                    <li translate>Please Upload <strong>.jpg, .jpeg, .png </strong>files only.</li>
                                  </ul>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div style="text-align: center;">
                        <span class="required" *ngIf="!damUploadPostDto.validDescription && descriptionErrorMessage?.length > 0"
                          style="position: absolute;">{{descriptionErrorMessage}}</span>
                      </div>
                      <div class="col-md-12 col-lg-12 col-xs-12 col-sm-12 mb-padding">
                        <table class="table" id="description" style="margin-top: 5px;">
                          <tbody>
                            <tr>
                              <td class="desc" style="width: 11%;"><label class="control-label" translate>Description
                                  <span class="required">*</span>
                                </label></td>
                              <td class="desc">
                                <div class="mDesc">
                                  <!-- <textarea class="form-control" rows="7"  [(ngModel)]="damUploadPostDto.description"  [ngModelOptions]="{standalone: true}"  placeholder="Enter Description" maxlength="5000" (input)="validateForm('description')"></textarea> -->
                                  <ckeditor #ckeditor [(ngModel)]="damUploadPostDto.description" [ngModelOptions]="{standalone: true}"
                                    [config]="ckeConfig" (ready)="onReady($event)" debounce="500" maxlength="5000"
                                    (change)="getCkEditorData();validateForm('description')"
                                    (input)="getCkEditorData();validateForm('description')">
                                  </ckeditor>
                                </div>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
          </div>
          <div class="footer">
          <button class="btn btn-default" id="right" style="margin-right: 7px;"  type="button"  (click)="closeCircle()" translate>Cancel</button>
          <button [disabled]="!isValidForm"  id="right" style="margin-right: 5px;"  class="btn btn-primary" type="button" (click)="uploadOrUpdate()" translate>{{submitButtonText}}</button>
          </div>
          </form>
      </div>
      </ng-container>
      <ng-container *ngIf="previewItems">
        <app-image-loader  image="{{previewPath}}"></app-image-loader>
      </ng-container>
    </div>
  </div>
</div>
</ng-container>
</div>
<!---Thumbnail Modal Pop Up-->
<div class="modal right fade" id="thumbnailImageModal" tabindex="-1"
	role="dialog" aria-labelledby="thumbnailImageModal" data-keyboard="false"
	data-backdrop="static">
	<div class="modal-dialog imgCrop-modal scroll-overflow" role="document">
		<div class="modal-content rounded-0">
			<div class="modal-header">
				<h4 class="modal-title">{{thumbnailImageText}}</h4>
			</div>
         <div class="modal-body" style="overflow-y: unset !important;">
            <div>
					<ul style="padding: 0 15px;">
						<li>For optimal results, your logo should fit within the
							white rectangle.</li>
						<li>If you would like to use a different logo in an email
							template, you can change it during the template design process.</li>
					</ul>
            </div>
            <br>
				<div>
					<div [hidden]="!imageSelected">
						<image-cropper [imageChangedEvent]="imageSelected"
							[maintainAspectRatio]="false" [onlyScaleDown]="true"
							[roundCropper]="false" format="jpg" outputType="base64"
							(imageCropped)="cropThumbnailImage($event)"
							(imageLoaded)="loadThumbnailImage()"
							(imageQuality)=0 	[style.display]="showCropper ? null : 'none'"></image-cropper>
					</div>
					<div *ngIf="!imageSelected">
						<legend style="background: #cacaca; height: 227px; margin-bottom: 5px;">
						</legend>
					</div>
            </div>
            <br>
				<div>
					<button class="btn btn-primary" [disabled]="!showCropper"
						(click)="saveThumbnail()">Save Changes</button>
				</div>
			</div>
		</div>
	</div>
	<svg id="svg-filter">
        <filter id="svg-blur">
            <feGaussianBlur in="SourceGraphic" stdDeviation="1"></feGaussianBlur>
        </filter>
    </svg>
</div>

<!-- ADD TAG POPUP -->
<div *ngIf="openAddTagPopup">
  <app-add-tags-util [pagination]="pagination" [isAddTag]="true" (notifyParent)="resetTagValues($event)">
  </app-add-tags-util>
</div>