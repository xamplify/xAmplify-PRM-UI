<ngx-loading [show]="ngxloading" [config]="{ backdropBorderRadius: '14px' }"></ngx-loading>
<div class="page-content" [style.background-color]="referenceService.pageContnetBgColor">
   <div class="row">
      <div class="col-xs-12">
         <div class="tile remove_shadow_bgcolor" style="border-radius: 8px;">
            <div class="page-bar bar-border-bottom">
               <ul class="page-breadcrumb">
                  <li>
                     <i class="fa fa-home" aria-hidden="true"></i>
                     <a [routerLink]="referenceService.homeRouter">Home</a>
                     <i class="fa fa-angle-right" aria-hidden="true"></i>
                  </li>
                  <li *ngIf="!isFromApprovalModule">
                     <a [routerLink]="referenceService?.selectModuleRouter" translate>Select Module</a>
                     <i class="fa fa-angle-right" aria-hidden="true"></i>
                  </li>
                  <li *ngIf="!isFromApprovalModule">
                     <a *ngIf="isAdd" (click)="goToSelect()" translate>Design/Upload</a>
                     <a *ngIf="!isAdd" (click)="goToManageDam()" translate>Manage</a>
                     <i class="fa fa-angle-right" aria-hidden="true"></i>
                  </li>
                  <li *ngIf="isFromApprovalModule">
                     <a [routerLink]="referenceService?.approvalModuleRouter" translate>Manage Approval</a>
                     <i class="fa fa-angle-right" aria-hidden="true"></i>
                  </li>
                  <li>
                     <a>Design PDF</a>
                  </li>
               </ul>
               <a class="close-circle xamp-margin-left-icon" (click)="goBack()" aria-hidden="true">
                  <i class="fa fa-times" aria-hidden="true"></i>
               </a>
            </div>
            <ng-container *ngIf="jsonBody!=undefined && jsonBody?.length>0">
               <app-bee-template-util [beeContainerInput]="beeContainerInput"
                  (notifyParentComponent)="readBeeTemplateData($event)"></app-bee-template-util>
            </ng-container>
         </div>
      </div>
   </div>
   <app-scroll-top></app-scroll-top>
   <!--Add Asset Details------->
   <div id="addAssetDetailsPopup" class="modal fade right " role="dialog" aria-labelledby="myModalLabel"
      data-backdrop="static" data-keyboard="false">
      <div class="modal-dialog modal-css" role="document" style="width: 75% !important;">
         <!-- Modal content-->
         <div class="modal-content">
            <ngx-loading [show]="modalPopupLoader && !isCkeditorLoaded"
               [config]="{ backdropBorderRadius: '14px' }"></ngx-loading>
            <div class="modal-header">
               <div class="cf-padding-dam">
                  <a class="close-circle" (click)="hidePopup()">
                     <i class="fa fa-times" aria-hidden="true"></i>
                  </a>
                  <button class="button_blue bgcolor-unset btn-alignment mrgn_top0" style="padding-top:0px;" id="right"
                     (click)="openCreateFolderPopup()" translate><span class="btn btn-primary transition mr5">Create a
                        Folder</span></button>
               </div>
               <h4 class="modal-title" style="font-weight: 600;" translate>Add Details</h4>
            </div>
            <div class="modal-body popup-border-bottom">
               <app-response-message class="pg8" [customResponse]="customResponse" *ngIf="customResponse.isVisible">
               </app-response-message>
               <app-modal-popup-loader *ngIf="modalPopupLoader"></app-modal-popup-loader>
               <div *ngIf="!modalPopupLoader">
                  <div class="portlet box">
                     <!--Name & Folder-->
                     <div class="col-lg-12 col-md-12">
                        <div class="form-group col-md-6 col-lg-6">
                           <label>Name <span class="required">*</span></label>
                           <input class="form-control" type="text" placeholder="Name" (input)="validateForm('name')"
                              [(ngModel)]="damPostDto.name" [ngModelOptions]="{standalone: true}">
                           <span class="required" *ngIf="nameErrorMessage?.length>0">{{nameErrorMessage}}</span>
                        </div>
                        <div class="form-group  col-md-6 col-lg-6" *ngIf="showFolderDropDown">
                           <label>Folder<span class="required">*</span></label>
                           <app-select-dropdown [categoryId]="damPostDto.categoryId" [dropDownItems]="categoryNames"
                              (selectDropdownComponentEmitter)="getSelectedCategoryId($event)"></app-select-dropdown>
                        </div>
                     </div>
                     <!--Page Size & Page Orientation-->
                     <div class="col-lg-12 col-md-12">
                        <div class="form-group  col-md-6 col-lg-6">
                           <label>Select Page Size<span class="required">*</span></label>
                           <select class="form-control" id="selectedSize" [(ngModel)]="damPostDto.pageSize">
                              <option value="A0">A0</option>
                              <option value="A1">A1</option>
                              <option value="A2">A2</option>
                              <option value="A3">A3</option>
                              <option value="A4">A4</option>
                              <option value="A5">A5</option>
                              <option value="A6">A6</option>
                              <option value="A7">A7</option>
                              <option value="A8">A8</option>
                              <option value="A9">A9</option>
                              <option value="A10">A10</option>
                              <option value="B0">B0</option>
                              <option value="B1">B1</option>
                              <option value="B2">B2</option>
                              <option value="B3">B3</option>
                              <option value="B4">B4</option>
                              <option value="B5">B5</option>
                              <option value="B6">B6</option>
                              <option value="B7">B7</option>
                              <option value="B8">B8</option>
                              <option value="B9">B9</option>
                              <option value="B10">B10</option>
                           </select>
                        </div>

                        <div class="form-group  col-md-6 col-lg-6">
                           <label>Select Page Orientation<span class="required">*</span></label>
                           <select class="form-control" id="selectedOrientation"
                              [(ngModel)]="damPostDto.pageOrientation">
                              <option value="Portrait">Portrait</option>
                              <option value="Landscape">Landscape</option>
                           </select>
                        </div>
                     </div>
                     <!--White Labeled--->
                     <div class="col-lg-12 col-md-12" *ngIf="hasShareWhiteLabeledContentAccess">
                        <div class="form-group col-md-6 col-lg-6">
                           <label>White Labeled</label>
                           <app-custom-ui-switch [customSwitch]="damPostDto?.shareAsWhiteLabeledAsset"
                              (customUiSwitchEventEmitter)="setWhiteLabeled($event)"></app-custom-ui-switch>
                           <span class="info-color-xampc">
                              <i class="fa fa-question-circle toggle-info-white-label help-iconcu-inpopup"
                                 data-toggle="tooltip" data-placement="top" aria-hidden="true"
                                 title="Share As White Labeled Content"></i>
                           </span>
                        </div>
                     </div>
                      <!--XNFR-578 && XBI-3235-->
                      <div class="col-lg-12 col-md-12" *ngIf="!isPartnerView">
                        <div class="form-group col-md-6 col-lg-6">
                           <label>Add To Quick Links</label>
                           <app-custom-ui-switch [customSwitch]="damPostDto?.addedToQuickLinks"
                              (customUiSwitchEventEmitter)="setAddToQuickLinks($event)"></app-custom-ui-switch>
                           <span class="info-color-xampc">
                              <i class="fa fa-question-circle toggle-info-white-label help-iconcu-inpopup"
                                 data-toggle="tooltip" data-placement="top" aria-hidden="true"
                                 title="{{properties?.ADD_TO_QUICK_LINKS}}"></i>
                           </span>
                        </div>
                     </div>
                     <!--Description-->
                     <div class="col-lg-12 col-md-12">
                        <div class="form-group col-lg-12 col-md-12">
                           <label translate>Description</label>
                           <div *ngIf="isAddAssetDetailsPopupLoaded">
                              <ckeditor #ckeditor [(ngModel)]="damPostDto.description"
                                 [ngModelOptions]="{standalone: true}" [config]="ckeConfig" (ready)="onReady($event)"
                                 debounce="500" maxlength="5000" (change)="validateForm('description')"
                                 (input)="getCkEditorData();validateForm('description')">
                              </ckeditor>
                           </div>
                        </div>
                     </div>

                     <!--Tags---->
                     <div class="col-lg-12 col-md-12">
                        <div class="form-group col-lg-12 col-md-12">
                           <label>Tags</label>
                           <ngx-loading [show]="tagsLoader.isLoading"
                              [config]="{ backdropBorderRadius: '14px' }"></ngx-loading>
                           <div class="portlet light" style="width: 100%;padding: 5px !important;">
                              <div class="portlet-title tabbable-line " style="margin-bottom: 0px !important;">
                                 <div class="inline" style="float: right;">
                                    <div class="input-icon left" style="padding-bottom: 5px;">
                                       <input type="text" [(ngModel)]="tagSearchKey"
                                          [ngModelOptions]="{standalone: true}" placeholder="Search..."
                                          class="form-control" (keypress)="tagEventHandler($event.keyCode);"
                                          style="padding: 6px 12px;">
                                       <button type="button" class="glyphicon glyphicon-remove search-box-item-clear"
                                          *ngIf="tagSearchKey" (click)="tagSearchKey='';searchTags();"></button>
                                       <button type="button" class="search-box-item-click email-search"
                                          (click)="searchTags()">
                                          <i class="fa fa-search cesf-xamp"></i></button>
                                    </div>
                                    <div style="padding-left: 10px;">
                                       <button type="button" data-toggle="tooltip" data-placement="top"
                                          title="Add a Tag" class="btn btn-primary add-btn" (click)="addTag()">
                                          <i class="fa fa-plus" aria-hidden="true"></i></button>
                                    </div>
                                 </div>
                              </div>
                              <div class="scroller">
                                 <table class="table table-bordered no-footer tags-table" id="tags_list">
                                    <tbody>
                                       <tr role="row" *ngFor="let tag of tagsListFirstColumn;let i = index"
                                          style="vertical-align: middle;padding: 0px;">
                                          <td style="padding: 5px;vertical-align: middle; width: 50%;"
                                             (click)="updateSelectedTags(tag,$event.target.checked)">
                                             <div class="col-sm-2 col-sm-offset-2">
                                                <label class="form-check-label inline">
                                                   <input type="checkbox" class="form-check-input checkBox_shadow "
                                                      [checked]="damPostDto.tagIds != undefined && damPostDto.tagIds.length > 0 && damPostDto.tagIds.indexOf(tag.id)>-1">
                                                </label>
                                             </div>
                                             <div class="col-sm-5" style="padding-left: 0px !important; width: 60%;" data-toggle="tooltip" data-placement="bottom"
                                                title="{{tag?.tagName}}">
                                                <div class="btn text-wrap btn-primary-dark btn-primary-light"
                                                   style="padding: 4px 10px;border-radius: 2px !important;">
                                                   {{tag.tagName | slice:0:15}} <span
                                                      *ngIf="tag.tagName?.length>15">..</span>
                                                </div>
                                             </div>
                                          </td>
                                          <td style="padding: 5px;vertical-align: middle; width: 50%;"
                                             (click)="updateSelectedTags(tagsListSecondColumn[i],$event.target.checked)">
                                             <div class="col-sm-2 col-sm-offset-2">
                                                <label class="form-check-label inline">
                                                   <input
                                                      *ngIf="tagsListSecondColumn?.length > 0 && tagsListSecondColumn[i]"
                                                      type="checkbox" class="form-check-input checkBox_shadow"
                                                      [checked]="damPostDto.tagIds != undefined && damPostDto.tagIds.length > 0 && damPostDto.tagIds.indexOf(tagsListSecondColumn[i].id)>-1">
                                                </label>
                                             </div>
                                             <div class="col-sm-5" style="padding-left: 5px !important; width: 60%;" data-toggle="tooltip" data-placement="bottom"
                                                title="{{tagsListSecondColumn[i]?.tagName}}">
                                                <div *ngIf="tagsListSecondColumn?.length > 0 && tagsListSecondColumn[i]"
                                                   class="btn text-wrap btn-primary-dark btn-primary-light"
                                                   style="padding: 4px 10px;border-radius: 2px !important;">
                                                   {{tagsListSecondColumn[i].tagName | slice:0:15}} <span
                                                      *ngIf="tagsListSecondColumn[i].tagName?.length>15">..</span>
                                                </div>
                                             </div>
                                          </td>
                                       </tr>
                                    </tbody>
                                 </table>
                                 <div
                                    *ngIf="(tagsListFirstColumn == undefined || 1 > tagsListFirstColumn.length) && (tagsListSecondColumn == undefined || 1 > tagsListSecondColumn.length)"
                                    class="alert alert-info">
                                    <strong>No Tags Found.</strong>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>


                     <!---Select Partner Lists/Partners-->
                     <div class="form-group col-lg-12 col-md-12 ml15">
                        <app-list-loader *ngIf="assetPublishEmailNotificationLoader"></app-list-loader>
                        <app-partner-company-and-groups *ngIf="!assetPublishEmailNotificationLoader &&
                        ((!authenticationService?.approvalRequiredForAssets && damPostDto?.approvalStatus !== 'REJECTED')
                           || (authenticationService?.approvalRequiredForAssets && ((!isAdd && isApprover && damPostDto?.createdByAnyApprover) || (isAdd && isApprover))) || damPostDto?.approvalStatus == 'APPROVED')"
                           [moduleName]="'dam'" [isAssetPublishedEmailNotification]="isAssetPublishedEmailNotification"
                           [inputId]="assetId"
                           (partnerCompanyAndGroupsEventEmitter)="receivePartnerCompanyAndGroupsEventEmitterData($event)">
                        </app-partner-company-and-groups>
                     </div>
                  </div>
               </div>
            </div>
            <div class="modal-footer cmr" style="border:none;border-top:none !important" *ngIf="!modalPopupLoader">
               <button class="btn Btn-Gray neg_mrg_top4" type="reset" (click)="hidePopup();" translate>Cancel</button>
               <button type="button" class="button_blue bgcolor-unset preview_pdf_btn" (click)="downloadPdf()"><span
                     class="btn btn-primary transition txt_pd-top3">Download <a
                        style="font-weight: 100;font-size: x-small;color: #fff;">(Preview PDF)</a></span></button>
               
               <!-- XNFR-884 -->
               <button type="button" class="button_blue bgcolor-unset"
                  [disabled]="!validForm || disableSaveAsDraftButton || damPostDto?.published" (click)="saveOrUpdateAsset(false)"
                  data-placement="top"
                  [attr.title]="damPostDto?.published ? properties.CANNOT_SAVE_DRAFT_ASSET_ALREADY_PUBLISHED :
                     disableSaveAsDraftButton ? properties.CANNOT_SAVE_DRAFT_WITH_SELECTED_PARTNERS : properties.DRAFT_ASSET_CANNOT_BE_PUBLISHED_OR_USED_IN_TRACKS_PLAYBOOKS"
                  translate>
                  <span class="btn btn-primary transition txt_pd-top3">{{saveAsDraftButtonText}}</span>
               </button>

               <button type="button" class="button_blue bgcolor-unset" [disabled]="!validForm"
                  (click)="saveOrUpdate(false)" translate><span
                     class="btn btn-primary transition txt_pd-top3">{{saveOrUpdateButtonText}}</span></button>

               <button *ngIf="!isAdd" type="button" class="button_blue bgcolor-unset" [disabled]="!validForm"
                  (click)="saveOrUpdate(true)" translate><span
                     class="btn btn-primary transition txt_pd-top3">{{saveAsButtonText}}</span>
               </button>
            </div>
         </div>
      </div>
   </div>
   <!-- ADD TAG POPUP -->
   <div *ngIf="openAddTagPopup">
      <app-add-tags-util [pagination]="pagination" [isAddTag]="true" (notifyParent)="resetTagValues($event)">
      </app-add-tags-util>
   </div>
   <app-add-folder-modal-popup #addFolderModalPopupComponent
      (notifyChild)="showFolderCreatedSuccessMessage($event)"></app-add-folder-modal-popup>