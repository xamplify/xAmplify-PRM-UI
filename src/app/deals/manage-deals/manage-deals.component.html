<div class="page-content" *ngIf="!showDealForm">
  <div id="deals-page-content-div">
    <div>
      <div class="page-bar mb-height_auto">
        <div class="col-xs-12 col-sm-12 col-lg-12 p0-neo-dark">
          <div class="col-xs-12 col-sm-3 col-lg-4">
            <ul class="page-breadcrumb pbc-m3">
              <li *ngIf="!authenticationService.isSuperAdmin()">
                <i class="fa fa-home" aria-hidden="true"></i>
                <a [routerLink]="referenceService.homeRouter" translate>Home</a>
                <i class="fa fa-angle-right" aria-hidden="true"></i>
              </li>
              <li>
                <a>Deals</a>
              </li>
            </ul>
          </div>
          <div class="col-xs-12 col-sm-9 col-lg-8 p0">
            <ul class="mix-filter p0 m0" style="float: right;padding-top:1.5px !important;margin-right: -9px !important;"
              *ngIf="!authenticationService.vanityURLEnabled && authenticationService?.module?.isAdminAndPartnerCompany">
              <!--Partner View-->
              <li class="filter float-right mt5 deal_view_type_css" (click)="showPartner()"
                [class.campaign-type-selected]="isPartnerVersion">
                Partner View
                <i *ngIf="isPartnerVersion" class="fa fa-check-circle-o check-icons"></i>
              </li>
              <!--Vendor View-->
              <li *ngIf="authenticationService?.enableLeads" class="filter float-right mt5" (click)="showVendor()"
                [class.campaign-type-selected]="isVendorVersion">
                Vendor View<i *ngIf="isVendorVersion" class="fa fa-check-circle-o check-icons"></i>
              </li>
              <p class="filter float-right m10">Opportunities as: </p>
            </ul>
            <div style="padding: 3px 3px 3px 0px;">
            <app-user-guide-help-button [mergeTag]="mergeTagForGuide"></app-user-guide-help-button>
          </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-xs-12">
          <div class="row">
            <!--  Start Tiles-->
            <div class="col-xs-12 col-md-12 col-sm-12">
              <div class="page-bar" style="padding: 15px 15px 15px 0px">
                <app-box-loader [countLoader]="3" *ngIf="countsLoader"></app-box-loader>
                <!-- -------Total Deals------- -->
                <div class="col-xs-12 col-sm-4 col-md-4 pr0 pb15 tiles_hover_effect" *ngIf="!countsLoader"
                  [style.pointer-events]="counts.totalDeals != 0 ? 'auto' : 'none' ">
                  <a class="dashboard-stat dashboard-stat-lighter purple-soft" [class.greay]="1!=selectedTabIndex"
                    (click)="showDeals()">
                    <div class="visual">
                      <i class="fa fa-check-circle"
                        style="margin-left: 0px;font-size: 40px;line-height: 60px;opacity: 1"
                        [ngStyle]="{'color': 1==selectedTabIndex ? '#white' : '#ccc' }" *ngIf=" 1==selectedTabIndex"
                        aria-hidden="true"></i>
                    </div>
                    <div class="details">
                      <div class="number">
                        <span>{{counts.totalDeals}}</span>
                      </div>
                      <div class="desc" style="font-weight:500" translate>Total Deals</div>
                    </div>
                    <span id="permhref" class="morePadding ">
                      <a class="more" translate> Detailed view <i class="m-icon-swapright m-icon-white"
                          aria-hidden="true"></i></a>
                    </span>
                  </a>
                </div>

                <!-- -------Won Deals------- -->
                <div class="col-xs-12 col-sm-4 col-md-4 pr0 pb15 tiles_hover_effect" *ngIf="!countsLoader"
                  [style.pointer-events]="counts.wonDeals != 0 ? 'auto' : 'none' ">
                  <a class="dashboard-stat dashboard-stat-lighter purple-soft" [class.greay]="2!=selectedTabIndex"
                    (click)="showWonDeals()">
                    <div class="visual">
                      <i class="fa fa-check-circle"
                        style="margin-left: 0px;font-size: 40px;line-height: 60px;opacity: 1"
                        [ngStyle]="{'color': 2==selectedTabIndex ? '#white' : '#ccc' }" *ngIf=" 2==selectedTabIndex"
                        aria-hidden="true"></i>
                    </div>
                    <div class="details">
                      <div class="number">
                        <span>{{counts.wonDeals}}</span>
                      </div>
                      <div class="desc" style="font-weight:500" translate>Won Deals</div>
                    </div>
                    <span id="permhref" class="morePadding ">
                      <a class="more" translate> Detailed view <i class="m-icon-swapright m-icon-white"
                          aria-hidden="true"></i></a>
                    </span>
                  </a>
                </div>

                <!-- -------Lost Deals------- -->
                <div class="col-xs-12 col-sm-4 col-md-4 pr0 tiles_hover_effect" *ngIf="!countsLoader"
                  [style.pointer-events]="counts.lostDeals != 0 ? 'auto' : 'none' ">
                  <a class="dashboard-stat dashboard-stat-lighter purple-soft" [class.greay]="3!=selectedTabIndex"
                    (click)="showLostDeals()">
                    <div class="visual">
                      <i class="fa fa-check-circle"
                        style="margin-left: 0px;font-size: 40px;line-height: 60px;opacity: 1"
                        [ngStyle]="{'color': 3==selectedTabIndex ? '#white' : '#ccc' }" *ngIf=" 3==selectedTabIndex"
                        aria-hidden="true"></i>
                    </div>
                    <div class="details">
                      <div class="number">
                        <span>{{counts.lostDeals}}</span>
                      </div>
                      <div class="desc" style="font-weight:500" translate>Lost Deals</div>
                    </div>
                    <span id="permhref" class="morePadding ">
                      <a class="more" translate> Detailed view <i class="m-icon-swapright m-icon-white"
                          aria-hidden="true"></i></a>
                    </span>
                  </a>
                </div>
              </div>
            </div>
            <!-- End Tiles-->
          </div>
        </div>


      </div>

      <app-response-message class="pg8" [customResponse]="dealsResponse"
        *ngIf="dealsResponse.isVisible"></app-response-message>
      <!-- -----------------------------Deals List-------------------------------------- -->
      <div class="row">
        <div class="col-md-12">
          <div class="page-bar remove_cardBgcolor padding_0 p10 bg-none light_bg_removal remove_space" id="header">
            <div class="portlet-title">
              <div *ngIf="!showCampaignDeals">
                <!-- XNFR-148 -->
                <div *ngIf="!httpRequestLoader.isLoading">
                  <h4 class="text-primary pull-left ml0">{{titleHeading}} Deals</h4>
                  <div class="col-xs-12 col-sm-5 col-lg-5" *ngIf="isVendorVersion">
                    <app-team-member-filter-option *ngIf="!authenticationService?.module?.isMarketingCompany"
                      [customSelectedIndex]="selectedFilterIndex"
                      (teamMemberFilterOptionEventEmitter)="getSelectedIndex($event)"></app-team-member-filter-option>
                  </div>
                  <div class="page-toolbar col-xs-12 col-sm-5 col-lg-6 pull-right" style="padding: 0px 4px 8px 0px;">
                    <div class="btn-group pull-right width">
                      <ng-container class='m10' *ngIf="!prm || !isVendorVersion">
                        <span data-placement="bottom" (click)="setListView()"
                          class="btn btn-xs hidden-xs l-g-view mrg_rgt5" data-toggle="tooltip"
                          [class.disabled]="listView" title="List View">
                          <i aria-hidden="true" class="fa fa-th-list p10"></i>
                        </span>
                        <span *ngIf="authenticationService?.module?.isCampaign"
                          [ngClass]="authenticationService?.module?.isCampaign ? 'margin-right' : 'mr0'"
                          data-placement="bottom" style="margin-left: 4px !important;"
                          class="btn btn-xs hidden-xs l-g-view" data-toggle="tooltip" title="Campaign View"
                          [class.disabled]="!listView" (click)="setCampaignView()">
                          <i _ngcontent-c17="" aria-hidden="true" class="fa fa-folder-open p10"></i>
                        </span>

                      </ng-container>
                      <button data-placement="bottom" class="btn btn-xs hidden-xs l-g-view" style="margin-right: 4px;"
                        data-toggle="tooltip" title="Click here to email the report"
                        [disabled]="dealsSortOption.totalRecords == 0" *ngIf="listView"
                        (click)="exportExcelSelection()">
                        <i _ngcontent-c17="" aria-hidden="true" class="fas fa-file-export p10"></i>
                      </button>
                      <a *ngIf="(isPartnerVersion || isOrgAdmin || authenticationService.module.isMarketingCompany) && !authenticationService?.module?.deletedPartner && isRegisterDealEnabled &&  !this.authenticationService.module.isPrmTeamMember"
                        (click)="addDeal()" style="padding-left: 11px;">
                        <button class="button_blue bgcolor-unset p0 btn-transitions mrgt1-2" translate>
                          <span class="btn btn-primary transition d-inline"><i class="fa fa-plus"
                              aria-hidden="true"></i>{{DEAL_CONSTANTS?.registerADeal}}</span>
                        </button>
                      </a>

                      <a *ngIf="(isVendorVersion && activeCRMDetails?.activeCRM && activeCRMDetails?.type != 'MARKETO') || (isPartnerVersion && (activeCRMDetails?.type == 'CONNECTWISE' || activeCRMDetails?.type == 'HALOPSA' || this.authenticationService.module.isPrmTeamMember))"

                        (click)="syncLeadsWithActiveCRM()">
                        <!-- <button class="btn btn-white salesforce-btn button neg-mar-top bgcolor-unset" -->
                        <button class="btn salesforce-btn button bgcolor-unset p0 btn-transitions mrgt-2 mrgt1-2"
                          data-toggle="tooltip" data-placement="bottom" title="Synchronize" translate>

                          <span class="btn Btn-Green transition text_pd-top1 pt-7">
                            <i class="fa fa-refresh" aria-hidden="true"></i>
                            <span *ngIf="activeCRMDetails?.type==='HUBSPOT'">HubSpot</span>
                            <span *ngIf="activeCRMDetails?.type!='HUBSPOT'">{{ activeCRMDetails?.type | titlecase
                              }}</span>
                          </span>

                        </button>
                      </a>

                      <a *ngIf="isVendorVersion && syncMicrosoft" (click)="syncLeadsWithMicrosoft()">
                        <button class="btn btn-white Synchronize_btn" style="margin-right: -7px;" data-toggle="tooltip"
                          data-placement="bottom" title="Synchronize with Microsoft Dynamics" translate>
                          <i class="fa fa-refresh" aria-hidden="true"></i> Microsoft Dynamics
                        </button>
                      </a>

                      <div class="inputs" align="right" style="float: right; display: inline-flex;">
                        <div class="portlet-input input-inline" style="display: table-cell; margin-right: 15px;">
                          <div class="input-icon right" style="position: relative;right: -11px;">
                            <input type="text" class="form-control" [(ngModel)]="dealsSortOption.searchKey"
                              [ngModelOptions]="{standalone: true}" placeholder="Search"
                              (keypress)="dealEventHandler($event.keyCode)">
                            <button class="glyphicon glyphicon-remove search-box-item-clear"
                              *ngIf="dealsSortOption.searchKey" (click)="clearSearch()"></button>
                            <button type="submit" class="search-box-item-click" (click)="searchDeals()">
                              <i class="fa fa-search" aria-hidden="true"></i>
                            </button>
                          </div>
                        </div>
                        <span data-placement="bottom" class="btn btn-xs hidden-xs l-g-view" data-toggle="tooltip"
                          title="Filter" *ngIf="listView" (click)="toggleFilterOption()">
                          <i _ngcontent-c17="" aria-hidden="true" class="fa fa-filter p10"></i>
                        </span>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- -------------------- Apply Filters Box-------------------- -->
                <div class="row"
                  *ngIf="showFilterOption && !httpRequestLoader.isLoading && !httpRequestLoader.isServerError">
                  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                    <div class="portlet light">
                      <div class="portlet-title">
                        <div class="caption" translate>Apply Filters</div>
                        <button type="button" class="close-circle" style="margin-left: 10px;"
                          (click)="closeFilterOption()">
                          <i class="fa fa-times" aria-hidden="true"></i>
                        </button>
                        <div class="form-group" style="text-align: -webkit-right;">
                          <button class="button bgcolor-unset neg_mrgn_top4 mrgn_top0" type="button"
                            (click)="validateDateFilters()">
                            <span class="btn Btn-Green transition txt_pd-top3">Filter</span>
                          </button>
                        </div>
                      </div>
                      <!--Filter Options-->
                      <div class="portlet-body clearfix">
                        <app-response-message class="pg8" [customResponse]="filterResponse"
                          *ngIf="filterResponse.isVisible"></app-response-message>
                        <form class="form-horizontal form-bordered form-label-stripped">
                          <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
                            <!--From Date-->
                            <div class="form-group">
                              <label class="control-label col-sm-5">From Date</label>
                              <div class="col-sm-7">
                                <app-date-picker [(dataField)]="fromDateFilter" [isFromFilter]='true'></app-date-picker>
                              </div>
                            </div>

                            <!--Added By User-->
                            <div class="form-group">
                              <label class="control-label col-sm-5">{{DEAL_CONSTANTS.addedBy}}</label>
                              <div class="col-sm-7">
                                <p class="mt--10px" *ngIf="registeredByUsersLoader">
                                  <strong><img class="h-50px" src="../../../assets/images/Spinner.gif" alt="">Loading
                                    {{DEAL_CONSTANTS.addedBy}}...</strong>
                                </p>
                                <app-searchable-dropdown
                                  *ngIf="!registeredByUsersLoader && isRegisteredByUsersLoadedSuccessfully"
                                  [searchableDropDownDto]="registeredByUsersSearchableDropDownDto"
                                  [id]="selectedRegisteredByUserId" [disableDropDown]="false"
                                  (searchableDropdownEventEmitter)="getSelectedRegisteredByUserId($event)">
                                </app-searchable-dropdown>
                                <p class="required"
                                  *ngIf="!registeredByUsersLoader && !isRegisteredByUsersLoadedSuccessfully">
                                  <strong>{{properties?.SOMTHING_WENT_WRONG}}</strong>
                                </p>
                              </div>
                            </div>
                            <!--Status-->
                            <div class="form-group">
                              <label class="control-label col-sm-5">Status</label>
                              <div class="col-sm-7">
                                <p class="mt--10px" *ngIf="statusLoader">
                                  <strong><img class="h-50px" src="../../../assets/images/Spinner.gif" alt="">Loading
                                    Status...</strong>
                                </p>
                                <app-searchable-dropdown *ngIf="!statusLoader && isStatusLoadedSuccessfully"
                                  [searchableDropDownDto]="statusSearchableDropDownDto" [id]="statusFilter"
                                  [disableDropDown]="false"
                                  (searchableDropdownEventEmitter)="getSelectedStatus($event)">
                                </app-searchable-dropdown>
                                <p class="required" *ngIf="!statusLoader && !isStatusLoadedSuccessfully">
                                  <strong>{{properties?.SOMTHING_WENT_WRONG}}</strong>
                                </p>
                              </div>
                            </div>
                          </div>

                          <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
                            <!--To Date-->
                            <div class="form-group">
                              <label class="control-label col-sm-5">To Date</label>
                              <div class="col-sm-7">
                                <app-date-picker [(dataField)]="toDateFilter" [isFromFilter]='true'></app-date-picker>
                              </div>
                            </div>
                            <!--Added By Company-->
                            <div class="form-group" *ngIf="isVendorVersion">
                              <label class="control-label col-sm-5">{{DEAL_CONSTANTS?.addedBy}} Company</label>
                              <div class="col-sm-7">
                                <p class="mt--10px" *ngIf="registeredByCompanyLoader">
                                  <strong><img class="h-50px" src="../../../assets/images/Spinner.gif" alt="">Loading
                                    Companies...</strong>
                                </p>
                                <app-searchable-dropdown
                                  *ngIf="!registeredByCompanyLoader && isRegisteredByCompaniesLoadedSuccessfully"
                                  [searchableDropDownDto]="registeredByCompaniesSearchableDropDownDto"
                                  [id]="selectedRegisteredByCompanyId" [disableDropDown]="false"
                                  (searchableDropdownEventEmitter)="getSelectedRegisteredByCompanyId($event)">
                                </app-searchable-dropdown>
                                <p class="required"
                                  *ngIf="!registeredByCompanyLoader && !isRegisteredByCompaniesLoadedSuccessfully">
                                  <strong>{{properties?.SOMTHING_WENT_WRONG}}</strong>
                                </p>
                              </div>
                            </div>
                            <!--Added For-->
                            <div class="form-group" *ngIf="isPartnerVersion && !vanityLoginDto?.vanityUrlFilter">
                              <label class="control-label col-sm-5">Added For</label>
                              <div class="col-sm-7">
                                <app-searchable-dropdown *ngIf="!registeredForCompaniesLoader"
                                  [searchableDropDownDto]="registeredForCompaniesSearchableDropDownDto"
                                  [id]="vendorCompanyIdFilter" [disableDropDown]="false"
                                  (searchableDropdownEventEmitter)="getSelectedRegisteredForCompanyId($event)">
                                </app-searchable-dropdown>
                              </div>
                            </div>
                          </div>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>

                <app-list-loader
                  *ngIf="httpRequestLoader.isLoading && !httpRequestLoader.isServerError"></app-list-loader>
                <section class='col-xs-12 col-sm-12 col-md-12 col-lg-12 p0'
                  [hidden]="!listView || dealsSortOption.totalRecords == 0 || httpRequestLoader.isLoading || httpRequestLoader.isServerError">
                  <div class="table-responsive pt_12" [hidden]="httpRequestLoader.isLoading">
                    <table class='table tgrid table-hover table-sm' aria-describedby="dealTable">
                      <thead>
                        <tr>
                          <th class="center-aligned" translate>Deal Details</th>
                          <th class="center" translate>{{DEAL_CONSTANTS.addedBy}}</th>
                          <th class="center" translate>Status</th>
                          <th style="width: 18%; text-align:right" translate>Actions</th>
                        </tr>
                      </thead>
                      <tbody>
                        <ng-container *ngFor='let deal of dealsPagination.pagedItems; let i=index'>
                          <tr>
                            <td style="width: 40%;padding: 10px;">
                              <div><span data-toggle="tooltip" data-placement="top" title="{{deal.title}}"><b>Deal
                                    Name:</b> {{deal.title | slice:0:30}}
                                  <span *ngIf="deal.title?.length>30">...</span></span>
                              </div>
                              <div>
                                <span *ngIf="isVendorVersion"><b>Deal Id:</b> {{deal.referenceId}}</span>
                              </div>
                              <div>
                                <span *ngIf="isVendorVersion && deal?.activeCRM"><b>CRM Id:</b> {{deal.crmId}}</span>
                              </div>
                              <div data-toggle="tooltip" data-placement="bottom" title="{{deal.createdForCompanyName}}">
                                <h5 *ngIf="isPartnerVersion"><b>Added For:</b>
                                  <span style="color: #5b9bd1;">{{deal.createdForCompanyName | slice:0:30}}
                                    <span *ngIf="deal.createdForCompanyName?.length>30">...</span>
                                  </span>
                                </h5>
                              </div>
                              <div>
                                <h5 *ngIf="isPartnerVersion && deal?.campaignId > 0" data-toggle="tooltip" data-placement="bottom"
                                  title="{{deal.campaignName}}"><b>Campaign:</b>
                                  <span style="color: #5b9bd1;">{{deal.campaignName | slice:0:30}}
                                    <span *ngIf="deal.campaignName?.length>30">...</span>
                                  </span>
                                </h5>
                                <h5 *ngIf="isVendorVersion && deal?.parentCampaignId > 0" data-toggle="tooltip" data-placement="bottom"
                                  title="{{deal.parentCampaignName}}"><b>Campaign:</b>
                                  <span style="color: #5b9bd1;">{{deal.parentCampaignName | slice:0:30}}
                                    <span *ngIf="deal.campaignName?.length>30">...</span>
                                  </span>
                                </h5>
                              </div>

                            </td>
                            <td style="width: 20%;">
                              <h5 *ngIf="!isPartnerVersion" data-toggle="tooltip" data-placement="bottom"
                                title="{{deal.createdByCompanyName}}">{{deal.createdByCompanyName | slice:0:30}}
                                <span *ngIf="deal.createdByCompanyName?.length>30">...</span>
                              </h5>
                              <h5 class='m_t_view' data-toggle="tooltip" data-placement="bottom"
                                title="{{deal.createdByName}}" style="margin: 7px 0 2px 0;font-weight: 400;">
                                {{deal.createdByName | slice:0:20}}
                                <span *ngIf="deal.createdByName?.length>20">...</span>
                              </h5>
                              <h6 class='m0' style="font-weight: 400;">
                                <a data-toggle="tooltip" data-placement="bottom"
                                  title="{{deal.createdByEmail}}">{{deal.createdByEmail | slice:0:30}}</a>
                                <span *ngIf="deal.createdByEmail?.length>30">...</span>
                              </h6>
                              <h5 style="font-weight: 600; color: #676767;">
                                <app-timestamp [isOnlyDate]="false" [dateAndTime]="deal.createdTime">
                                </app-timestamp>
                              </h5>
                              <h6 *ngIf="deal?.partnerStatus === 'deactivated'" class="green-banner inline-flex" data-toggle="tooltip"
                                data-placement="bottom" title="Partnership is deactivated">DEACTIVATED</h6>
                            </td>
                            <td style="width: 20%;">
                              <span class="comment-color" translate>
                                {{deal.currentStageName}}</span>

                              <!-- xnfr-426-->
                              <a *ngIf="(deal?.showDealActions && deal?.showEditDealStage) || (isVendorVersion && deal?.showEditDealStage)"
                                data-rel="fancybox-button" (click)="updatePipelineStage(deal,authenticationService?.module?.deletedPartner)"
                                data-toggle="tooltip" data-placement="bottom" title="Edit Deal Stage"
                                [hidden]="deal?.partnerStatus === 'deactivated'">
                                <span class="fa fa-edit mr5 IconCustomization" aria-hidden="true"></span>
                              </a>

                            </td>
                            <td style="width: 20%;">
                              <div class="actions-block override-actions actionbtn">
                                <a class="custom-icon" data-rel="fancybox-button" (click)="viewDeal(deal)"
                                  data-toggle="tooltip" data-placement="bottom" title="View Deal" id="deal">
                                  <i class="fa fa-eye mr5 IconCustomization" aria-hidden="true"></i>
                                  <div class="clickicons"></div>
                                </a>
                                <span *ngIf="deal.unReadPropertyChatCount > 0 && dealsCount" class="badge badge-default notify-badge"
                                  style="margin-bottom: 25px; margin-left: -15px;background-color: #ed1c24 !important;">{{deal.unReadPropertyChatCount}}</span>
                                <ng-container *ngIf="!authenticationService?.module?.deletedPartner">
                                  <a class="custom-icon" data-rel="fancybox-button"
                                    *ngIf="deal.canUpdate && !(isPartnerVersion && deal?.onNonInteractiveStage)"
                                    (click)="deal?.showDealActions?editDeal(deal):''" data-toggle="tooltip" data-placement="bottom"
                                    title="Edit Deal" id="deal">
                                    <i [ngClass]="deal?.showDealActions? '':'disabled gray'" aria-hidden="true"
                                    class="fa fa-edit mr5 IconCustomization"></i>
                                    <div class="clickicons"></div>
                                  </a>
                                  <a class="custom-icon" data-rel="fancybox-button"
                                    *ngIf="deal.canUpdate && !(isPartnerVersion && deal?.onNonInteractiveStage)"
                                    (click)="deal?.showDealActions ? confirmDeleteDeal(deal):''" data-toggle="tooltip" data-placement="bottom"
                                    title="Delete Deal" id="deal">
                                    <i [ngClass]="deal?.showDealActions ? '':'disabled gray'" aria-hidden="true" class="fa fa-trash-o trashIconCustomization"></i>
                                    <div class="del-icon"></div>
                                  </a>
                                </ng-container>

                                <a class="custom-icon" *ngIf="true" data-rel="fancybox-button"
                                  (click)="showComments(deal)" data-toggle="tooltip" data-placement="bottom"
                                  title="Comments/History">
                                  <i class="fa fa-comments IconCustomization" aria-hidden="true" style="font-size:18px">
                                  </i>
                                  <div class="clickicons"></div>
                                </a>
                                <span *ngIf="deal.unReadChatCount > 0" class="badge badge-default notify-badge"
                                  style="margin-bottom: 25px; margin-left: -15px;background-color: #ed1c24 !important;">{{deal.unReadChatCount}}</span>
                              </div>
                            </td>
                          </tr>

                        </ng-container>
                      </tbody>
                    </table>
                  </div>

                  <!-- --------------------Pagination0-------------------- -->
                  <div *ngIf="!httpRequestLoader.isLoading" class="pg8 pos_mrg_top8">
                    <app-pagination [pagination]="dealsPagination" (notifyParent)="setDealsPage($event)"
                      (notifyParentDropDown)="listDeals($event)"></app-pagination>
                  </div>
                  <!-- End of 24 -->
                  <div
                    *ngIf="!httpRequestLoader.isLoading && dealsPagination.totalRecords==0 && !httpRequestLoader.isLoading"
                    class="alert alert-info">
                    <strong translate>No Deals Found.</strong>
                  </div>

                </section>
                <div *ngIf="listView && !httpRequestLoader.isLoading && dealsSortOption.totalRecords==0"
                  class="col-xs-12 col-sm-12 col-md-12 col-lg-12 alert alert-info">
                  <strong>No Deals Found.</strong>
                </div>

                <!-- -------------------- Campaign Level View -------------------- -->
                <app-list-loader *ngIf="!listView && campaignRequestLoader?.isLoading"></app-list-loader>
                <section class='col-xs-12 col-sm-12 col-md-12 col-lg-12 p0'
                  [hidden]="listView || campaignSortOption.totalRecords == 0 || campaignRequestLoader.isLoading || campaignRequestLoader.isServerError">
                  <div class="table-responsive pt_12" [hidden]="campaignRequestLoader.isLoading">
                    <table class='table tgrid table-hover table-sm' aria-describedby="leadTable">
                      <thead>
                        <tr>
                          <th class="center-aligned" translate></th>
                          <th class="center" translate>Campaign Name</th>
                          <th class="center" translate>Launched On</th>
                          <th class="center">Count</th>
                        </tr>
                      </thead>
                      <tbody>
                        <ng-container *ngFor='let campaign of campaignPagination.pagedItems; let i=index'>
                          <tr>
                            <td style="width: 10%;" class="hidden-xs">
                              <img class="image_effect" *ngIf="campaign.campaignType.indexOf('VIDEO') > -1"
                                src="assets/images/video-email.svg" style="height: 35px;"
                                alt="{{campaign.campaignType}} Campaign">
                              <img class="image_effect" *ngIf="campaign.campaignType.indexOf('REGULAR') > -1"
                                src="assets/images/regular-email.svg" style="height: 35px;"
                                alt="{{campaign.campaignType}} Campaign">
                              <img class="image_effect" *ngIf="campaign.campaignType.indexOf('SOCIAL') > -1 "
                                src="assets/images/social-campaign.svg" style="height: 35px;"
                                alt="{{campaign.campaignType}} Campaign">
                              <img class="image_effect" *ngIf="campaign.campaignType.indexOf('EVENT') > -1 "
                                src="assets/images/event-campaign.svg" style="height: 35px;"
                                alt="{{campaign.campaignType}} Campaign">
                              <img class="image_effect" *ngIf="campaign.campaignType.indexOf('LANDINGPAGE') > -1 "
                                src="assets/images/landing-page.svg" style="height: 35px;"
                                alt="{{campaign.campaignType}} Campaign">
                              <img class="image_effect" *ngIf="campaign.campaignType.indexOf('SURVEY') > -1 "
                                src="assets/images/survey.svg" style="height: 35px;"
                                alt="{{campaign.campaignType}} Campaign">
                            </td>
                            <td>
                              <h4 class="ellipsis mt5 mb5 f-w-600" style="font-size: 14px;">
                                <span data-toggle="tooltip" data-placement="bottom"
                                  title="{{campaign.campaign}}">{{campaign.campaign|
                                  slice:0:25}}</span>
                                <span *ngIf="campaign.campaign?.length>25">...</span>
                              </h4>
                            </td>
                            <td class="center hidden-xs">
                              <span align="right">
                                <strong translate>Launched On</strong>
                              </span>
                              <span align="right" data-toggle="tooltip" data-placement="bottom" title="Launch Date">
                                <strong>
                                  <app-timestamp [isOnlyDate]="false" [dateAndTime]="campaign.launchTimeInString">
                                  </app-timestamp>
                                </strong>
                              </span>
                            </td>
                            <td>
                              <a class="custom-icon" data-toggle="tooltip" data-placement="top" title="Number of Deals"
                                style="cursor: default">
                                <i
                                  class="circled-number IconCustomization fontStyleNormal"><strong>{{campaign.leadsCount}}</strong></i>
                                <div class="clickicons"></div>
                              </a>

                              <a class="custom-icon" *ngIf="campaign.channelCampaign" (click)="showPartners(campaign)"
                                data-toggle="tooltip" data-placement="top" title="View deals for this campaign">
                                <i class="circled-number fa IconCustomization"
                                  [ngClass]="{'fa-plus': !campaign.expand, 'fa-minus': campaign.expand}"
                                  aria-hidden="true"></i>
                                <div class="clickicons"></div>
                              </a>

                              <a class="custom-icon" *ngIf="!campaign.channelCampaign" (click)="showPartners(campaign)"
                                data-toggle="tooltip" data-placement="top" title="View deals for this campaign">
                                <i class="circled-number fa fa-users IconCustomization" aria-hidden="true"></i>
                                <div class="clickicons"></div>
                              </a>

                            </td>
                          </tr>

                          <!-- -------------------- Partners List -------------------- -->
                          <tr [ngClass]="{'hidden': !campaign.expand}">
                            <td colspan="8" style="padding-right: 0px !important;">
                              <div class="row" *ngIf="showPartnerList" style="width: 100%;">
                                <div class="col-xs-12 p5" style="padding-right: 0px !important">
                                  <div class="portlet light"  *ngIf="vendorSelfDealsWithCountList != undefined && vendorSelfDealsWithCountList.length > 0">
                                    <div class="caption">
                                      <span
                                        class="caption-subject font-red-sunglo uppercase">Vendor</span>
                                    </div>
                                    <div class="portlet-title" style="border-bottom: none">
                                      <!-- <div class="row" id="box" *ngIf="partnerRequestLoader.isServerError">
                                        Please contact admin for "Campaings"
                                      </div> -->
                                      <app-list-loader
                                        *ngIf="vendorSelfDealsRequestLoader">
                                      </app-list-loader>
                                      <div class="portlet-body table-responsive" style="overflow: hidden;"
                                      [hidden]="vendorSelfDealsWithCountList == undefined || vendorSelfDealsWithCountList.length == 0">
                                        <div class="table-responsive" [hidden]="vendorSelfDealsRequestLoader">
                                          <table class="table tgrid">
                                            <thead>
                                              <tr>
                                                <th class="center-aligned width-76">Vendor
                                                  <i class="fa fa-info-circle info_circle"  data-toggle="tooltip" data-placement="right"
                                                    title="Vendor converted deals count"></i>
                                                </th>
                                                <th class="center">#Deals Count</th>
                                              </tr>
                                            </thead>
                                            <tbody>
                                              <ng-container *ngFor="let item of vendorSelfDealsWithCountList;let i=index">
                                                <tr>
                                                  <td>
                                                    <app-user-info [userInfo]="item" [isPartnerInfo]="true" [isPartnerEntityInfo]="true" [hideEmptyBar]="true"></app-user-info>
                                                  </td>
                                                  <td>
                                                    <a class="custom-icon" (click)="showCampaignDealsByVendor(item)"
                                                    data-toggle="tooltip" data-placement="top" title="Number Of Deals">
                                                    <i
                                                      class="circled-number IconCustomization fontStyleNormal"><b>{{item.totalDeals}}</b></i>
                                                    <div class="clickicons"></div>
                                                  </a>
                                                  </td>
                                                </tr>
                                              </ng-container>
                                            </tbody>
                                          </table>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                                <div class="col-xs-12 p5" style="padding-right: 0px !important">
                                  <div class="portlet light">
                                    <div class="portlet-title" style="border-bottom: none">
                                      <div class="caption">
                                        <span
                                          class="caption-subject font-red-sunglo uppercase">{{authenticationService?.partnerModule?.customName}}</span>
                                      </div>
                                      <div class="inputs" align="right" style="float: right; display: flex;">
                                        <div class="portlet-input input-inline input-medium"
                                          style="margin-right: 10px;">
                                          <div class="input-icon right" style="position: relative;right: -11px;">
                                            <input type="text" style="height:34px;" class="form-control"
                                              [(ngModel)]="partnerSortOption.searchKey"
                                              [ngModelOptions]="{standalone: true}"
                                              placeholder="Search for a {{authenticationService?.partnerModule?.customName}}"
                                              (keypress)="searchPartnersKeyPress($event.keyCode)">
                                            <button class="glyphicon glyphicon-remove search-box-item-clear"
                                              *ngIf="partnerSortOption.searchKey"
                                              (click)="clearPartnerSearch()"></button>
                                            <button type="submit" class="search-box-item-click"
                                              (click)="searchPartners()"><i class="fa fa-search"></i></button>
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                    <div class="row" id="box" *ngIf="partnerRequestLoader.isServerError">
                                      Please contact admin for "Campaings"
                                    </div>
                                    <app-list-loader
                                      *ngIf="partnerRequestLoader.isLoading && !partnerRequestLoader.isServerError">
                                    </app-list-loader>
                                    <div class="portlet-body table-responsive" style="overflow: hidden;"
                                      [hidden]="partnerRequestLoader.isLoading || partnerRequestLoader.isServerError||partnerSortOption.totalRecords == 0">
                                      <div class="table-responsive" [hidden]="partnerRequestLoader.isLoading">
                                        <table class="table tgrid">
                                          <thead>
                                            <tr>
                                              <th class="center-aligned">
                                                {{authenticationService?.partnerModule?.customName}}</th>
                                              <th class="center">#Deals Count</th>
                                            </tr>
                                          </thead>
                                          <tbody>
                                            <ng-container *ngFor="let item of partnerPagination.pagedItems;let i=index">
                                              <tr>
                                                <td>
                                                  <app-user-info [userInfo]="item" [isPartnerEntityInfo]="true"
                                                    [isPartnerInfo]="true"></app-user-info>
                                                  <h6 *ngIf="item?.partnerStatus === 'deactivated'" class="green-banner inline-flex" style="margin-left: 60px;" 
                                                    data-toggle="tooltip" data-placement="bottom" title="Partnership is deactivated">DEACTIVATED</h6>
                                                </td>
                                                <td>
                                                  <a class="custom-icon" (click)="showCampaignDealsByPartner(item)"
                                                    data-toggle="tooltip" data-placement="top" title="Number Of Deals">
                                                    <i
                                                      class="circled-number IconCustomization fontStyleNormal"><b>{{item.dealsCount}}</b></i>
                                                    <div class="clickicons"></div>
                                                  </a>
                                                </td>
                                              </tr>
                                            </ng-container>
                                          </tbody>
                                        </table>
                                      </div>
                                      <div *ngIf="!partnerRequestLoader.isLoading" class="pg8">
                                        <app-pagination [pagination]="partnerPagination"
                                          (notifyParent)="setPartnersPage($event)"
                                          (notifyParentDropDown)="listPartners($event)"></app-pagination>
                                      </div>
                                      <!-- End of 24 -->
                                      <div *ngIf="!partnerRequestLoader.isLoading && campaignPagination.totalRecords==0"
                                        class="alert alert-info">
                                        <strong translate>No {{authenticationService?.partnerModule?.customName}}
                                          Found.</strong>
                                      </div>
                                    </div>
                                    <div *ngIf="!partnerRequestLoader.isLoading && partnerSortOption.totalRecords==0"
                                      class="alert alert-info">
                                      <strong translate>No {{authenticationService?.partnerModule?.customName}}
                                        Found.</strong>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </td>
                          </tr>

                        </ng-container>
                      </tbody>

                    </table>
                  </div>

                  <div *ngIf="!campaignRequestLoader.isLoading" class="pg8 pos_mrg_top8">
                    <app-pagination [pagination]="campaignPagination" (notifyParent)="setCampaignsPage($event)"
                      (notifyParentDropDown)="listCampaigns($event)"></app-pagination>
                  </div>
                  <!-- End of 24 -->
                  <div *ngIf="!campaignRequestLoader.isLoading && campaignPagination.totalRecords==0"
                    class="alert alert-info">
                    <strong translate>No Campaigns Found.</strong>
                  </div>
                </section>
                <div *ngIf="!listView && !campaignRequestLoader.isLoading && campaignSortOption.totalRecords==0"
                  class="col-xs-12 col-sm-12 col-md-12 col-lg-12 alert alert-info">
                  <strong translate>No Campaigns Found.</strong>
                </div>

              </div>
            </div>
            <div class="portlet-body">
              <!-- <div class="tab-content">
            </div> -->
              <!-- -----------------------------Campaign View - Deals List-------------------------------------- -->
              <div class="tab-content" *ngIf="showCampaignDeals">
                <app-response-message [customResponse]="customResponse" *ngIf="customResponse?.isVisible">
                </app-response-message>
                <div class="caption col-xs-10 col-md-10" style="margin: 9px 14px;padding-top: 3px;padding-left: 5px
                ;font-size: 18px;font-weight: 600">
                  Campaign: <span class="caption-subject font-red-sunglo uppercase"
                    style="padding-left: 5px; padding-right: 15px;" translate>{{selectedCampaignName}}</span>
                  <span *ngIf="selectedPartnerCompanyName !== ''"> {{authenticationService?.partnerModule?.customName}}:
                    <span class="caption-subject font-red-sunglo uppercase"
                      style="padding-left: 5px; padding-right: 15px;"
                      translate>{{selectedPartnerCompanyName}}</span></span>

                </div>

                <a (click)="closeCampaignDeals()" class="pull-right close-circle"
                  style="margin: -1px 14px;padding-top: 3px;padding-left: 5px;">
                  <span class="glyphicon glyphicon-remove" style="z-index: 1;font-size: 13px;"
                    aria-hidden="true"></span></a>
                <app-manage-campaign-deals [partnerCompanyId]="selectedPartnerCompanyId"
                  [campaignId]="selectedCampaignId" [isPartnerVersion]="isPartnerVersion"
                  [isVendorVersion]="isVendorVersion" [filterKey]="campaignPagination.filterKey"
                  (viewCampaignDealForm)="viewCampaignDealForm($event)"
                  (editCampaignDealForm)="editCampaignDealForm($event)" (refreshCounts)="refreshCounts()"
                  (showCommentsPopUp)="showComments($event)">
                </app-manage-campaign-deals>
              </div>
              <div class="row" id="box" style="padding-left: 28px !important;" *ngIf="httpRequestLoader.isServerError"
                translate>
                Please contact admin for 'Deals'
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<section *ngIf="showDealForm">
  <div class="page-content">
    <div>
      <a (click)="closeDealForm()" class="pull-right close-circle mrg1">        
        <i class="fa fa-times" aria-hidden="true"></i>
      </a>
      <a class="pull-right close-circle" *ngIf="actionType === 'edit'" data-rel="fancybox-button"
        (click)="showComments(selectedDeal)" data-toggle="tooltip" data-placement="bottom" title="Comments/History"
        style="margin: 0px -10px;padding-top: 7px;padding-left: 5px;">
        <span class="fa fa-comments IconCustomization" style="z-index: 1;font-size: 13px;" aria-hidden="true"
          style="font-size:18px"></span>
        <span *ngIf="selectedDeal.unReadChatCount > 0" class="badge badge-default edit-deal-notify"
          style="background-color: #ed1c24 !important;">{{selectedDeal.unReadChatCount}}</span>
      </a>

    </div>
    <app-add-deal [dealId]="dealId" [actionType]="actionType" [isVendorVersion]="isVendorVersion"
      [isOrgAdmin]="isOrgAdmin" (notifySubmitSuccess)="showSubmitDealSuccess()"></app-add-deal>
  </div>
</section>

<app-opportunities-chat-modal-popup *ngIf="updateCurrentStage" [deal]="currentDealToUpdateStage"
  [isPartnerVersion]="isPartnerVersion" [isVendorVersion]="isVendorVersion" [isCommentSection]="isCommentSection"
  [loggedInUserId]="loggedInUserId" [textAreaDisable]="textAreaDisable" (showCommentsEmitter)="showComments(deal)"
  (closePopupEmitter)="resetModalPopup()" (stageUpdateStatusCode)="stageUpdateResponse($event)">
</app-opportunities-chat-modal-popup>

<app-deal-chat-popup *ngIf="isCommentSection" [deal]="selectedDeal" [editTextArea]="textAreaDisable"
  [isVendorVersion]="isVendorVersion" (isCommentSection)="addCommentModalClose($event)"></app-deal-chat-popup>

<!-- XNFR-840 -->
<app-selectfield *ngIf="showSlectFieldComponent" [isVendorVersion]="isVendorVersion" [customName]="'manage'" [opportunityType]="'DEAL'"
  (closeEmitter)="closeEmitter($event)"></app-selectfield>
<!-- XNFR-840 -->