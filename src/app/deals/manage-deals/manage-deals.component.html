<div class="page-content" *ngIf="!showDealForm">
  <div id="deals-page-content-div">
    <div>
      <div class="page-bar">
        <div class="col-xs-12 col-sm-12 col-lg-12">
          <div class="col-xs-12 col-sm-6 col-lg-6">
            <ul class="page-breadcrumb">
              <li *ngIf="!authenticationService.isSuperAdmin()">
                <i class="fa fa-home" aria-hidden="true"></i>
                <a [routerLink]="referenceService.homeRouter" translate>Home</a>
                <i class="fa fa-angle-right" aria-hidden="true"></i>
              </li>
              <li>
                <a translate>Deals</a>
              </li>
            </ul>
          </div>
          <div class="col-xs-12 col-sm-6 col-lg-6 p0">
            <ul class="mix-filter p0 m0" style="float: right" *ngIf="isCompanyPartner && isVendor && !allApisLoader">
              <li class="filter" (click)="showPartner()" [class.campaign-type-selected]="isPartnerVersion" style="float: right;
            						margin-top: 5px;" *ngIf="isCompanyPartner" translate>Partner View </li>
              <li class="filter" (click)="showVendor()" [class.campaign-type-selected]="isVendorVersion" style="float: right;
            						margin-top: 5px;" *ngIf=" isVendor && enableLeads" translate>Vendor View</li>
              <p class="filter" style="float: right;
            						margin: 10px;background-color: white" translate>Opportunities as: </p>
            </ul>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-xs-12  p5">
          <div class="row">
            <!-- -------Total Deals------- -->
            <div class="col-xs-12 col-sm-4 col-md-4" *ngIf="!countsLoader"
              [style.pointer-events]="counts.totalDeals != 0 ? 'auto' : 'none' ">
              <a class="dashboard-stat dashboard-stat-lighter purple-soft" [class.greay]="1!=selectedTabIndex"
                (click)="showDeals()">
                <div class="visual">
                  <i class="fa fa-check-circle" style="margin-left: 0px;font-size: 40px;line-height: 60px;opacity: 1"
                    [ngStyle]="{'color': 1==selectedTabIndex ? '#white' : '#ccc' }" *ngIf=" 1==selectedTabIndex"
                    aria-hidden="true"></i>
                </div>
                <div class="details">
                  <div class="number">
                    <span>{{counts.totalDeals}}</span>
                  </div>
                  <div class="desc" translate>Total Deals</div>
                </div>
                <span id="permhref" class="morePadding ">
                  <a class="more" translate> Detailed view <i class="m-icon-swapright m-icon-white" aria-hidden="true"></i></a>
                </span>
              </a>
            </div>

            <!-- -------Won Deals------- -->
            <div class="col-xs-12 col-sm-4 col-md-4" *ngIf="!countsLoader"
              [style.pointer-events]="counts.wonDeals != 0 ? 'auto' : 'none' ">
              <a class="dashboard-stat dashboard-stat-lighter purple-soft" [class.greay]="2!=selectedTabIndex"
                (click)="showWonDeals()">
                <div class="visual">
                  <i class="fa fa-check-circle" style="margin-left: 0px;font-size: 40px;line-height: 60px;opacity: 1"
                    [ngStyle]="{'color': 2==selectedTabIndex ? '#white' : '#ccc' }" *ngIf=" 2==selectedTabIndex"
                    aria-hidden="true"></i>
                </div>
                <div class="details">
                  <div class="number">
                    <span>{{counts.wonDeals}}</span>
                  </div>
                  <div class="desc" translate>Won Deals</div>
                </div>
                <span id="permhref" class="morePadding ">
                  <a class="more" translate> Detailed view <i class="m-icon-swapright m-icon-white" aria-hidden="true"></i></a>
                </span>
              </a>
            </div>

            <!-- -------Lost Deals------- -->
            <div class="col-xs-12 col-sm-4 col-md-4" *ngIf="!countsLoader"
              [style.pointer-events]="counts.lostDeals != 0 ? 'auto' : 'none' ">
              <a class="dashboard-stat dashboard-stat-lighter purple-soft" [class.greay]="3!=selectedTabIndex"
                (click)="showLostDeals()">
                <div class="visual">
                  <i class="fa fa-check-circle" style="margin-left: 0px;font-size: 40px;line-height: 60px;opacity: 1"
                    [ngStyle]="{'color': 3==selectedTabIndex ? '#white' : '#ccc' }" *ngIf=" 3==selectedTabIndex"
                    aria-hidden="true"></i>
                </div>
                <div class="details">
                  <div class="number">
                    <span>{{counts.lostDeals}}</span>
                  </div>
                  <div class="desc" translate>Lost Deals</div>
                </div>
                <span id="permhref" class="morePadding ">
                  <a class="more" translate> Detailed view <i class="m-icon-swapright m-icon-white" aria-hidden="true"></i></a>
                </span>
              </a>
            </div>

          </div>
        </div>

        
      </div>

      <!-- -----------------------------Deals List-------------------------------------- -->
      <div class="row">
        <div class="col-md-12">
          <div class="tabbable tabbable-custom tabbable-noborder" id="header">
            <div class="tab-content">
              <div class="page-bar m10" *ngIf="!httpRequestLoader.isLoading &&  !httpRequestLoader.isServerError">
                <app-response-message class="pg8" [customResponse]="dealsResponse" *ngIf="dealsResponse.isVisible"></app-response-message>
                <div class="page-toolbar col-xs-12 col-sm-6 col-lg-6">
                  <div class="btn-group pull-right">
                    <a *ngIf="isPartnerVersion || isOrgAdmin" (click)="addDeal()">
                      <button class="btn btn-primary" translate>
                        <i class="fa fa-plus" aria-hidden="true"></i> Add a Deal
                      </button>
                    </a>
                    <div class="inputs" align="right" style="float: right">
                      <div class="portlet-input input-inline" style="display: table-cell;">
                        <div class="input-icon right" style="position: relative;right: -11px;">
                          <input type="text" class="form-control" [(ngModel)]="dealsSortOption.searchKey"
                            [ngModelOptions]="{standalone: true}" placeholder="Search"
                            (keypress)="dealEventHandler($event.keyCode)">
                          <button class="glyphicon glyphicon-remove search-box-item-clear"
                            *ngIf="dealsSortOption.searchKey" (click)="dealsSortOption.searchKey=''"></button>
                          <button type="submit" class="search-box-item-click" (click)="searchDeals()">
                            <i class="fa fa-search" aria-hidden="true"></i>
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row" id="box" *ngIf="httpRequestLoader.isServerError" translate>
                Please contact admin for 'Leads'
              </div>
              <app-list-loader *ngIf="httpRequestLoader.isLoading && !httpRequestLoader.isServerError">
              </app-list-loader>
              <section class='m10'
                *ngIf="dealsSortOption.totalRecords > 0 && !httpRequestLoader.isLoading && !httpRequestLoader.isServerError">

                <div class="table-responsive">
                  <table class='table tgrid table-hover table-sm' aria-describedby="dealTable">
                    <thead>
                      <tr>
                        <th class="center-aligned" translate>Deal Details</th>                        
                        <th class="center" translate>Added By</th>
                        <th class="center" translate>Status</th>
                        <th style="width: 18%; text-align:right" translate>Actions</th>
                      </tr>

                    </thead>

                    <tbody>
                      <ng-container *ngFor='let deal of dealsPagination.pagedItems; let i=index'>
                        <tr>
                          <td style="width: 40%;">
                            <div>{{deal.title | slice:0:30}}
                              <span *ngIf="deal.title?.length>30">...</span>
                            </div>
                            <div>
                              <h5 *ngIf="isPartnerVersion"><b>Added For:</b>
                                <span  style="color: #5b9bd1;">{{deal.createdForCompanyName | slice:0:30}}
                                  <span *ngIf="deal.createdForCompanyName?.length>30">...</span>
                                </span>  
                              </h5> 
                            </div>
                            <div>
                              <h5 *ngIf="isPartnerVersion && deal?.campaignId > 0"><b>Campaign:</b>
                                <span  style="color: #5b9bd1;">{{deal.campaignName | slice:0:30}}
                                  <span *ngIf="deal.campaignName?.length>30">...</span>
                                </span>  
                              </h5>
                              <h5 *ngIf="isVendorVersion && deal?.parentCampaignId > 0"><b>Campaign:</b>
                                <span  style="color: #5b9bd1;">{{deal.parentCampaignName | slice:0:30}}
                                  <span *ngIf="deal.campaignName?.length>30">...</span>
                                </span>  
                              </h5> 
                            </div>
                                                        
                          </td>                          
                          <td style="width: 20%;">
                            <h5 *ngIf="!isPartnerVersion">{{deal.createdByCompanyName | slice:0:30}}
                              <span *ngIf="deal.createdByCompanyName?.length>30">...</span>
                            </h5>
                            <h5 class='ellipsis' title="{{deal.createdByName}}" style="margin: 7px 0 2px 0;font-weight: 400;">
                              {{deal.createdByName | slice:0:20}}
                              <span *ngIf="deal.createdByName?.length>20">...</span>
                            </h5>
                            <h6 class='m0' style="font-weight: 400;">
                              <a title="{{deal.createdByEmail}}">{{deal.createdByEmail | slice:0:30}}</a>
                              <span *ngIf="deal.createdByEmail?.length>30">...</span>
                            </h6>
                            <h5 style="font-weight: 600; color: #676767;">
                              <app-timestamp [isOnlyDate]="false" [dateAndTime]="deal.createdTime">
                              </app-timestamp>
                            </h5>
                          </td>                          
                          <td style="width: 10%;"> 
                            <select class="form-control" [(ngModel)]="deal.pipelineStageId" (ngModelChange)="setDealStatus(deal)"
                              style="width: 135px">
                              <option *ngFor="let stage of deal.pipeline.stages" [ngValue]="stage.id">{{stage.stageName}}</option>
                            </select>
                            
                          </td>
                          <td style="width: 30%;">
                            <div class="actions-block override-actions">
                              <ng-container>
                                <a data-rel="fancybox-button" (click)="viewDeal(deal)" title="View Deal" id="deal">
                                  <i class="fa fa-eye mr5" aria-hidden="true"></i>
                                </a>
                                <a data-rel="fancybox-button" *ngIf="deal.canUpdate" (click)="editDeal(deal)" title="Edit Deal" id="deal">
                                  <i class="fa fa-edit mr5" aria-hidden="true"></i>
                                </a>
                                <a data-rel="fancybox-button" *ngIf="deal.canUpdate" (click)="confirmDeleteDeal(deal)" title="Delete Deal" id="deal">
                                  <i class="fa fa-trash mr5" aria-hidden="true"></i>
                                </a>
                              </ng-container>
                            </div>
                            <!-- <a data-rel="fancybox-button" (click)="viewDeal(deal)" title="View Deal" style="margin-top: 10px"
                              id="deal">
                              <span class="circled-number" style="height: 40px;width:40px">
                                <i class="fa fa-eye mr5" aria-hidden="true" style="font-size:18px;margin-top: 13px; margin-left: 6px;"></i>
                              </span>
                            </a>
                            <a data-rel="fancybox-button" *ngIf="deal.canUpdate" (click)="editDeal(deal)" title="Edit Deal" style="margin-top: 10px"
                              id="deal">
                              <span class="circled-number" style="height: 40px;width:40px">
                                <i class="fa fa-edit mr5" aria-hidden="true" style="font-size:18px;margin-top: 13px; margin-left: 6px;"></i>
                              </span>
                            </a>   -->
                            <!-- <a *ngIf="lead.campaignId" data-rel="fancybox-button" (click)="dealRouter(item,$event)" title="Lead Based Reports" style="margin-top: 10px">
                              <span class="circled-number"  style="height: 40px;width:40px">
                                <i class="fa fa-line-chart" aria-hidden="true" style="font-size:18px;margin-top: 13px; margin-left: 6px;"></i>
                              </span>
                            </a> 
                            <a *ngIf="true" data-rel="fancybox-button" (click)="showComments(lead)" title="Comments" style="margin-top: 10px">                            
                              <span class="circled-number" style="height: 40px;width:40px">
                                <i class="fa fa-comments" aria-hidden="true" style="font-size:18px"> </i><span class="badge badge-default"
                                  style="margin-bottom: 32px; margin-left: -13px;background-color: #ed1c24 !important;">0</span>
                              </span>
                            </a> -->
                            <!-- <a data-rel="fancybox-button" *ngIf="deal.canUpdate" (click)="confirmDeleteDeal(deal)" title="Delete Deal" style="margin-top: 10px"
                              id="deal">
                              <span class="circled-number" style="height: 40px;width:40px">
                                <i class="fa fa-trash mr5" aria-hidden="true" style="font-size:18px;margin-top: 13px; margin-left: 6px;"></i>
                              </span> 
                            </a> -->                                                       
                          </td>
                        </tr>

                      </ng-container>
                    </tbody>

                  </table>
                </div>

              </section>
              <!-- --------------------Pagination0-------------------- -->
              <div *ngIf="!httpRequestLoader.isLoading && dealsPagination.pagedItems.length !== 0" class="pg8">
                <app-pagination [pagination]="dealsPagination" (notifyParent)="setDealsPage($event)"
                  (notifyParentDropDown)="listDeals($event)"></app-pagination>
              </div>
              <!-- End of 24 -->
              <div *ngIf="!httpRequestLoader.isLoading && dealsPagination.totalRecords==0 && !httpRequestLoader.isLoading" class="alert alert-info">
                <strong translate>No Deals Found.</strong>
              </div>

            </div>
          </div><!-- End Of Tab Content -->
        </div>
      </div>
    </div>

  </div>
</div>

<!-- Add Deal Form-->
<!-- <ng-container *ngIf="showDealForm">
  <app-add-deal></app-add-deal>
</ng-container> -->

<section *ngIf="showDealForm">
	<div class="page-content">
		<a (click)="closeDealForm()" class="pull-right close-circle" style="margin: 9px 14px;padding-top: 3px;padding-left: 5px;">
			<span class="glyphicon glyphicon-remove" style="z-index: 1;font-size: 13px;" aria-hidden="true"></span></a>
      <app-add-deal [dealId]="dealId" [actionType]="actionType" [isVendorVersion]="isVendorVersion" [isOrgAdmin]="isOrgAdmin" 
      (notifySubmitSuccess)="showSubmitDealSuccess()"></app-add-deal>
	</div>
</section>
