<div class="m10" *ngIf="!httpRequestLoader.isLoading &&  !httpRequestLoader.isServerError">
  <app-response-message class="pg8 col-lg-12 col-md-12 col-sm-12 col-xs-12 p0" [customResponse]="dealsResponse"
    *ngIf="dealsResponse.isVisible">
  </app-response-message>
  <div class="col-xs-12 col-sm-5 col-lg-5" *ngIf="fromAnalytics && showTeamMemberFilter">
    <app-team-member-filter-option *ngIf="!authenticationService?.module?.isMarketingCompany"
      [customSelectedIndex]="selectedFilterIndex"
      (teamMemberFilterOptionEventEmitter)="getSelectedIndex($event)"></app-team-member-filter-option>
  </div>
  <div class="page-toolbar col-xs-10 col-sm-6 col-lg-6 mSearchAlign pull-right"
    style="padding:10px;margin-top: -11px;padding-right: 0px;padding-right: 0px;">
    <div class="btn-group pull-right">

      <div class="inputs" align="right" style="float: right; display: inline-flex;">
        <div class="portlet-input input-inline" style="display: table-cell; margin-right: 15px;">
          <div class="input-icon right" style="position: relative;right: -11px;">
            <input type="text" class="form-control" [(ngModel)]="dealsSortOption.searchKey"
              [ngModelOptions]="{standalone: true}" placeholder="Search" (keypress)="dealEventHandler($event.keyCode)">
            <button class="glyphicon glyphicon-remove search-box-item-clear" *ngIf="dealsSortOption.searchKey"
              (click)="clearSearch()"></button>
            <button type="submit" class="search-box-item-click" (click)="searchDeals()">
              <i class="fa fa-search" aria-hidden="true"></i>
            </button>
          </div>
        </div>
        <span data-placement="bottom" class="btn btn-xs hidden-xs l-g-view mr5" data-toggle="tooltip" title="Filter"
          (click)="toggleFilterOption()">
          <i _ngcontent-c17="" aria-hidden="true" class="fa fa-filter p10"></i>
        </span>
        <button data-placement="bottom" class="btn btn-xs hidden-xs l-g-view" data-toggle="tooltip"
          title="Click here to email the report" [disabled]="dealsSortOption.totalRecords == 0"
          (click)="downloadDeals(dealsPagination)">
          <i _ngcontent-c17="" aria-hidden="true" class="fas fa-file-export p10"></i>
        </button>
      </div>
    </div>
  </div>
</div>
<div class="row" id="box" *ngIf="httpRequestLoader.isServerError" translate>
  Please contact admin for 'Leads'
</div>
<app-list-loader *ngIf="httpRequestLoader.isLoading && !httpRequestLoader.isServerError">
</app-list-loader>
<!-- -------------------- Apply Filters Box-------------------- -->
<div class="row" *ngIf="showFilterOption && !httpRequestLoader.isLoading && !httpRequestLoader.isServerError">
  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
    <div class="portlet light m10">
      <div class="portlet-title">
        <div class="caption" translate>Apply Filters</div>
        <button type="button" class="close-circle" style="margin-left: 10px;" (click)="closeFilterOption()">
          <i class="fa fa-times" aria-hidden="true"></i>
        </button>
        <div class="form-group" style="text-align: -webkit-right;">
          <button class="button bgcolor-unset neg_mrgn_top4 mrgn_top0" type="button" (click)="validateDateFilters()">
            <span class="btn Btn-Green transition txt_pd-top3">Filter</span>
          </button>
        </div>
      </div>
      <!--Filter Options-->
      <div class="portlet-body clearfix">
        <app-response-message class="pg8" [customResponse]="filterResponse"
          *ngIf="filterResponse.isVisible"></app-response-message>
        <form class="form-horizontal form-bordered form-label-stripped">
          <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
            <!--From Date-->
            <div class="form-group">
              <label class="control-label col-sm-5">From Date</label>
              <div class="col-sm-7">
                <app-date-picker [(dataField)]="fromDateFilter" [isFromFilter]='true'></app-date-picker>
              </div>
            </div>
            <!--Status-->
            <div class="form-group">
              <label class="control-label col-sm-5">Status</label>
              <div class="col-sm-7">
                <p class="mt--10px" *ngIf="statusLoader">
                  <strong><img class="h-50px" src="../../../assets/images/Spinner.gif" alt="">Loading Status...</strong>
                </p>
                <app-searchable-dropdown *ngIf="!statusLoader && isStatusLoadedSuccessfully"
                  [searchableDropDownDto]="statusSearchableDropDownDto" [id]="statusFilter" [disableDropDown]="false"
                  (searchableDropdownEventEmitter)="getSelectedStatus($event)">
                </app-searchable-dropdown>
                <p class="required" *ngIf="!statusLoader && !isStatusLoadedSuccessfully">
                  <strong>{{properties?.SOMTHING_WENT_WRONG}}</strong>
                </p>
              </div>
            </div>
          </div>
          <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
            <!--To Date-->
            <div class="form-group">
              <label class="control-label col-sm-5">To Date</label>
              <div class="col-sm-7">
                <app-date-picker [(dataField)]="toDateFilter" [isFromFilter]='true'></app-date-picker>
              </div>
            </div>
            <!--Added By User-->
            <div class="form-group">
              <label class="control-label col-sm-5">{{LEAD_CONSTANTS?.addedBy}}</label>
              <div class="col-sm-7">
                <p class="mt--10px" *ngIf="registeredByUsersLoader">
                  <strong><img class="h-50px" src="../../../assets/images/Spinner.gif" alt="">Loading
                    {{LEAD_CONSTANTS?.addedBy}}...</strong>
                </p>
                <app-searchable-dropdown *ngIf="!registeredByUsersLoader && isRegisteredByUsersLoadedSuccessfully"
                  [searchableDropDownDto]="registeredByUsersSearchableDropDownDto" [id]="selectedRegisteredByUserId"
                  [disableDropDown]="false" (searchableDropdownEventEmitter)="getSelectedRegisteredByUserId($event)">
                </app-searchable-dropdown>
                <p class="required" *ngIf="!registeredByUsersLoader && !isRegisteredByUsersLoadedSuccessfully">
                  <strong>{{properties?.SOMTHING_WENT_WRONG}}</strong>
                </p>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<section class="col-xs-12 col-sm-12 col-md-12 col-lg-12 p0"
  *ngIf="dealsSortOption.totalRecords > 0 && !httpRequestLoader.isLoading && !httpRequestLoader.isServerError">
  <div class="table-responsive">
    <table class='table tgrid table-hover table-sm' aria-describedby="dealTable">
      <thead>
        <tr>
          <th class="center-aligned" translate>Deal Details</th>
          <th class="center" translate>{{LEAD_CONSTANTS.addedBy}}</th>
          <th class="center" translate>Status</th>
          <th style="width: 18%; text-align:right" translate>Actions</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor='let deal of dealsPagination.pagedItems; let i=index'>
          <tr>
            <td style="width: 40%;">
              <div>
                <span><b>Deal Name:</b>{{deal.title | slice:0:30}}</span>
                <span *ngIf="deal.title?.length>30">...</span>
              </div>
              <div>
                <span *ngIf="isVendorVersion"><b>Deal Id:</b> {{deal.referenceId}}</span>
              </div>
              <div>
                <h5 *ngIf="isPartnerVersion"><b>Added For:</b>
                  <span style="color: #5b9bd1;">{{deal.createdForCompanyName | slice:0:30}}
                    <span *ngIf="deal.createdForCompanyName?.length>30">...</span>
                  </span>
                </h5>
              </div>
              <div>
                <h5 *ngIf="isPartnerVersion && deal?.campaignId > 0"><b>Campaign:</b>
                  <span style="color: #5b9bd1;">{{deal.campaignName | slice:0:30}}
                    <span *ngIf="deal.campaignName?.length>30">...</span>
                  </span>
                </h5>
                <h5 *ngIf="isVendorVersion && deal?.parentCampaignId > 0"><b>Campaign:</b>
                  <span style="color: #5b9bd1;">{{deal.parentCampaignName | slice:0:30}}
                    <span *ngIf="deal.campaignName?.length>30">...</span>
                  </span>
                </h5>
              </div>

            </td>
            <td class="mAlignment" style="width: 20%;">
              <h5 *ngIf="!isPartnerVersion">{{deal.createdByCompanyName | slice:0:30}}
                <span *ngIf="deal.createdByCompanyName?.length>30">...</span>
              </h5>
              <h5 class='ellipsis m_t_view' style="margin: 7px 0 2px 0;font-weight: 400;">
                <span data-toggle="tooltip" data-placement="bottom" title="{{deal.createdByName}}"> {{deal.createdByName
                  | slice:0:20}}</span>
                <span *ngIf="deal.createdByName?.length>20">...</span>
              </h5>
              <h6 class='m0' style="font-weight: 400;">
                <a data-toggle="tooltip" data-placement="bottom" title="{{deal.createdByEmail}}">{{deal.createdByEmail |
                  slice:0:30}}</a>
                <span *ngIf="deal.createdByEmail?.length>30">...</span>
              </h6>
              <h5 style="font-weight: 600; color: #676767;">
                <app-timestamp [isOnlyDate]="false" [dateAndTime]="deal.createdTime">
                </app-timestamp>
              </h5>
            </td>
            <td style="width: 10%;">
              <!-- xnfr-426-->
              <span class="comment-color" translate>
                {{deal.currentStageName}}</span>
              <a data-rel="fancybox-button" *ngIf="(deal?.showDealActions && deal?.showEditDealStage) || (isVendorVersion && deal?.showEditDealStage)"
                (click)="updatePipelineStage(deal,authenticationService?.module?.deletedPartner)" data-toggle="tooltip"
                data-placement="bottom" title="Edit Deal Stage">
                <span class="fa fa-edit IconCustomization" aria-hidden="true"></span>
              </a>
            </td>
            <td style="width: 30%;">
              <div class="actions-block override-actions">
                <a class="custom-icon" data-rel="fancybox-button" (click)="viewDeal(deal)" data-toggle="tooltip"
                  data-placement="bottom" title="View Deal" id="deal">
                  <i class="fa fa-eye mr5 IconCustomization" aria-hidden="true"></i>
                  <div class="clickicons"></div>
                </a>
                <ng-container *ngIf="!authenticationService?.module?.deletedPartner">
                  <a class="custom-icon" data-rel="fancybox-button"
                    *ngIf="deal.canUpdate && !(isPartnerVersion && deal?.onNonInteractiveStage)"
                    (click)="deal?.showDealActions?editDeal(deal):''" data-toggle="tooltip" data-placement="bottom" title="Edit Deal" id="deal">
                    <i [ngClass]="deal?.showDealActions? '':'disabled gray'" class="fa fa-edit mr5 IconCustomization" aria-hidden="true"></i>
                    <div class="clickicons"></div>
                  </a>
                  <a class="custom-icon" data-rel="fancybox-button"
                    *ngIf="deal.canUpdate && !(isPartnerVersion && deal?.onNonInteractiveStage)"
                    (click)="deal?.showDealActions ? confirmDeleteDeal(deal):''" data-toggle="tooltip" data-placement="bottom" title="Delete Deal"
                    id="deal">
                    <i [ngClass]="deal?.showDealActions? '':'disabled gray'" class="fa fa-trash-o trashIconCustomization" aria-hidden="true"></i>
                    <div class="del-icon"></div>
                  </a>
                </ng-container>
                <a class="custom-icon" *ngIf="true" data-rel="fancybox-button" (click)="showComments(deal)"
                  data-toggle="tooltip" data-placement="bottom" title="Comments/History">
                  <i class="fa fa-comments IconCustomization" aria-hidden="true" style="font-size:18px"></i>
                  <span *ngIf="deal.unReadChatCount > 0" class="badge badge-default"
                    style="margin-bottom: 25px; margin-left: -15px;background-color: #ed1c24 !important;">{{deal.unReadChatCount}}</span>
                  <div class="clickicons"></div>
                </a>
              </div>
            </td>
          </tr>
        </ng-container>
      </tbody>

    </table>
  </div>

  <!-- --------------------Pagination0-------------------- -->
  <div *ngIf="!httpRequestLoader.isLoading && dealsPagination.pagedItems.length !== 0" class="pg8">
    <app-pagination [pagination]="dealsPagination" (notifyParent)="setDealsPage($event)"
      (notifyParentDropDown)="listCampaignDeals($event)"></app-pagination>
  </div>
  <!-- End of 24 -->
  <div *ngIf="!httpRequestLoader.isLoading && dealsPagination.totalRecords==0 && !httpRequestLoader.isLoading" class="col-xs-12
    alert alert-info">
    <strong translate>No Deals Found.</strong>
  </div>

</section>
<div *ngIf="!httpRequestLoader.isLoading && dealsSortOption.totalRecords==0" class="col-xs-12 alert alert-info">
  <strong translate>No Deals Found.</strong>
</div>


<!--XNFR-426-->
<app-opportunities-chat-modal-popup *ngIf="updateCurrentStage" [deal]="currentDealToUpdateStage"
  [isVendorVersion]="isVendorVersion" [isPartnerVersion]="isPartnerVersion" [loggedInUserId]="loggedInUserId"
  [textAreaDisable]="textAreaDisable" (showCommentsEmitter)="showComments(deal)" (closePopupEmitter)="resetModalPopup()"
  (stageUpdateStatusCode)="stageUpdateResponse($event)">
</app-opportunities-chat-modal-popup>