<!-- <div class="page-content">
  <div>
    <button class="action-btn star-btn" (click)="backToList()" title="Back to List">
      <i class="fa fa-arrow-left" aria-hidden="true"></i>
    </button>
  </div>
  <div class="email-thread">
    <div class="email-header-top">
      <div class="email-subject">{{selectedThread?.subject}}</div>
    </div>
    <div class="email-item" *ngFor="let msg of selectedThread.messages">
      <div class="email-header">
        <div class="sender-block">
          <div class="avatar">M</div>
          <div class="sender-details">
            <div class="sender-name">{{msg?.from}}</div>
            <div class="to-line">to me <i class="fa fa-caret-down"></i></div>
          </div>
        </div>
        <div class="email-meta">
          {{msg?.timestamp}}
          <i class="fa fa-star-o"></i>
            <i class="fa fa-reply"></i>
            <i class="fa fa-ellipsis-v"></i>
        </div>
      </div>
      <div class="email-body" [innerHTML]="getBodyContent(msg?.bodyContent)"></div>
      <div *ngIf="msg?.attachments?.length > 0">
        <h6>Attachments:</h6>
        <div class="attachments-container">
          <div *ngFor="let att of msg?.attachments" class="attachment-item">
            <img *ngIf="att.contentType.startsWith('image/')" [src]="getAttachmentUrl(att)" [alt]="att.name"
              class="attachment-img" style="width: 120px; height: 100px;">
            <div *ngIf="!att.contentType.startsWith('image/')">
              <button (click)="downloadAttachment(att)">
               {{ att.name }}
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div> -->
<div class="page-content">
  <div>
    <button class="action-btn star-btn" (click)="backToList()" title="Back to List">
      <i class="fa fa-arrow-left" aria-hidden="true"></i>
    </button>
  </div>

  <div class="email-thread">
    <div class="email-header-top">
      <div class="email-subject">{{threads?.subject}}</div>
    </div>
    <div class="email-item" *ngFor="let msg of threads?.messages; let i = index" [class.open]="expandedMessages.has(threads?.messages?.length)"
      (click)="toggleMessage(i)">

      <div class="email-header">
        <div class="sender-block">
          <div class="avatar">{{getInitials(msg?.from)}}</div>
          <div class="sender-details">
            <div class="sender-name">{{msg.from}}</div>
            <div class="to-line" *ngIf="expandedMessages.has(i)">
              {{extractFirstNames(msg?.toEmailIds)}}{{msg?.ccEmailIds}}<i class="fa fa-caret-down"></i>
            </div>
          </div>
        </div>
        <div class="email-meta">
          <span class="timestamp">{{msg?.timestamp}}</span>
          <div class="email-actions" *ngIf="expandedMessages.has(i)">
            <i class="fa fa-star-o" title="Add to starred"></i>
            <i class="fa fa-reply" title="Reply"></i>
            <i class="fa fa-ellipsis-v" title="More options"></i>
          </div>
        </div>
      </div>

      <div class="email-preview" *ngIf="!expandedMessages.has(i)">
        <span class="preview-text">{{getPreviewText(msg)}}</span>
      </div>

      <div class="email-body" *ngIf="expandedMessages.has(i)" [innerHTML]="getBodyContent(msg)"></div>
      <div class="attachments-section" *ngIf="expandedMessages.has(i) && msg.attachments && msg.attachments.length > 0">
        <h6>Attachments:</h6>
        <div class="attachments-container">
          <div *ngFor="let att of msg.attachments" class="attachment-item">
            <img *ngIf="att.contentType.startsWith('image/')" [src]="getAttachmentUrl(att)" [alt]="att.name"
              class="attachment-img">
            <div *ngIf="!att.contentType.startsWith('image/')" class="attachment-download">
              <button (click)="downloadAttachment(att); $event.stopPropagation()">
                <i class="fa fa-download"></i> {{ att.name }}
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>