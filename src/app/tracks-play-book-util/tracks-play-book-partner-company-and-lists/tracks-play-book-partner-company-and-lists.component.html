<div class="panel with-nav-tabs panel-default">
  <div class="panel-heading" id="company-and-group-tabs">
    <ul class="nav nav-tabs">
      <li id="partners-li">
        <a class="partnersC" data-placement="top" title="Click to see {{authenticationService?.partnerModule?.customName}} companies" href="#partners"
          data-toggle="tab" (click)="isPartnerCompaniesTabSelected = true;findPartnerCompanies(pagination)">{{authenticationService?.partnerModule?.customName}}
          <i *ngIf="isPartnerCompaniesTabSelected" id="tick-mark" class="fa fa-check-circle-o success"></i>
        </a>
      </li>
      <li id="partnerGroups-li">
        <a class="partnerGroupsC" data-placement="bottom" title="Click to see list of {{authenticationService?.partnerModule?.customName}}" href="#partnerGroups"
          data-toggle="tab" (click)="isPartnerCompaniesTabSelected = false;findPartnerGroups(partnerGroupsPagination)">List Of {{authenticationService?.partnerModule?.customName}}
          <i *ngIf="!isPartnerCompaniesTabSelected" id="tick-mark" class="fa fa-check-circle-o success"></i>
        </a>
      </li>
    </ul>
  </div>
  <div class="panel-body">
    <div class="tab-content">
      <div class="tab-pane fade" id="partners">
        <div class="col-xs-12">
          <div class="row">
            <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 p0">
              <app-team-member-filter-option *ngIf="showFilter && !authenticationService?.module?.isMarketingCompany"
                (teamMemberFilterOptionEventEmitter)="getSelectedIndex($event)"></app-team-member-filter-option>
            </div>
            <div class="page-toolbar col-xs-12 col-sm-6 col-lg-6 col-md-6 mb-flex">
              <div class="pull-right">
                <button class="btn btn-danger margin-space"
                  *ngIf="(selectedTeamMemberIds?.length>0 || selectedPartnershipIds?.length>0) "
                  (click)="clearAll('partners')">Clear All</button>
              </div>
              <div class="btn-group pull-right">
                <div class="inputs float-right" style="display: inline-flex;">
                  <div class="portlet-input input-inline" id="search-div">
                    <div class="input-icon right mr5" id="icon">
                      <input type="text" id="sort-text" class="form-control" [(ngModel)]="sortOption.searchKey"
                        [ngModelOptions]="{standalone: true}" placeholder="Search..."
                        (keypress)="partnersSearchOnKeyEvent($event.keyCode)">
                      <button class="glyphicon glyphicon-remove search-box-item-clear" *ngIf="sortOption.searchKey"
                        (click)="sortOption.searchKey='';searchPartners();"></button>
                      <button type="submit" class="search-box-item-click" (click)="searchPartners()">
                        <i class="fa fa-search" aria-hidden="true"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <ng-container>
          <div class="portlet-title" style="border-bottom: none;" *ngIf="!httpRequestLoader.isLoading">
            <div class="row">
              <div>
                <div class="col-xs-12" style="padding-top: 5px;">
                  <div class="alert alert-success" *ngIf="selectedPartnershipIds?.length>0">
                    <strong>
                      Selected Companies : {{selectedPartnershipIds?.length}}
                    </strong>
                    <ng-template [ngTemplateOutlet]="emailNotificationTemplate"></ng-template>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <br>
          <app-list-loader *ngIf="httpRequestLoader.isLoading"></app-list-loader>
          <ng-container *ngIf="!httpRequestLoader.isLoading">
            <div class="table-responsive">
              <table class='table tgrid table-hover table-sm' *ngIf="pagination.pagedItems?.length>0"
                id="parnter-companies" aria-describedby="trackPlayBookPartnersTableDescription">
                <thead>
                  <tr>
                    <th scope="col"></th>
                    <th scope="col">Company Logo</th>
                    <th scope="col" class="text-center">Company Name</th>
                    <th scope="col">Created Time</th>
                  </tr>
                </thead>
                <tbody>
                  <ng-container *ngFor="let partner of pagination.pagedItems ;let i =index">
                    <tr [class.row-selected]="selectedPartnershipIds.indexOf(partner.partnershipId)>-1">
                      <td class="cw">
                        <div class="actions-block left-float">
                          <a (click)="viewTeamMembers(partner)" data-toggle="tooltip" data-placement="bottom"
                            title="View/Hide Team Members">
                            <i class="fa IconCustomization"
                              [ngClass]="{'fa-angle-right': !partner.expand, 'fa-angle-down': partner.expand}"
                              aria-hidden="true"></i>
                          </a>
                        </div>
                      </td>
                      <td style="width: 10%;">
                        <div data-toggle="tooltip" data-placement="right" title="{{partner?.companyName}}"
                          class="thumbnail-wrapper img">
                          <img alt="No image found" onerror="this.src='assets/images/company-profile-logo.png';"
                            [src]="authenticationService.MEDIA_URL+partner.companyLogo">
                        </div>
                      </td>
                      <td class="text-center">
                        <span>{{partner?.companyName | slice:0:20}}</span>
                        <span *ngIf="partner?.companyName.length>20">...</span>
                      </td>
                      <td>
                        <app-timestamp [dateAndTime]="partner?.displayTime">
                        </app-timestamp>
                      </td>
                    </tr>
                    <tr *ngIf="partner?.expand">
                      <td colspan="4">
                        <div class="table-responsive x-hidden">
                          <div class="portlet-input input-inline float-right mb10p" id="search-div">
                            <div class="input-icon right" id="icon">
                              <input type="text" id="sort-text" class="form-control"
                                [(ngModel)]="teamMembersPagination.searchKey" [ngModelOptions]="{standalone: true}"
                                placeholder="Search..." (keypress)="adminAndTeamMembersKeySearch($event.keyCode)">
                              <button class="glyphicon glyphicon-remove search-box-item-clear"
                                *ngIf="teamMembersPagination?.searchKey"
                                (click)="teamMembersPagination.searchKey='';searchAdminsAndTeamMembers();"></button>
                              <button type="submit" class="search-box-item-click"
                                (click)="searchAdminsAndTeamMembers()">
                                <i class="fa fa-search" aria-hidden="true"></i>
                              </button>
                            </div>
                          </div>
                          <ng-container
                            *ngIf="!teamMembersLoader.isLoading && adminsAndTeamMembersErrorMessage.isVisible">
                            <div class="custom-response-padding">
                              <app-response-message [customResponse]="adminsAndTeamMembersErrorMessage">
                              </app-response-message>
                            </div>
                          </ng-container>
                          <div *ngIf="!adminsAndTeamMembersErrorMessage.isVisible">
                            <app-auto-response-loader *ngIf="teamMembersLoader.isLoading">
                            </app-auto-response-loader>
                            <ng-container *ngIf="!teamMembersLoader.isLoading">
                              <table class="table tgrid table-condensed table-bordered child-table-xamp"
                                aria-describedby="team-members-info"
                                id="admin-and-team-members-{{partner?.partnershipId}}">
                                <thead>
                                  <tr>
                                    <th scope="row" class="text-center">
                                      <input type="checkbox" class="pointer checkBox_shadow"
                                        [(ngModel)]="isHeaderCheckBoxChecked"
                                        (change)="selectAllTeamMembersOfTheCurrentPage($event,partner.partnershipId)">
                                    </th>
                                    <th scope="row">Entity Info</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  <tr *ngFor="let adminAndTeamMember of teamMembersPagination.pagedItems;let i = index;"
                                    id="publishToPartners-{{adminAndTeamMember.userId}}"
                                    [class.row-selected]="selectedTeamMemberIds.indexOf(adminAndTeamMember.userId)>-1"
                                    (click)="highlightSelectedAdminOrTeamMemberRowOnRowClick(adminAndTeamMember.userId,partner.partnershipId,$event)">
                                    <td class="text-center">
                                      <input type="checkbox" class="pointer checkBox_shadow"
                                        id="{{adminAndTeamMember.userId}}"
                                        [checked]="selectedTeamMemberIds.indexOf(adminAndTeamMember.userId)>-1"
                                        name="adminOrTeamMemberCheckBox[]" value="{{adminAndTeamMember.userId}}"
                                        (click)="highlightAdminOrTeamMemberRowOnCheckBoxClick(adminAndTeamMember.userId,partner.partnershipId,$event)">
                                    </td>
                                    <td>
                                      <app-user-info [isPartnerEntityInfo]="false" [userInfo]="adminAndTeamMember">
                                      </app-user-info>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </ng-container>
                            <!---Pagination-->
                            <div *ngIf="teamMembersPagination.totalRecords==0 && !teamMembersLoader.isLoading"
                              class="alert alert-info">
                              <strong>No Data Found.</strong>
                            </div>
                          </div>
                        </div>
                      </td>
                    </tr>
                  </ng-container>
                </tbody>
              </table>
            </div>
            <!-- End of 24 -->
            <div *ngIf="pagination.totalRecords==0 && !httpRequestLoader.isLoading" class="alert alert-info">
              <strong>No Data Found.</strong>
            </div>
          </ng-container>
        </ng-container>
        <div *ngIf="pagination.pagedItems.length !== 0" class="pg8" [hidden]="httpRequestLoader.isLoading">
          <app-pagination [pagination]="pagination" (notifyParent)="navigateToNextPage($event)"
            (notifyParentDropDown)="findPartnerCompanies($event)">
          </app-pagination>
        </div>
      </div>
      <div class="tab-pane fade" id="partnerGroups">
        <div class="portlet-title" style="border-bottom: none;" *ngIf="!httpRequestLoader.isLoading">
          <div class="row">
            <div>
              <div class="col-xs-12">
                <div class="page-toolbar">
                  <div class="left-float" style="float: right !important;padding-left: 10px;">
                    <button class="btn btn-danger" *ngIf="(selectedPartnerGroupIds.length>0) "
                      (click)="clearAll('partnerGroups')">Clear
                      All</button>
                  </div>
                  <div class="btn-group pull-right">
                    <div class="inputs float-right" style="display: inline-flex;">
                      <div class="portlet-input input-inline mSearchAlign" id="search-div">
                        <div class="input-icon right" id="icon">
                          <input type="text" id="sort-text" class="form-control"
                            [(ngModel)]="partnerGroupsSortOption.searchKey" [ngModelOptions]="{standalone: true}"
                            placeholder="search..." (keypress)="partnerGroupsSearchOnKeyEvent($event.keyCode)">
                          <button class="glyphicon glyphicon-remove search-box-item-clear"
                            *ngIf="partnerGroupsSortOption.searchKey"
                            (click)="partnerGroupsSortOption.searchKey='';searchPartnerGroups();"></button>
                          <button type="submit" class="search-box-item-click" (click)="searchPartnerGroups()">
                            <i class="fa fa-search" aria-hidden="true"></i>
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <br>
        <div class="alert alert-success" *ngIf="selectedPartnerGroupIds?.length>0">
          <strong>
            Selected Lists : {{selectedPartnerGroupIds?.length}}
          </strong>
          <ng-template [ngTemplateOutlet]="emailNotificationTemplate"></ng-template>
        </div>
        <app-list-loader *ngIf="httpRequestLoader.isLoading"></app-list-loader>
        <ng-container *ngIf="!httpRequestLoader.isLoading">
          <div class="table-responsive">
            <table class='table tgrid table-condensed table-bordered'
              *ngIf="partnerGroupsPagination.pagedItems?.length>0" id="parnter-groups-table"
              aria-describedby="partnerGroupsDescription">
              <thead>
                <tr>
                  <th scope="col" class="text-center">
                    <input type="checkbox" class="pointer checkBox_shadow"
                      [(ngModel)]="isParnterGroupHeaderCheckBoxChecked" id="parnterGroupsHeaderCheckBox"
                      (change)="selectOrUnselectAllPartnerGroupsOfTheCurrentPage($event)">
                  </th>
                  <th *ngIf="showExpandButton"></th>
                  <th scope="col" class="text-center">List Name</th>
                  <th scope="col" class="text-center">Count</th>
                  <th scope="col" class="text-center">Created Time</th>
                  <th scope="col" class="text-center">Preview</th>
                </tr>
              </thead>
              <tbody>
                <ng-container *ngFor="let partnerGroup of partnerGroupsPagination.pagedItems;let i = index;">
                  <tr id="partnerGroups-tr-{{partnerGroup.id}}"
                    [class.row-selected]="selectedPartnerGroupIds.indexOf(partnerGroup.id)>-1"
                    (click)="highlightSelectedPartnerGroupOnRowClick(partnerGroup.id,$event)">
                    <td class="text-center">
                      <input type="checkbox" class="pointer checkBox_shadow" id="{{partnerGroup.id}}"
                        [checked]="selectedPartnerGroupIds.indexOf(partnerGroup.id)>-1" name="partnerGroupsCheckBox[]"
                        value="{{partnerGroup.id}}"
                        (click)="$event.stopPropagation();highlightPartnerGroupRowOnCheckBoxClick(partnerGroup.id,$event);">
                    </td>
                    <td class="cw" *ngIf="showExpandButton">
                      <div class="actions-block left-float">
                        <a (click)="$event.stopPropagation();viewMatchedContacts(partnerGroup)" data-toggle="tooltip"
                          data-placement="bottom" title="Matched Results">
                          <i class="fa IconCustomization"
                            [ngClass]="{'fa-angle-right': !partnerGroup.expand, 'fa-angle-down': partnerGroup.expand}"
                            aria-hidden="true"></i>
                        </a>
                      </div>
                    </td>
                    <td class="text-center">
                      <span>{{partnerGroup?.groupName | slice:0:40}}</span>
                      <span *ngIf="partnerGroup?.groupName.length>40">...</span>
                    </td>
                    <td class="text-center">
                      {{partnerGroup.numberOfPartners}}
                    </td>
                    <td class="text-center">
                      <app-timestamp [dateAndTime]="partnerGroup?.displayTime">
                      </app-timestamp>
                    </td>
                    <td class="text-center">
                      <div class="actions-block none-float"
                        (click)="$event.stopPropagation();previewUserListUsers(partnerGroup)">
                        <a class="custom-icon" data-toggle="tooltip" data-placement="top" title="Preview"><i
                            class="fa fa-eye IconCustomization" aria-hidden="true"></i>
                          <div class="clickicons"></div>
                        </a>
                      </div>
                    </td>
                  </tr>
                  <tr role="row" *ngIf="partnerGroup?.expand">
                    <td colspan="12">
                      <app-userlist-users [searchKey]="partnerGroupsPagination.searchKey"
                        [userListId]="partnerGroup.id"></app-userlist-users>
                    </td>
                  </tr>
                </ng-container>
              </tbody>
            </table>
          </div>
          <!-- End of 24 -->
          <div *ngIf="partnerGroupsPagination.totalRecords==0 && !httpRequestLoader.isLoading" class="alert alert-info">
            <strong>No Data Found.</strong>
          </div>
        </ng-container>
        <div *ngIf="partnerGroupsPagination.pagedItems.length !== 0" class="pg8" [hidden]="httpRequestLoader.isLoading">
          <app-pagination [pagination]="partnerGroupsPagination" (notifyParent)="navigatePartnerGroups($event)"
            (notifyParentDropDown)="findPartnerGroups($event)">
          </app-pagination>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-container *ngIf="showUsersPreview">
  <app-preview-user-list [userListName]="selectedPartnerGroupName" [userListId]="selectedPartnerGroupId"
    [moduleName]="'lms'" [inputId]="inputId" (notifyParentComponent)="resetValues()"></app-preview-user-list>
</ng-container>

<!--XNFR-326---->
<ng-template #emailNotificationTemplate>
  <span *ngIf="!isTrackOrPlaybookPublishedEmailNotification" class="required float-right">No emails will be sent.</span>
</ng-template>