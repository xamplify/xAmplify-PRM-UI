<ngx-loading [show]="httpRequestLoader.isLoading" [config]="{ backdropBorderRadius: '14px' }"></ngx-loading>
<div style="position: relative; top: -10px">
  <app-response-message [customResponse]="customResponse" *ngIf="customResponse.isVisible"></app-response-message>
</div>
<div class="portlet light remove_cardBgcolor padding_0 light_bg_removal remove_space">
  <div class="row">
    <div class="col-md-12">
      <div class=" clearfix">
        <div class="portlet-title" style="border-bottom: none">
           <app-dam-analytics-details [contentId]="learningTrackId" [contentType]="type"></app-dam-analytics-details> 
          <div class="row">
            <div class="page-toolbar col-xs-12">
              <div class="d-flex justify-content-end align-items-center">
                    <div class="pb3">
                      <select class="form-control mDamSort" [(ngModel)]="sortOption.selectedSortOptionForTracks"
                        (ngModelChange)="sortPartnerCompanies($event)" style="position: relative;">
                        <option *ngFor="let option of sortOption.trackDetailsDropDownOptions" [ngValue]="option">{{option.name}}</option>
                      </select>
                    </div>
                    <div class="input-icon right ml7" style="position: relative;">
                      <input type="text" style="height:34px;" class="form-control" [(ngModel)]="sortOption.searchKey"
                        [ngModelOptions]="{standalone: true}" placeholder="search..." (keypress)="eventHandler($event.keyCode)">
                      <button class="glyphicon glyphicon-remove search-box-item-clear" *ngIf="sortOption.searchKey"
                        (click)="sortOption.searchKey='';search();"></button>
                      <button type="submit" class="search-box-item-click only_content" (click)="search()">
                        <i class="fa fa-search" aria-hidden="true"></i></button>
                    </div>
                      <button data-placement="bottom" class="btn btn-xs hidden-xs l-g-view ml7" data-toggle="tooltip" title="Export to Excel"
                        (click)="downloadTrackAndPlaybooksAnalytics()" [disabled]="pagination?.totalRecords === 0">
                        <i aria-hidden="true" class="fas fa-file-export p10"></i>
                      </button>
                      <a class="close-circle ml7" (click)="goBack()" aria-hidden="true">
                        <i class="fa fa-times" aria-hidden="true"></i>
                      </a>
                      <a class="close-circle ml7" (click)="refreshPage()" aria-hidden="true">
                        <i class="fa fa-refresh" aria-hidden="true"></i>
                      </a>
              </div>
            </div>
          </div>
        </div>
        <app-list-loader *ngIf=" httpRequestLoader.isLoading ">
        </app-list-loader>
        <!---Filter (XNFR-85)-->
        <app-team-member-filter-option *ngIf="!authenticationService?.module?.isMarketingCompany"
          (teamMemberFilterOptionEventEmitter)="getSelectedIndex($event)" [isAssetOrLms]="type=='TRACK' || type=='PLAYBOOK'"></app-team-member-filter-option>
        <ng-container *ngIf="!httpRequestLoader.isLoading">
          <div class="table-responsive pos_pd_top6">
            <table class='table tgrid table-hover table-sm mt10' id="lms-analytics-list-table"
              *ngIf="pagination.pagedItems?.length>0" aria-describedby="lms-list">
              <thead>
                <tr>
                  <th class="hidden-xs" colspan="2" style="width: 35%" id="border-bottom">
                    <span class="ui-column-resizer gray"
                      (mousedown)="referenceService.onMouseDown($event,'lms-analytics-list-table',2)">
                    </span>
                    <span class="gridHeader" translate>Company</span>
                  </th>
                  <th class="visible-xs" colspan="1" style="width: 45%" id="border-bottom">
                    <span class="ui-column-resizer gray"
                      (mousedown)="referenceService.onMouseDown($event,'manage-lms-list-table',1)">
                    </span>
                    <span class="gridHeader" translate>Company</span>
                  </th>
                  <th class="text-center" translate>View Count</th>
                  <th class="text-center" id="min-width" translate>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let company of pagination.pagedItems ;let i =index">
                  <td class="hidden-xs text-center" style="width: 10%;">
                    <div class="thumbnail-wrapper image_effect">
                      <img class="img-company-list" [src]="authenticationService.MEDIA_URL + company.companyLogo"
                        onerror="this.src='assets/images/company-profile-logo.png';" alt="{{company.companyLogo}}">
                    </div>
                  </td>
                  <td>
                    <h4 class="mt5 mb5 f-w-600 analytics-tooltip" data-toggle="tooltip" data-placement="bottom" title="{{company.companyName}}">
                      <span><strong>{{company.companyName}}</strong></span>
                    </h4><br>
                    <h6 class="green-banner inline-flex" *ngIf="company?.partnerStatus === 'deactivated'" data-toggle="tooltip"
                      data-placement="bottom" title="Partnership is deactivated">DEACTIVATED</h6>
                  </td>
                  <td class="text-center"> {{company.viewCount}} / {{company.count}}</td>
                  <td class="mtext-center" id="actions-row">
                    <div class="actions-block override-actions custom-width-icon">
                      <a class="custom-icon" *ngIf="company.count > 0" data-toggle="tooltip" data-placement="top"
                        title="View Analytics" (click)="viewAnalytics(company)">
                        <i class="fa fa-line-chart IconCustomization" aria-hidden="true"></i>
                        <div class="clickicons"></div>
                      </a>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </ng-container>
        <div *ngIf="pagination.pagedItems.length !== 0" class="pg8">
          <app-pagination [pagination]="pagination" (notifyParent)="setPage($event)"
            (notifyParentDropDown)="getAnalytics($event)" [hidden]="httpRequestLoader.isLoading">
          </app-pagination>
        </div>
        <!-- End of 24 -->
        <div *ngIf="pagination.totalRecords==0 && !httpRequestLoader.isLoading" class="alert alert-info">
          <strong translate>No Data Found.</strong>
        </div>
      </div>
    </div>
  </div>
</div>