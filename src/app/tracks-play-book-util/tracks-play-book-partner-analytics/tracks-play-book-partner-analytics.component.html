<ngx-loading [show]="httpRequestLoader.isLoading" [config]="{ backdropBorderRadius: '14px' }"></ngx-loading>
<div style="position: relative; top: -10px">
  <app-response-message [customResponse]="customResponse" *ngIf="customResponse.isVisible"></app-response-message>
</div>
<div class="page-bar">
  <div class="row">
    <div class="col-md-12">
      <div class="portlet light clearfix" style="min-height: 644px;">
        <div class="portlet-title" style="border-bottom: none">
          <div class="row">
            <div class="page-toolbar col-xs-12">
              <div class="btn-group pull-right">
                <div class="inputs" style="float: right">
                  <div class="portlet-input input-inline" style="margin-right: 15px;width: 180px;">
                    <div class="input-icon right" style="position: relative;right: -11px;">
                      <input type="text" style="height:34px;" class="form-control" [(ngModel)]="sortOption.searchKey"
                        [ngModelOptions]="{standalone: true}" placeholder="Search..."
                        (keypress)="eventHandler($event.keyCode)">
                      <button class="glyphicon glyphicon-remove search-box-item-clear" *ngIf="sortOption.searchKey"
                        (click)="sortOption.searchKey='';search();"></button>
                      <button type="submit" class="search-box-item-click" (click)="search()">
                        <i class="fa fa-search" aria-hidden="true"></i></button>
                    </div>
                  </div>
                  <a class="close-circle xamp-margin-left-icon" (click)="goBack()" aria-hidden="true">
                    <i class="fa fa-times" aria-hidden="true"></i>
                  </a>
                  <a class="close-circle xamp-margin-left-icon" (click)="refreshPage()" aria-hidden="true">
                    <i class="fa fa-refresh" aria-hidden="true"></i>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
        <app-list-loader *ngIf=" httpRequestLoader.isLoading ">
        </app-list-loader>
        <ng-container *ngIf="!httpRequestLoader.isLoading">
          <div class="table-responsive">
            <table class='table tgrid table-hover table-sm' id="lms-analytics-list-table"
              *ngIf="pagination.pagedItems?.length>0" aria-describedby="lms-list">
              <thead>
                <tr>
                  <th class="" style="width: 35%" id="border-bottom">
                    <span class="gridHeader" translate>{{authenticationService?.partnerModule?.customName}}</span>
                  </th>
                  <th *ngIf="type == undefined || type == 'TRACK'" class="text-center" style="width: 35%" translate>
                    Progress</th>
                  <th *ngIf="type == undefined || type == 'TRACK'" class="text-center" translate>QUiz Score</th>
                  <th *ngIf="type != undefined && type == 'PLAYBOOK'" class="text-center" translate>Updated On</th>
                  <th class="text-center" id="min-width" translate>Actions</th>
                </tr>
              </thead>
              <tbody>
                <ng-container *ngFor="let partner of pagination.pagedItems ;let i =index">
                  <tr>
                    <td>
                      <app-user-info [userInfo]="partner"> </app-user-info>
                    </td>
                    <td *ngIf="type == undefined || type == 'TRACK'" class="text-center">
                      <div class="progress" style="width: 50%; margin: 0px 25%;">
                        <div class="progress-bar" data-toggle="tooltip" data-placement="top"
                          title="{{partner.learningTrackProgress}}%"
                          [ngStyle]="{'width': partner.learningTrackProgress + '%'}" style="border-radius:1px;"
                          role="progressbar">
                        </div>
                      </div>
                      <span *ngIf="partner.learningTrackProgress != undefined">{{partner.learningTrackProgress}}%</span>
                      <span *ngIf="partner.learningTrackProgress == undefined">0%</span>
                    </td>
                    <td class="quiz-width" *ngIf="type == undefined || type == 'TRACK'">
                      <div *ngIf="partner.hasLearningTrackQuiz && partner.learningTrackProgress == 100" (click)="showFormAnalytics(partner)">
                        <div class="quiz-score-margin">
                        <h6 class="view-banner" style="background-color: #5cb85c;" translate>
                          {{partner.learningTrackScore}} out of {{partner.learningTrackMaxScore}}
                        </h6>
                      </div>
                        <div *ngIf="partner?.quizSubmittedTime">
                          Submitted On <br>
                          <app-timestamp [showInLine]="'true'" [dateAndTime]="partner.quizSubmittedTime">
                          </app-timestamp>
                        </div>
                      </div>
                      <div class="quiz-score-margin" *ngIf="partner.hasLearningTrackQuiz && partner.learningTrackProgress != 100">
                        <h6 class="view-banner" style="background-color: #cad2ca;" translate>Not Yet Finished
                        </h6>
                      </div>
                      <div class="quiz-score-margin" *ngIf="!partner.hasLearningTrackQuiz">
                        <h6 class="view-banner" style="background-color: #cad2ca;" translate>Quiz Not Available
                        </h6>
                      </div>
                    </td>
                    <td *ngIf="type != undefined && type == 'PLAYBOOK'" class="hidden-xs text-center">
                      <app-timestamp [dateAndTime]="partner.updatedTime">
                      </app-timestamp>
                  </td>
                    <td id="actions-row" class="text-center">
                      <div class="actions-block override-actions custom-width-icon" [ngClass]="{'no-float' : type != undefined && type == 'PLAYBOOK'}" >
                        <a data-toggle="tooltip" data-placement="top" title="View Analytics"
                          (click)="viewAnalytics(partner,i)">
                          <i class="fa fa-line-chart" aria-hidden="true"></i>
                        </a>
                      </div>
                      <!-- <div class="actions-block override-actions custom-width-icon">
                                                    <a data-toggle="tooltip" data-placement="top" title="View Analytics" (click)="viewAnalytics(partner,i)">
                                                        <i class="fa" [ngClass]="{'fa-plus': !partner.expanded, 'fa-minus': partner.expanded}"></i>
                                                    </a>
                                                </div> -->
                    </td>
                  </tr>
                  <!-- <tr [ngClass]="{'hidden': !partner.expanded}" id="analytics-tr">
                                            <td colspan="4">
                                                <div class="table-responsive">
                                                    <table class="table tgrid table-hover table-sm" id="analytics">
                                                        <thead>
                                                            <tr>
                                                                <th class="text-center">Content</th>
                                                                <th class="text-center">View Count</th>
                                                                <th class="text-center">Download Count</th>
                                                                <th class="text-center">Status</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <app-auto-response-loader *ngIf="analyticsLoader.isLoading">
                                                            </app-auto-response-loader>
                                                            <ng-container *ngIf="!analyticsLoader.isLoading">
                                                                <tr *ngFor="let item of analyticsPagination.pagedItems;let i=index">
                                                                    <td class="text-center"></td>
                                                                    <td class="text-center"></td>
                                                                    <td class="text-center"></td>
                                                                    <td class="text-center"></td>
                                                                </tr>
                                                            </ng-container>
                                                        </tbody>
                                                    </table>
                                                </div>
                                                <div *ngIf="analyticsPagination.pagedItems.length !== 0">
                                                    <app-pagination [pagination]="analyticsPagination" (notifyParent)="setDetailedAnalyticsPage($event)" (notifyParentDropDown)="listDetailedAnalytics($event)" [hidden]="analyticsLoader.isLoading"></app-pagination>
                                                </div>
                                            </td>
                                        </tr> -->
                </ng-container>
              </tbody>
            </table>
          </div>
        </ng-container>
        <div *ngIf="pagination.pagedItems.length !== 0" class="pg8">
          <app-pagination [pagination]="pagination" (notifyParent)="setPage($event)"
            (notifyParentDropDown)="getAnalytics($event)" [hidden]="httpRequestLoader.isLoading">
          </app-pagination>
        </div>
        <!-- End of 24 -->
        <div *ngIf="pagination.totalRecords==0 && !httpRequestLoader.isLoading" class="alert alert-info">
          <strong translate>No Data Found.</strong>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- analytics Popup -->
<div class="modal right" id="analytics-list" data-backdrop="static">
  <div class="modal-dialog modal-lg" style="width: 75%;right:0">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close-circle" data-dismiss="modal">
          <i class="fa fa-times" aria-hidden="true"></i>
        </button>
        <h4 class="modal-title text-center">Analytics</h4>
      </div>
      <div class="modal-body">
        <div class="row" style="padding-left: 15px;">
          <div class="page-toolbar col-xs-12 p5">
            <div class="btn-group pull-right">
              <div class="inputs" style="float: right;">
                <div class="portlet-input input-inline" id="search" style="width: 180px;">
                  <div id="search-icon">
                    <input type="text" id="search-text" class="form-control" style="height: 34px;"
                      [(ngModel)]="detailedAnalyticsSortOption.searchKey" [ngModelOptions]="{standalone: true}"
                      placeholder="search..." (keypress)="detailedAnalyticsEventHandler($event.keyCode)">
                    <button class="glyphicon glyphicon-remove search-box-item-clear"
                      *ngIf="detailedAnalyticsSortOption.searchKey"
                      (click)="detailedAnalyticsSortOption.searchKey='';detailedAnalyticsSearch();"></button>
                    <button type="submit" class="search-box-item-click" (click)="detailedAnalyticsSearch()"><i
                        class="fa fa-search"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-xs-12 p5">
            <ngx-loading [show]="detailedAnalyticsLoader.isLoading" [config]="{ backdropBorderRadius: '14px' }">
            </ngx-loading>
            <div>
              <ul class="timeline custom-padding"
                *ngFor="let detailedAnalytics of detailedAnalyticsPagination.pagedItems ;let i =index">
                <li class="timeline-inverted">
                  <div class="timeline-badge">
                    <img alt="Image not found" [src]="detailedAnalytics.assetThumbnail">
                  </div>
                  <div class="timeline-panel">
                    <div class="timeline-heading name-wrap">
                      <span class="timeline-title">
                        <label>Asset Name:</label>
                        <h5 style="display: inline;" title="{{detailedAnalytics.assetName}}">{{detailedAnalytics.assetName}}</h5>
                      </span>
                    </div>
                    <div class="timeline-body">
                      <div>
                        <span *ngIf="detailedAnalytics.type == 'OPENED'">
                          Opened On
                        </span>
                        <span *ngIf="detailedAnalytics.type == 'VIEWED'">
                          Viewed On
                        </span>
                        <span *ngIf="detailedAnalytics.type == 'DOWNLOADED'">
                          Downloaded On
                        </span>
                        <app-timestamp [showInLine]="'true'" [dateAndTime]="detailedAnalytics.createdTime">
                        </app-timestamp>
                      </div>
                    </div>
                  </div>
                </li>
              </ul>
            </div>
            <div *ngIf="detailedAnalyticsPagination.pagedItems.length !== 0" class="pg8">
              <app-pagination [pagination]="detailedAnalyticsPagination"
                (notifyParent)="setDetailedAnalyticsPage($event)"
                (notifyParentDropDown)="getPartnerDetailedAnalytics($event)"
                [hidden]="detailedAnalyticsLoader.isLoading">
              </app-pagination>
            </div>
            <!-- End of 24 -->
            <div *ngIf="detailedAnalyticsPagination.totalRecords==0 && !detailedAnalyticsLoader.isLoading"
              class="alert alert-info">
              <strong>No Data Found.</strong>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Form analytics -->
<app-form-preview-with-submitted-answers #formPreviewWithSubmittedAnswersComponent>
</app-form-preview-with-submitted-answers>