<app-response-message [customResponse]="customResponse" *ngIf="customResponse.isVisible">
</app-response-message>
<ngx-loading [show]="httpRequestLoader.isLoading" [config]="{ backdropBorderRadius: '14px' }"></ngx-loading>
<div [ngClass]="{'blur-content' : showFilePreview}">
    <ng-container *ngIf="tracksPlayBook != undefined && !httpRequestLoader.isLoading">
        <section *ngIf="showTracksPlayBook">
            <div class="row">
                <div class="col-md-9 col-lg-9" style="padding-right: 0px;">
                    <div class="page-bar" style="padding: 0px;">
                        <div class="col-md-12 col-lg-12"
                            style="border-bottom: 2px solid #cac8c8;padding: 5px 5px 5px 10px;margin-bottom: 10px;background-color: #008fd5;border-top-left-radius: 5px;border-top-right-radius: 5px;">
                            <div class="row">
                                <div class="col-md-6 col-lg-6" style="padding: 3px 17px;">
                                    <a class="title padding_bottom"
                                        style="font-size: 15px; padding-top: 10px;">{{tracksPlayBook.title}}</a>

                                </div>
                            </div>
                        </div>
                        <div class="padding_bottom text-wrap">
                            <div [innerHTML]="tracksPlayBook.description"></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-lg-3">
                    <div class="page-bar" style="padding: 10px 10px;height: 255px;">
                        <img class="img-asset-class" [src]="tracksPlayBook.featuredImage" alt=""
                            onerror="this.src='assets/images/lms.jpg';" style="height: 140px !important;
                                                       width: 100% !important;">
                        <div class="center" style="padding-top: 10px;" title="{{tracksPlayBook.createdByName}}"
                            translate>
                            Created By <strong>{{tracksPlayBook.createdByName}}</strong>
                        </div>
                        <div class="center" style="padding-top: 10px;" title="{{tracksPlayBook.createdTime}}" translate>
                            Created On
                            <strong>
                                <app-timestamp [showInLine]="'true'" [dateAndTime]="tracksPlayBook.createdTime">
                                </app-timestamp>
                            </strong>
                        </div>
                        <div *ngIf="(type == undefined || type == 'TRACK') && isCreatedUser" class="center"
                            style="padding-top: 10px;">
                            <button [className]="authenticationService.module.playbookAccess ? 'add-button-xamplify':'inactive'" [title]="authenticationService.module.playbookAccess?'':'You do not have access'" (click)="saveAsPlayBook(authenticationService.module.playbookAccess)" translate>
                                <i class="fa fa-plus" aria-hidden="true"></i>  
                                Add To PlayBooks
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <section *ngIf="!showTracksPlayBook">
            <div [ngClass]="{'page-bar ' : showAsset}">
                <div class="col-md-12 col-lg-12" style="padding:0px;">
                    <div style="padding: 10px 0px 0px 0px;">
                        <a (click)="closeView()" class="pull-right close-circle"
                            style="padding: 3px 5px; margin: 8px 10px 0px 0px;">
                            <span class="glyphicon glyphicon-remove" style="z-index: 1;font-size: 13px;"
                                aria-hidden="true"></span></a>
                        <div style="padding: 3px;border-bottom: 2px solid #cac8c8;">
                            <div class="title-page-bar"  style="font-size: 15px;" >
                                <strong style="margin: 0px 0px 0px 10px;">{{tracksPlayBook.title}}</strong>
                            </div>
                        </div>
                    </div>
                    <app-form-preview *ngIf="!showAsset" [learningTrackId]="tracksPlayBook.id"
                        (notifyParent)="closeView($event)">
                    </app-form-preview>
                    <div *ngIf="showAsset" class="padding">
                        <div style="padding-top: 10px;padding-left: 5px;">
                            <app-modal-popup-loader [hidden]="!assetViewLoader"></app-modal-popup-loader>
                            <div [hidden]="assetViewLoader">
                                <div class="page-bar" style="margin-bottom: 10px!important;padding:0px 0px !important;">
                                    <div class="row">
                                        <div class="col-md-8 col-lg-8 cpdam">
                                            <div class="portlet light cphdam box-shadow" style="height: 217px;">
                                                <div class="portlet-title port-heading">
                                                    <div class="caption" style="color: #fff!important;">
                                                        <h4>
                                                            <strong>{{assetDetails?.assetName |
                                                                slice:0:50}}</strong>
                                                            <span *ngIf="assetDetails?.assetName?.length>50">..</span>
                                                        </h4>
                                                    </div>
                                                </div>
                                                <div class="description-scroll">
                                                    {{assetDetails?.description}}
                                                    <br>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4 col-lg-4" style="padding: 6px 10px 0px 10px;">
                                            <div>
                                                <div class="grid-box box-shadow" style="min-height: 200px;margin-top: 0px;">
                                                    <img class="img-class img-max-width" src="{{assetDetails?.thumbnailPath}}"
                                                        alt="No Image Found"><br>
                                                    <a class="btn btn-primary"
                                                        [ngClass]="{'isDisabled' : !assetDetails?.thumbnailPath}"
                                                        (click)="downloadAsset(assetDetails)">Download</a>
                                                    <a class="btn btn-primary"
                                                        (click)="assetPreview(assetDetails)">View</a>
                                                    <div class="center" style="padding: 10px;margin: 0 !important;font-size: 14px;" title="{{assetDetails.assetType}}"
                                                        translate>
                                                        <strong>Type: </strong>{{assetDetails.assetType}}<br>
                                                        <strong>Title: </strong>{{assetDetails?.assetName | slice:0:50}}
                                                        <span *ngIf="assetDetails?.assetName?.length>50">..</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <section *ngIf="showAsset || showTracksPlayBook">
                <div class="col-md-12 col-lg-12"
                    style="border-bottom: 2px solid #cac8c8;padding: 5px 5px 5px 10px;margin-bottom: 10px;background-color: #008fd5;border-top-left-radius: 5px;border-top-right-radius: 5px;">
                    <div style="padding: 3px;">
                        <a class="title padding_bottom" style="font-size: 15px; padding-top: 10px;">Content</a>
                    </div>
                </div>
            <div class="page-bar">
                <div class="row padding_bottom">
                    <div class="col-md-3 col-sm-4 col-xs-12" *ngFor="let content of tracksPlayBook.contents ;let i =index"
                        id="ContentListDiv_{{content.id}}">
                        <div
                            [ngClass]="{'disable' : (type == undefined || type == 'TRACK') && i != 0 && tracksPlayBook.followAssetSequence && !tracksPlayBook.contents[i-1].finished && !isCreatedUser}">
                            <div class="grid-box box-shadow" (click)="viewContent(content)">
                                <img class="image-fixed" [src]="content.thumbnailPath"
                                    onerror="this.src='tracksPlayBook.featuredImage';" alt="{{content.title}}">
                                <!-- <h4 class="ellipsis mt5 mb5 f-w-600" title="{{content.assetName}}"
                                    style="text-align: left !important;padding: 5px 0px 5px 10px !important;border-top: 2px solid #cac8c8;">
                                    Title: {{content.assetName | slice:0:25}} <span *ngIf="content.assetName?.length>25">...</span>
                                </h4> -->
                                <h5 class="grid-asset-title" title="{{content.assetName}}" translate>
                                    <strong>Title: </strong>{{content.assetName | slice:0:25}} <span *ngIf="content.assetName?.length>25">...</span>
                                </h5>
                                <h6 class="asset-type" title="{{content.assetType}}" translate>
                                    <strong>Type: </strong>{{content.assetType}}
                                </h6>
                                <div *ngIf="!isCreatedUser && (type == undefined || type == 'TRACK')" class="ribbon">
                                    <span style="background-color: #5cb85c;" *ngIf="content.finished" translate>Finished</span>
                                    <span style="background-color: #819081;" *ngIf="content.opened && !content.finished"
                                        translate>In
                                        Progress</span>
                                </div>
                                <div class="bar">
                                    <a [ngClass]="{'isDisabled' : (type == undefined || type == 'TRACK') && i != 0 && tracksPlayBook.followAssetSequence && !tracksPlayBook.contents[i-1].finished && !isCreatedUser}"
                                        data-toggle="tooltip" data-placement="top" title="View"
                                        (click)="$event.stopPropagation();viewContent(content)">
                                        <i class="fa fa-eye" aria-hidden="true"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div *ngIf="type == undefined || type == 'TRACK'" class="col-md-3 col-sm-4 col-xs-12">
                        <div [ngClass]="{'disable' : !isCreatedUser && !tracksPlayBook.enableQuiz}">
                            <div class="grid-box box-shadow" *ngIf="tracksPlayBook.quiz" (click)="viewQuiz()">
                                <img class="image-fixed" [src]="tracksPlayBook.featuredImage"
                                    onerror="this.src='assets/images/form.png';" alt="Image Not Found">
                                <h5 class="grid-asset-title" title="{{tracksPlayBook.quiz.name}}" translate>
                                    <strong>Title: </strong>{{tracksPlayBook.quiz.name | slice:0:25}} <span
                                        *ngIf="tracksPlayBook.quiz.name?.length>25">...</span><br>
                                </h5>
                                <h6 class="asset-type" title="Form" translate>
                                    <strong>Type: </strong>Form
                                </h6>
                                <div *ngIf="!isCreatedUser && !tracksPlayBook.enableQuiz && tracksPlayBook.progress != undefined && tracksPlayBook.progress === 100"
                                    class="ribbon">
                                    <span style="background-color: #5cb85c;" translate>Finished</span>
                                </div>
                                <div class="ribbon-right">
                                    <span style="background-color: #5cb85c;" translate>Quiz</span>
                                </div>
                                <div class="bar">
                                    <a *ngIf="!isCreatedUser" [ngClass]="{'isDisabled' : !tracksPlayBook.enableQuiz}"
                                        data-toggle="tooltip" data-placement="top" title="View" (click)="viewQuiz()">
                                        <i class="fa fa-eye" aria-hidden="true"></i>
                                    </a>
                                    <a *ngIf="isCreatedUser" data-toggle="tooltip" data-placement="top" title="View"
                                        (click)="viewQuiz()">
                                        <i class="fa fa-eye" aria-hidden="true"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </ng-container>
</div>

<!-- Form Preview Modal Popup -->
<app-preview-popup #previewPopupComponent></app-preview-popup>

<!-- Preview Assets -->
<ng-container *ngIf="showFilePreview">
    <div class="overlay page-content">
        <button type="button" class="close-circle" data-dismiss="modal" (click)="closeAssetPreview()">
            <i class="fa fa-times" aria-hidden="true"></i>
        </button>
        <div class="overlay-content">
            <ng-container *ngIf="isImage">
                <img class="fit-preview-asset" [src]="filePath" alt="No Image Found"><br>
            </ng-container>
            <ng-container *ngIf="isVideo">
                <video class="fit-preview-asset" controls>
                    <source [src]="filePath" [type]="fileType">
                    Your browser does not support the video tag.
                </video>
            </ng-container>
            <ng-container *ngIf="isAudio">
                <audio controls>
                    <source [src]="filePath" [type]="fileType">
                    Your browser does not support the audio tag.
                </audio>
            </ng-container>
            <div *ngIf="isFile && filePath?.length > 0">
                <iframe [src]="url" style="width:100%; height:75vh;" frameborder="0"></iframe>
            </div>
        </div>
    </div>
</ng-container>


<!-- Preview Bee Template Modal Popup-->
<div class="modal fade right" id="asset-preview-modal" tabindex="-1" role="dialog" data-backdrop="static"
    data-keyboard="false">
    <div class="modal-dialog modal-lg modal-template fullwidth" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close-circle" data-dismiss="modal" aria-hidden="true">
                    <i class="fa fa-times" aria-hidden="true"></i>
                </button>
                <h4 class="modal-title" id="assetTitle"></h4>
            </div>
            <div class="modal-body">
                <app-modal-popup-loader *ngIf="modalPopupLoader"></app-modal-popup-loader>
                <div id="asset-preview-content">
                </div>
            </div>
            <div class="modal-footer">
                <a href="javascript:void(0)" data-dismiss="modal" class="btn btn-default" style="float: right">Close</a>
            </div>
        </div>
    </div>
</div>