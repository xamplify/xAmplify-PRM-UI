<script>
  webshims.setOptions('forms-ext', {
    replaceUI: 'auto',
    types: 'number'
  });
  webshims.polyfill('forms forms-ext');
</script>

<div class="portlet light" id="del-profile-div">
  <ngx-loading [show]="isLoading" [config]="{ backdropBorderRadius: '14px' }"></ngx-loading>
  <div class="portlet-title">
    <div class="caption" *ngIf="submitButtonText == 'REGISTER DEAL'">Deal Registration</div>
    <div class="caption" *ngIf="submitButtonText != 'REGISTER DEAL'">Deal Details</div>
  </div>
  <!-- <app-response-message [customResponse]="customResponse" *ngIf="customResponse.isVisible"></app-response-message> -->
  <div class="alert alert-danger" id="company-profile-error-div" style="display: none;">
    <a class="close" aria-label="close">x</a>
    <strong>Please complete the required (*) fields. </strong>
  </div>
  <div class="portlet-body clearfix">
    <div>
      <form role="form" id="deal-registration-form">
      
        <!-- <div class="row" style="margin: 20px;" *ngIf="!dealRegistration.pushToMarketo && !isVendor" >
                    <div class="col-xs-12 col-md-10" >
                      <h4 style="float:right;">Push Opportunity to Marketo :</h4>
      
                    </div>
                    <div class="col-xs-12 col-md-2">
                        <switch [status]="false" [onText]="callActionSwitch.onTextValue" [offText]="callActionSwitch.offTextValue" [onColor]="callActionSwitch.onGreenColorSwitch"
                        [offColor]="callActionSwitch.onDefaultColorSwitch" [size]="callActionSwitch.size" (click)="pushMarketo(pushToMarketo)" id="falseAction" *ngIf="!pushToMarketo">
                         </switch>
                         <switch [status]="true" [onText]="callActionSwitch.onTextValue" [offText]="callActionSwitch.offTextValue" [onColor]="callActionSwitch.onGreenColorSwitch"
                        [offColor]="callActionSwitch.onDefaultColorSwitch" [size]="callActionSwitch.size" (click)="pushMarketo(pushToMarketo)" id="trueAction" *ngIf="pushToMarketo">
                         </switch>
                    </div>
                </div>
                <div class="row" style="margin: 20px;pointer-events:none" *ngIf="dealRegistration.pushToMarketo" >
                    <div class="col-xs-12 col-md-10" >
                      <h4 style="float:right;">Push Opportunity to Marketo :</h4>
      
                    </div>
                    <div class="col-xs-12 col-md-2" style="opacity: 0.5;">
                        <switch [status]="dealRegistration.pushToMarketo" [onText]="callActionSwitch.onTextValue" [offText]="callActionSwitch.offTextValue" [onColor]="callActionSwitch.onGreenColorSwitch"
                        [offColor]="callActionSwitch.onDefaultColorSwitch" [size]="callActionSwitch.size" >
                         </switch>
      
                    </div>
                </div> -->
        <div class="row portlet light" style="margin-bottom: 50px;border: 1px solid darkslategrey;margin: 10px;padding: 10px">
      
          <!-- left page -->
          <h4 class="caption" class="portlet-title">Opportunity Details</h4>
          <div class="col-sm-6 col-xs-12">
            <div class="form-group" style="margin-bottom: 20px">
              <label class="control-label">Campaign Name
                <font style="color: #f55d7a">
                  <b>*</b>
                </font>
              </label>
              <input type="text" disabled="disabled" name="campaignName" value="{{campaign.campaignName}}"
                class="form-control" id="campaignName" />
            </div>
      
            <div class="form-group" [attr.class]="company" style="margin-bottom: 20px">
              <label class="control-label">Company
                <font style="color: #f55d7a">
                  <b>*</b>
                </font>
              </label>
              <input type="text" maxlength="100" class="form-control" [(ngModel)]=" dealRegistration.company"
                [ngModelOptions]="{standalone: true}" id="company" (input)="validateField('company',false)"
                [disabled]="isVendor || isPreview" />
            </div>
            <div class="form-group" [attr.class]="firstName" style="margin-bottom: 20px">
              <label class="control-label">First Name
                <font style="color: #f55d7a">
                  <b>*</b>
                </font>
              </label>
              <input type="text" maxlength="100" name="companyName" class="form-control"
                [(ngModel)]=" dealRegistration.firstName" [ngModelOptions]="{standalone: true}" id="firstName"
                (input)="validateField('firstName',false)" [disabled]="isVendor || isPreview" />
            </div>
      
            <div class="form-group" [attr.class]="lastName" style="margin-bottom: 20px">
              <label class="control-label">Last Name
                <font style="color: #f55d7a">
                  <b>*</b>
                </font>
              </label>
              <input type="text" maxlength="100" class="form-control" [(ngModel)]=" dealRegistration.lastName"
                [ngModelOptions]="{standalone: true}" id="lastName" (input)="validateField('lastName',false)"
                [disabled]="isVendor  || isPreview" />
            </div>
            <div class="form-group" [attr.class]="title" style="margin-bottom: 20px">
              <label class="control-label">Job Title
                <font style="color: #f55d7a">
                  <b>*</b>
                </font>
              </label>
              <input type="text" maxlength="100" name="role" class="form-control" [(ngModel)]=" dealRegistration.role"
                [ngModelOptions]="{standalone: true}" id="role" (input)="validateField('role',false)"
                [disabled]="isVendor || isPreview" />
            </div>
      
            <div class="form-group" *ngIf="dealRegistration.email" style="margin-bottom: 20px">
              <label class="control-label">Email
                <font style="color: #f55d7a">
                  <b>*</b>
                </font>
              </label>
              <input type="text" maxlength="100" class="form-control" [(ngModel)]=" dealRegistration.email"
                [ngModelOptions]="{standalone: true}" id="email" disabled />
            </div>
      
            <div class="form-group" [attr.class]="phoneDivClass" style="margin-bottom: 20px">
              <label class="control-label">Phone Number
                <font style="color: #f55d7a">
                  <b>*</b>
                </font>
              </label>
              <!--   <fieldset style="padding:0 !important;border: 1px solid #ece2e2 !important">
                      <int-phone-prefix [(ngModel)]="dealRegistration.phone" (input)="validateField('phone',false)" (blur)="validateField('phone',false)"
                        [ngModelOptions]="{standalone: true}" [disabled]="isVendor || isPreview"
                        class="phone-input"></int-phone-prefix>
                    </fieldset> -->
              <input type="text" maxlength="20" class="form-control" [(ngModel)]=" dealRegistration.phone"
                [ngModelOptions]="{standalone: true}" (input)="validateField('phone',false)"
                (blur)="validateField('phone',false)" [disabled]="isVendor || isPreview" />
              <span *ngIf="phoneError" style="color: #f55d7a">{{phoneErrorMessage}}</span>
            </div>
      
      
      
      
      
          </div>
          <!-- right page -->
          <div class="col-sm-6 col-xs-12">
      
      
      
            <div class="form-group" [attr.class]="leadStreet" style="margin-bottom: 20px">
              <label class="control-label">Lead Address
                <font style="color: #f55d7a">
                  <b>*</b>
                </font>
              </label>
              <textarea type="text" maxlength="100" class="form-control" name="leadstreet"
                [(ngModel)]=" dealRegistration.leadStreet" [ngModelOptions]="{standalone: true}"
                (input)="validateField('leadStreet',false)" id="leadStreet" [disabled]="isVendor || isPreview"></textarea>
            </div>
            <div class="form-group" [attr.class]="leadCity" style="margin-bottom: 20px">
              <label class="control-label">Lead City
                <font style="color: #f55d7a">
                  <b>*</b>
                </font>
              </label>
              <input type="text" maxlength="100" name="city" class="form-control" [(ngModel)]=" dealRegistration.leadCity"
                [ngModelOptions]="{standalone: true}" (input)="validateField('leadCity',false)" id="leadCity"
                [disabled]="isVendor || isPreview" />
            </div>
      
            <div class="form-group" [attr.class]="leadState" style="margin-bottom: 20px">
              <label class="control-label">Lead State/Province
                <font style="color: #f55d7a">
                  <b>*</b>
                </font>
              </label>
              <input type="text" maxlength="100" class="form-control" name="lead state"
                [(ngModel)]=" dealRegistration.leadState" [ngModelOptions]="{standalone: true}" id="leadState"
                (input)="validateField('leadState',false)" [disabled]="isVendor || isPreview" />
            </div>
            <div class="form-group" [attr.class]="leadPostalCode" style="margin-bottom: 20px">
              <label class="control-label">Lead Postal Code
                <font style="color: #f55d7a">
                  <b>*</b>
                </font>
              </label>
              <input type="text" maxlength="10" name="companyName" class="form-control"
                [(ngModel)]=" dealRegistration.postalCode" [ngModelOptions]="{standalone: true}" id="leadPostalCode"
                (input)="validateField('leadPostalCode',false)" [disabled]="isVendor || isPreview" />
            </div>
      
            <div class="form-group" [attr.class]="country" style="margin-bottom: 20px">
              <label class="control-label">Lead Country
                <font style="color: #f55d7a">
                  <b>*</b>
                </font>
              </label>
              <select class="form-control" [(ngModel)]="dealRegistration.leadCountry" [ngModelOptions]="{standalone: true}"
                placeholder="Country" id="leadCountry" (input)="validateField('leadCountry',false)"
                [disabled]="isVendor || isPreview">
                <option *ngFor="let country of countryNames.countries" [value]="country"
                  [selected]="dealRegistration.leadCountry==country">{{country}}</option>
              </select>
            </div>
            <div class="form-group" [attr.class]="websiteDivClass" style="margin-bottom: 20px">
              <label class="control-label">Website
                <font style="color: #f55d7a">
                  <b>*</b>
                </font>
              </label>
              <input type="text" maxlength="100" id="website" name="website" class="form-control"
                [(ngModel)]="dealRegistration.website" (input)="validateField('website',false)"
                [disabled]="isVendor || isPreview" />
              <span *ngIf="websiteError" style="color: #f55d7a">{{websiteErrorMessage}}</span>
            </div>
      
      
          </div>
      
        </div>
        <div [hidden]="!showSfDealFields">
          <app-sf-deal [dealId]="dealId" [isPreview]="isPreview" [isVendor]="isVendor" [campaign]="campaign"></app-sf-deal>
        </div>
        <div [hidden]="showSfDealFields">
          <div class=" row portlet light"
            style="margin-bottom: 50px;border: 1px solid darkslategrey;margin: 10px;padding: 10px">
            <h4 class="caption" class="portlet-title">Deal Details</h4>
            <div class="form-group" [attr.class]="title" style="margin-bottom: 20px">
              <label class="control-label">Title
                <font style="color: #f55d7a">
                  <b>*</b>
                </font>
              </label>
              <input type="text" maxlength="100" name="titleName" class="form-control" [(ngModel)]=" dealRegistration.title"
                [ngModelOptions]="{standalone: true}" id="title" (input)="validateField('title',false)"
                [disabled]="isVendor || isPreview" />
            </div>
      
      
      
            <div class="form-group" [attr.class]="dealType" style="margin-bottom: 20px">
              <label class="control-label">Deal Type
                <font style="color: #f55d7a">
                  <b>*</b>
                </font>
              </label>
      
              <select class="form-control" [(ngModel)]="dealRegistration.dealType" [ngModelOptions]="{standalone: true}"
                id="dealType" (input)="validateField('dealType',false)" [disabled]="isVendor  || isPreview">
                <option *ngFor="let dt of defaultDealTypes" [value]="dt" [selected]="dealRegistration.dealType == dt">
                  {{dt!='Select Dealtype'?dt:'-- Select Deal Type --'}}</option>
                <option *ngFor="let dt of dealTypes" [value]="dt.dealType"
                  [selected]="dealRegistration.dealType == dt.dealType">{{dt.dealType}}</option>
              </select>
      
            </div>
      
      
            <div class="form-group " [attr.class]="opportunityAmount" style="margin-bottom: 20px">
              <label class="control-label">Opportunity Amount
                <font style="color: #f55d7a">
                  <strong>*</strong>
                </font>
              </label>
              <div class="input-group" style="border:1px solid #e5e5e5">
                <input type="text" currencyMask [options]="{align :'left',allowNegative :false }"
                  class="form-control currency" [(ngModel)]=" dealRegistration.opportunityAmount "
                  [ngModelOptions]="{standalone: true}" id="opportunityAmount"
                  (input)="validateField('opportunityAmount',false)"
                  (ngModelChange)="validateField('opportunityAmount',false)" [disabled]="isVendor|| isPreview" maxlength="20"
                  autocomplete="off" />
              </div>
            </div>
            <div class="form-group" [attr.class]="estimatedCloseDate" style="margin-bottom: 20px">
              <label class="control-label">Estimated Close date
                <font style="color: #f55d7a">
                  <b>*</b>
                </font>
              </label>
              <input type="text" class="form-control flatpickr square-box" [(ngModel)]=" dealRegistration.estimatedCloseDate "
                [ngModelOptions]="{standalone: true}" id="estimatedCloseDate"
                (input)="validateField('estimatedCloseDate',false)" [disabled]="isVendor|| isPreview" />
            </div>
      
      
      
            <div *ngFor="let property of propertiesQuestions;let i=index">
      
              <div class="form-group" [attr.class]="property.class" *ngIf="property.propType == 'QUESTION'">
                <label class="control-label">{{property.key}}
                  <font style="color: #f55d7a">
                    <b>*</b>
                  </font>
                </label>
                <input type="text" maxlength="1000" name="{{property.value}}" class="form-control"
                  [(ngModel)]="property.value" [ngModelOptions]="{standalone: true}" id="question_{{property.id}}"
                  (input)="validateField(property,true)" [disabled]="isVendor || isPreview" />
              </div>
            </div>
      
          </div>
      
      
          <div class="form-group" *ngIf="!isVendor && !isPreview">
            <a class="dashboard-stat yellow-gold" style="padding: 9px 0;margin-top: 10px" (click)="addProperties()">
              <i class="fa fa-plus-square p0" style="margin: 0 5px;"></i>
              Add Your Comments
            </a>
          </div>
          <div class="col-xs-12" id="reply-onclick-div" style="position: relative; bottom: 4px;" *ngIf="!isPreview">
            <fieldset *ngIf="propertiesComments?.length>0">
              <legend *ngIf="!isVendor && !isPreview">Add Your Comments</legend>
              <legend *ngIf="isVendor">Partner Comments</legend>
              <div *ngFor="let property of propertiesComments;let i=index">
                <div class="portlet light dashboard-stat2" *ngIf="property.propType == 'PROPERTY'">
                  <div class="portlet-title custom-change-css" [ngClass]="{'colorBlue':isEven(i+1), 'colorRed':!isEven(i+1)}">
                    <div class="col-xs-6">
                      <h4 class="text-left" style="color:#fff">Comment-{{i+1}}</h4>
                    </div>
                    <div class="col-xs-6">
                      <div class="pull-right" id="question-icons" *ngIf="!isPreview">
                        <button type="button" class="btn-danger button-blue" (click)="showAlert(i+1,property)"
                          *ngIf="!isVendor">
                          <span class="glyphicon glyphicon-trash"></span>
                        </button>
                        <button type="button" class="btn-primary button-blue" (click)="addProperties()" *ngIf="!isVendor">
                          <span class="glyphicon glyphicon-plus"></span>
                        </button>
                        <button type="button" class="btn-primary button-blue" (click)="commentsection(property)"
                          *ngIf=" property.isSaved">
                          <span class="glyphicon glyphicon-comment"
                            style="margin-right: 5px"></span><span>{{property.propCommentCount}}</span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <form class="role add-reply" id="form-{{property.divId}}">
                      <div class="col-xs-10" style="padding:0">
                        <div class="form-group" [attr.class]="property.validationStausKey">
                          <label class="control-label">Comment Title
                            <font style="color: #f55d7a">
                              <b>*</b>
                            </font>
                          </label>
                          <input type="text" maxlength="100" class="form-control" [(ngModel)]=" property.key"
                            [ngModelOptions]="{standalone: true}" id="question" (input)="validateComment(property)"
                            [disabled]="property.isDisabled || isVendor || isPreview" />
                        </div>
                        <div class="form-group" [attr.class]="property.validationStausValue">
                          <label class="control-label">Comment
                            <font style="color: #f55d7a">
                              <b>*</b>
                            </font>
                          </label>
                          <textarea type="text" maxlength="1000" class="form-control" [(ngModel)]=" property.value"
                            [ngModelOptions]="{standalone: true}" id="comment" (input)="validateComment(property)"
                            [disabled]="property.isDisabled || isVendor || isPreview"></textarea>
                        </div>
                      </div>
                    </form>
      
      
                    <div *ngIf=" property.isCommentSection ">
      
                      <app-manage-deal-comments [lead]="dealRegistration" [property]="property"></app-manage-deal-comments>
                    </div>
      
                  </div>
                </div>
              </div>
            </fieldset>
          </div>
          <hr>
        </div>
        <div class="pull-right" *ngIf="!isVendor && !isPreview && !showSfDealFields">
          <button type="submit" id="saveDeal" [disabled]=" !isDealRegistrationFormValid " (click)="save()"
            class="btn green-haze" *ngIf="!dealRegistration.isDeal">REGISTER DEAL</button>
          <button type="submit" id="saveDeal" [disabled]=" !isDealRegistrationFormValid " (click)="save()"
            class="btn green-haze" *ngIf="dealRegistration.isDeal">UPDATE DEAL</button>
          <!--  <button type="submit" id="updateDeal" (click)="update()"class="btn green-haze">Update</button> -->
        </div>
        <div class="pull-right" *ngIf="!isVendor && !isPreview && showSfDealFields">
          <button type="submit" id="saveDeal"
            [disabled]=" !isDealRegistrationFormValid || sfDealComponent?.isDealRegistrationFormValid" (click)="save()"
            class="btn green-haze" *ngIf="!dealRegistration.isDeal && !showLoadingButton">REGISTER DEAL</button>
          <button type="submit" id="saveDeal"
            [disabled]=" !isDealRegistrationFormValid || sfDealComponent?.isDealRegistrationFormValid" (click)="save()"
            class="btn green-haze" *ngIf="dealRegistration.isDeal && !showLoadingButton">UPDATE DEAL</button>
          <button class="btn btn-primary" type="button" *ngIf="showLoadingButton" disabled>
            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
            Loading.....
          </button>
          <!--  <button type="submit" id="updateDeal" (click)="update()"class="btn green-haze">Update</button> -->
        </div>
      </form>


    </div>
  </div>
</div>




<!-- END CONTENT -->


<!-- Marketo Authentication -->
<!-- <div class="modal right fade" id="templateRetrieve" tabindex="-1" role="dialog" aria-labelledby="templateRetrieve" data-keyboard="false"
  data-backdrop="static">
   <div class="modal-dialog template-modal" role="document" style="width: 50%">
     <ngx-loading [show]="loading" [config]="{ backdropBorderRadius: '14px' }"></ngx-loading>
     <div class="modal-content rounded-0">
       <div class="modal-header">
         <a class="close-circle" data-dismiss="modal" (click)="closeModal()" id="closeButton"><i class="fa fa-times"></i></a>
         <h4 class="modal-title" id="templateRetrieve">Push Lead</h4>
       </div>
       <div class="modal-body" style="padding: 39px;">
         <form class="form-horizontal">
           <div *ngIf="templateError" class="alert alert-danger"><span>{{templateError}}</span></div>
           <div *ngIf="templateSuccessMsg" class="alert alert-success"><span>{{templateSuccessMsg}}</span></div>
           <div [attr.class]="clientIdClass" class="form-group">
             <label class="control-label col-sm-3" for="email">Client Id:</label>
             <div class="col-sm-8">
               <input type="email" class="form-control" id="email" placeholder="Client Id" [(ngModel)]="clientId" [ngModelOptions]="{standalone: true}"
                (input)="validateModelForm('email')">
             </div>
           </div>
           <div [attr.class]="secretIdClass" class="form-group">
             <label class="control-label col-sm-3" for="pwd">Secret Id:</label>
             <div class="col-sm-8">
               <input type="password" class="form-control" id="pwd" placeholder="Secret Id" [(ngModel)]="secretId" [ngModelOptions]="{standalone: true}"
                (input)="validateModelForm('pwd')">
             </div>
           </div>

           <div [attr.class]="marketoInstanceClass" class="form-group">
             <label class="control-label col-sm-3" for="instance">Marketo Instance:</label>
             <div class="col-sm-8">
               <input type="text" class="form-control" id="instance" placeholder="Marketo Instance" [(ngModel)]="marketoInstance" [ngModelOptions]="{standalone: true}"
                (input)="validateModelForm('instance')">
             </div>
           </div>
         </form>

       </div>
       <div class="modal-footer">
         <div style="text-align: right;">
           <button class="btn btn-default" (click)="clearValues()">Clear</button>
           <button class="btn btn-primary" [disabled]="!isModelFormValid || !clientId || !secretId || !marketoInstance" (click)="submitMarketoCredentials()">Submit</button>
         </div>
       </div>
     </div>
   </div>
  </div>
   -->
